Sentinel：流量防护组件
限流 熔断  降级 系统保护



1. 限流（Flow Control）
限制每秒请求数量，防止系统被打爆。

2. 熔断（Circuit Breaking）
服务故障时自动熔断，快速失败，防止雪崩。

3. 降级（Degradation）
系统压力大时，降级非核心功能，保证核心功能可用。

4. 系统保护（System Protection）
监控CPU、内存、RT，超过阈值自动限流。


限流
1、java后端：在控制层 要限流的方法上加@SentinelResource注解，资源名和限流后执行的方法
2、Sentinel控制台配置：流控规则，新增接口资源名，阈值类型：QPS 单机阈值：10 


熔断实现:服务异常
1、在服务层方法上加要限良的方法上加@ @SentinelResource注解，资源名和熔断后执行的方法
2、Sentinel控制台配置：熔断规则，新增接口资源名
    熔断策略：异常比例
    例阈值：50%  ← 异常比例>50%触发熔断
    熔断时长：10秒
    最小请求数：5

正常情况：调用支付服务
支付服务故障（5个请求中3个异常）：
→ 触发熔断
→ 后续10秒内请求直接返回"支付服务暂时不可用"
→ 10秒后尝试恢复

降级：降级就是服务出问题时返回备用方案（默认值/缓存/提示），保证系统继续运行，不崩溃。
降级实现：在服务层方法上加要限良的方法上加@ @SentinelResource注解，资源名和降级后执行的方法

用户服务正常：返回真实用户信息
用户服务异常：返回默认用户信息


Sentinel控制台配置
系统规则 → 新增
  Load（系统负载）：8.0    ← CPU负载>8.0时限流
  RT（平均响应时间）：1000  ← 响应时间>1秒时限流
  线程数：100              ← 线程数>100时限流
  入口QPS：1000            ← QPS>1000时限流

  CPU负载<8.0：正常处理请求
CPU负载>8.0：拒绝新请求，返回"系统繁忙"





 @SentinelResource(
        value = "seckill",
        blockHandler = "seckillBlock",  // 限流降级
        fallback = "seckillFallback"    // 异常降级
    )



    1000个请求/秒到达
  ↓
Sentinel限流检查
  ├─ 前1000个：通过
  └─ 后面的：执行seckillBlock，返回"秒杀太火爆"
  ↓
执行业务逻辑
  ├─ 库存充足：秒杀成功
  └─ 库存不足：抛异常，执行seckillFallback，返回"库存不足"
  ↓
异常比例>50%
  ↓
触发熔断，后续10秒请求直接返回"秒杀太火爆"


1. 代码加@SentinelResource注解，指定资源名和降级方法
2. Sentinel控制台配置限流/熔断/系统规则
3. 请求到达时Sentinel拦截检查规则
4. 超过阈值执行blockHandler（限流）或fallback（熔断/异常）
5. 未超过阈值执行正常业务逻辑




