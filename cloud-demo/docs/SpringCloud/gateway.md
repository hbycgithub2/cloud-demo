
Nginx在最外层分发流量反向代理和负载均衡、静态资源、粗粒度限流，
Gateway在中间层做鉴权路由和细粒度限流、熔断，微服务在最内层处理业务。


客户端 
  ↓
Nginx（网络层）
  ├─ 负载均衡：分发到多个Gateway
  ├─ 静态资源：直接返回图片/CSS/JS
  ├─ 限流：每秒1000请求
  ↓
Gateway（应用层）
  ├─ 鉴权：验证Token
  ├─ 路由：转发到不同微服务
  ├─ 限流：每用户每秒10请求
  ├─ 熔断：服务故障自动降级
  ↓
微服务（用户服务、订单服务、支付服务）






客户端 → Nginx（流量分发） → Gateway（业务处理） → 微服务

Gateway根据URL路径把请求转发到对应的微服务，同时验证Token、限流、记录日志。




Gateway：应用层网关，微服务统一入口，处理业务逻辑（路由、鉴权、限流、熔断）


鉴权:验证用户身份和权限，决定是否允许访问接口。
Gateway用JWT验证用户身份，无需查Redis或数据库，直接解析Token验证。
token生成：根据用户信息+密钥 生成签名，确保Token不被篡改。
token解析：根据从获取到地token里获取的旧签名和新签名和对比是否一对待，确认token一致。


路由：灵活路由、自动分发到多个微服务地址
配置predicates匹配URL路径，uri 指定转发的微服务地址

限流：Gateway用令牌桶算法限流，每秒放N个令牌，超过限制返回429，保护后端服务。
熔断：Gateway熔断在后端服务故障时自动断开连接，返回降级响应，防止雪崩效应。



技术原因： Token是用户身份凭证，没Token = 系统不知道"你是谁"，就无法判断"你能不能访问这个数据"。


Token验证：不用每个微服务都写鉴权代码，Gateway统一验证
限流保护：Gateway统一限流，防止某个微服务被打爆
日志监控：Gateway统一记录，方便排查问题




Gateway路由转发：
配置 predicates 匹配URL路径，uri 指定转发的微服务地址（lb://服务名 自动负载均衡）。

routes:
  - id: user-service
    uri: lb://user-service
    predicates:
      - Path=/user/**




在JWT中的作用： 确保Token未被篡改，客户端改了Payload（如把userId从123改成456），签名对不上，验证失败。

生成Token：数据+密钥 → 签名
验证Token：重新计算签名对比，一致则未被篡改



用户 → 登录接口 → 验证账号密码 → 生成JWT Token → 返回给客户端
客户端 → 请求头带Token → Gateway拦截

Gateway(验证JWT)-解析+验证签名 




token的生成:通过对用户信息编码+秘钥，并成token
token解签:重新对比签名是否到才，一致则有效

token的生成：把用户信息编码后，用密钥签名防篡改，拼成Token。
token解签：分割Token，重新计算签名对比，一致则有效，解码获取用户信息


生token   数据+密钥=签名 

解token 获取token  收到签名 




在JWT中的作用： 确保Token未被篡改，客户端改了Payload（如把userId从123改成456），签名对不上，验证失败。

一句话：HMAC-SHA256哈希算法，把数据+密钥生成唯一签名，防止数据被篡改，无法反推密钥。


JWT中的作用，确保Token未被篡改，如把用户的id等信息改成别的，签名对不上，验证



