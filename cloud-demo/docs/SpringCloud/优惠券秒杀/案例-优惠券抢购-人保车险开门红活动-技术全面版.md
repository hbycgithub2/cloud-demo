# äººä¿è½¦é™©ä¼˜æƒ åˆ¸æŠ¢è´­é«˜å¹¶å‘åœºæ™¯ - æŠ€æœ¯å…¨é¢ç‰ˆ

> **åœºæ™¯**ï¼šäººä¿è½¦é™©"å¼€é—¨çº¢"ä¼˜æƒ åˆ¸æŠ¢è´­æ´»åŠ¨  
> **å¹¶å‘é‡**ï¼šQPS 833æ¬¡/ç§’ï¼Œç›¸å¯¹å¹³æ—¶å¢é•¿330å€  
> **æŠ€æœ¯æ ˆ**ï¼šRedis + Kafka + Sentinel + Luaè„šæœ¬  
> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.0  
> **åˆ›å»ºæ—¶é—´**ï¼š2026-02-02

---

## ğŸ“‹ ç›®å½•

- [ç¬¬1-10å±‚ï¼šä¸šåŠ¡åœºæ™¯åˆ†æ](#ç¬¬1-10å±‚ä¸šåŠ¡åœºæ™¯åˆ†æ)
- [ç¬¬11-20å±‚ï¼šå¹¶å‘é‡è®¡ç®—ä¸åˆ†æ](#ç¬¬11-20å±‚å¹¶å‘é‡è®¡ç®—ä¸åˆ†æ)
- [ç¬¬21-30å±‚ï¼šæŠ€æœ¯æŒ‘æˆ˜è¯†åˆ«](#ç¬¬21-30å±‚æŠ€æœ¯æŒ‘æˆ˜è¯†åˆ«)
- [ç¬¬31-40å±‚ï¼šæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡](#ç¬¬31-40å±‚æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡)
- [ç¬¬41-50å±‚ï¼šæ ¸å¿ƒä»£ç å®ç°](#ç¬¬41-50å±‚æ ¸å¿ƒä»£ç å®ç°)
- [ç¬¬51-60å±‚ï¼šå‹æµ‹ä¸ä¼˜åŒ–](#ç¬¬51-60å±‚å‹æµ‹ä¸ä¼˜åŒ–)
- [ç¬¬61-70å±‚ï¼šé¢è¯•å®˜è§†è§’åˆ†æ](#ç¬¬61-70å±‚é¢è¯•å®˜è§†è§’åˆ†æ)
- [ç¬¬71-80å±‚ï¼šé¢è¯•è€…åº”å¯¹ç­–ç•¥](#ç¬¬71-80å±‚é¢è¯•è€…åº”å¯¹ç­–ç•¥)

---

## ç¬¬1-10å±‚ï¼šä¸šåŠ¡åœºæ™¯åˆ†æ

### ç¬¬1å±‚ï¼šä»€ä¹ˆæ˜¯"å¼€é—¨çº¢"æ´»åŠ¨ï¼Ÿ

**ä¿é™©è¡Œä¸šèƒŒæ™¯ï¼š**
- "å¼€é—¨çº¢"æ˜¯ä¿é™©è¡Œä¸šæœ¯è¯­ï¼ŒæŒ‡æ¯å¹´1æœˆçš„ä¸šç»©å†²åˆº
- 1æœˆæ˜¯ä¿é™©å…¬å¸å…¨å¹´æœ€é‡è¦çš„æœˆä»½ï¼ˆå å…¨å¹´ä¸šç»©20-30%ï¼‰
- åŸå› ï¼šæ˜¥èŠ‚å‰ç»­ä¿é«˜å³°ã€å¹´ç»ˆå¥–å‘æ”¾ã€ä¼ä¸šé‡‡è´­

**äººä¿è½¦é™©"å¼€é—¨çº¢"æ´»åŠ¨ï¼š**
- æ´»åŠ¨æ—¶é—´ï¼š2025å¹´1æœˆ1æ—¥ ä¸Šåˆ10:00
- æ´»åŠ¨å†…å®¹ï¼šé™é‡10000å¼ ä¼˜æƒ åˆ¸ï¼Œç«‹å‡200å…ƒ
- æœ‰æ•ˆæœŸï¼š30å¤©ï¼ˆ2025å¹´1æœˆ1æ—¥-1æœˆ31æ—¥ï¼‰
- ä½¿ç”¨æ¡ä»¶ï¼šè½¦é™©ä¿è´¹2000å…ƒä»¥ä¸Šå¯ç”¨
- æ¯äººé™é¢†ï¼š1å¼ 

**ä¸ºä»€ä¹ˆè¿™ä¸ªåœºæ™¯çœŸå®ï¼Ÿ**
- âœ… ä¿é™©è¡Œä¸šç¡®å®æœ‰"å¼€é—¨çº¢"ï¼ˆæ¯å¹´1æœˆï¼‰
- âœ… æ˜¥èŠ‚å‰ç¡®å®æ˜¯ç»­ä¿é«˜å³°ï¼ˆå¾ˆå¤šè½¦ä¸»ä¿å•åœ¨1-2æœˆåˆ°æœŸï¼‰
- âœ… ä¼˜æƒ åˆ¸é‡‘é¢åˆç†ï¼ˆ200å…ƒï¼Œä¸æ˜¯2000å…ƒï¼‰
- âœ… é™é‡åˆç†ï¼ˆ10000å¼ ï¼Œä¸æ˜¯100ä¸‡å¼ ï¼‰


### ç¬¬2å±‚ï¼šæ¨å¹¿æ¸ é“åˆ†æ

**æ¨å¹¿æ¸ é“ï¼š**
1. **çŸ­ä¿¡é€šçŸ¥**ï¼š
   - å‘é€å¯¹è±¡ï¼š100ä¸‡è€å®¢æˆ·ï¼ˆä¿å•å³å°†åˆ°æœŸï¼‰
   - æ‰“å¼€ç‡ï¼š5%
   - é¢„è®¡å‚ä¸ï¼š5ä¸‡äºº

2. **APPæ¨é€**ï¼š
   - å‘é€å¯¹è±¡ï¼š50ä¸‡APPç”¨æˆ·
   - æ‰“å¼€ç‡ï¼š10%
   - é¢„è®¡å‚ä¸ï¼š5ä¸‡äºº

3. **å¾®ä¿¡å…¬ä¼—å·**ï¼š
   - å‘é€å¯¹è±¡ï¼š100ä¸‡ç²‰ä¸
   - æ‰“å¼€ç‡ï¼š3%
   - é¢„è®¡å‚ä¸ï¼š3ä¸‡äºº

4. **åˆä½œæ¸ é“**ï¼š
   - 4Såº—ã€é“¶è¡Œã€åŠ æ²¹ç«™
   - é¢„è®¡å‚ä¸ï¼š2ä¸‡äºº

**æ€»è®¡ï¼š15ä¸‡äººå‚ä¸æŠ¢åˆ¸**

**ä¸ºä»€ä¹ˆè¿™ä¸ªæ•°æ®çœŸå®ï¼Ÿ**
- âœ… çŸ­ä¿¡æ‰“å¼€ç‡5%ï¼ˆè¡Œä¸šå¹³å‡3-8%ï¼‰
- âœ… APPæ¨é€æ‰“å¼€ç‡10%ï¼ˆè¡Œä¸šå¹³å‡8-15%ï¼‰
- âœ… å…¬ä¼—å·æ‰“å¼€ç‡3%ï¼ˆè¡Œä¸šå¹³å‡2-5%ï¼‰
- âœ… æ€»å‚ä¸äººæ•°15ä¸‡ï¼ˆ10000å¼ åˆ¸ï¼Œ15:1çš„æŠ¢è´­æ¯”ä¾‹åˆç†ï¼‰

---

### ç¬¬3å±‚ï¼šç”¨æˆ·ç”»åƒåˆ†æ

**ç›®æ ‡ç”¨æˆ·åˆ†ç±»ï¼š**

1. **è€å®¢æˆ·ï¼ˆ60%ï¼‰**ï¼š
   - ç‰¹å¾ï¼šä¿å•å³å°†åˆ°æœŸï¼ˆ1-2æœˆåˆ°æœŸï¼‰
   - åŠ¨æœºï¼šç»­ä¿ä¼˜æƒ 
   - è¡Œä¸ºï¼šæå‰5åˆ†é’Ÿè¿›å…¥é¡µé¢ï¼Œå‡†æ—¶æŠ¢åˆ¸
   - è½¬åŒ–ç‡ï¼š80%ï¼ˆæŠ¢åˆ°åˆ¸åä¼šæŠ•ä¿ï¼‰

2. **æ–°å®¢æˆ·ï¼ˆ30%ï¼‰**ï¼š
   - ç‰¹å¾ï¼šçœ‹åˆ°æ´»åŠ¨æƒ³ä¹°è½¦é™©
   - åŠ¨æœºï¼šä¼˜æƒ å¸å¼•
   - è¡Œä¸ºï¼š10:00å‡†æ—¶æŠ¢åˆ¸
   - è½¬åŒ–ç‡ï¼š50%ï¼ˆæŠ¢åˆ°åˆ¸åå¯èƒ½ä¸æŠ•ä¿ï¼‰

3. **ç¾Šæ¯›å…šï¼ˆ10%ï¼‰**ï¼š
   - ç‰¹å¾ï¼šåªæƒ³é¢†åˆ¸ä¸æŠ•ä¿
   - åŠ¨æœºï¼šè–…ç¾Šæ¯›
   - è¡Œä¸ºï¼šç”¨è„šæœ¬åˆ·åˆ¸
   - è½¬åŒ–ç‡ï¼š0%ï¼ˆä¸ä¼šæŠ•ä¿ï¼‰

**ç”¨æˆ·è¡Œä¸ºæ—¶é—´çº¿ï¼š**
```
9:55  ç”¨æˆ·æå‰è¿›å…¥æ´»åŠ¨é¡µé¢ï¼ˆ5åˆ†é’Ÿå‰ï¼‰
9:58  ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œç­‰å¾…æ´»åŠ¨å¼€å§‹
10:00 æ´»åŠ¨å¼€å§‹ï¼Œç”¨æˆ·ç–¯ç‹‚ç‚¹å‡»"ç«‹å³æŠ¢åˆ¸"
10:01 å¤§éƒ¨åˆ†ç”¨æˆ·æŠ¢åˆ°åˆ¸æˆ–çœ‹åˆ°"å·²æŠ¢å®Œ"
10:03 æ´»åŠ¨ç»“æŸï¼Œ10000å¼ åˆ¸æŠ¢å®Œ
```


### ç¬¬4å±‚ï¼šä¸šåŠ¡æµç¨‹ï¼ˆç”¨æˆ·è§†è§’ï¼‰

```
ç”¨æˆ·è¿›å…¥æ´»åŠ¨é¡µé¢
â†’ æŸ¥çœ‹æ´»åŠ¨è§„åˆ™ï¼ˆé™é‡10000å¼ ï¼Œç«‹å‡200å…ƒï¼‰
â†’ ç‚¹å‡»"ç«‹å³æŠ¢åˆ¸"æŒ‰é’®
â†’ è¾“å…¥éªŒè¯ç ï¼ˆé˜²åˆ·ï¼‰
â†’ æäº¤æŠ¢åˆ¸è¯·æ±‚
â†’ ç­‰å¾…ç»“æœï¼ˆ0.5ç§’ï¼‰
â†’ çœ‹åˆ°"æŠ¢åˆ¸æˆåŠŸ"æˆ–"å·²æŠ¢å®Œ"
â†’ æŠ¢åˆ¸æˆåŠŸåï¼Œè¿›å…¥"æˆ‘çš„ä¼˜æƒ åˆ¸"é¡µé¢
â†’ 30å¤©å†…ä½¿ç”¨ä¼˜æƒ åˆ¸æŠ•ä¿
```

---

### ç¬¬5å±‚ï¼šä¸šåŠ¡æµç¨‹ï¼ˆç³»ç»Ÿè§†è§’ï¼‰

```
ç”¨æˆ·ç‚¹å‡»"ç«‹å³æŠ¢åˆ¸"
â†’ å‰ç«¯é˜²é‡å¤ç‚¹å‡»ï¼ˆ1ç§’å†…åªèƒ½ç‚¹å‡»1æ¬¡ï¼‰
â†’ åç«¯æ¥æ”¶è¯·æ±‚
â†’ Sentinelé™æµï¼ˆQPSé™åˆ¶1000ï¼‰
â†’ éªŒè¯ç æ ¡éªŒ
â†’ IPé™æµï¼ˆ1åˆ†é’Ÿå†…æœ€å¤š10æ¬¡ï¼‰
â†’ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²é¢†å–ï¼ˆRedisæŸ¥è¯¢ï¼‰
â†’ Redisæ‰£å‡åº“å­˜ï¼ˆLuaè„šæœ¬ï¼ŒåŸå­æ€§ï¼‰
â†’ æ‰£å‡æˆåŠŸï¼Œæ ‡è®°ç”¨æˆ·å·²é¢†å–
â†’ ç”Ÿæˆä¼˜æƒ åˆ¸ç 
â†’ å‘é€Kafkaæ¶ˆæ¯ï¼ˆå¼‚æ­¥å†™å…¥MySQLï¼‰
â†’ è¿”å›"æŠ¢åˆ¸æˆåŠŸ"
â†’ Kafkaæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯
â†’ å†™å…¥MySQLï¼ˆç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ï¼‰
â†’ ç”¨æˆ·å¯ä»¥æŸ¥è¯¢ä¼˜æƒ åˆ¸
```

---

### ç¬¬6å±‚ï¼šæ ¸å¿ƒæ¥å£æ¸…å•

**æ¥å£1ï¼šæŠ¢åˆ¸æ¥å£**
```
POST /api/coupon/grab
å‚æ•°ï¼š
- userId: ç”¨æˆ·ID
- activityId: æ´»åŠ¨ID
- captcha: éªŒè¯ç 

è¿”å›ï¼š
- success: true/false
- message: "æŠ¢åˆ¸æˆåŠŸ" / "ä¼˜æƒ åˆ¸å·²æŠ¢å®Œ" / "æ‚¨å·²é¢†å–è¿‡"
- couponCode: ä¼˜æƒ åˆ¸ç ï¼ˆæŠ¢åˆ¸æˆåŠŸæ—¶è¿”å›ï¼‰
```

**æ¥å£2ï¼šæŸ¥è¯¢ä¼˜æƒ åˆ¸æ¥å£**
```
GET /api/coupon/list
å‚æ•°ï¼š
- userId: ç”¨æˆ·ID

è¿”å›ï¼š
- couponList: ä¼˜æƒ åˆ¸åˆ—è¡¨
```

**æ¥å£3ï¼šä½¿ç”¨ä¼˜æƒ åˆ¸æ¥å£**
```
POST /api/coupon/use
å‚æ•°ï¼š
- userId: ç”¨æˆ·ID
- couponCode: ä¼˜æƒ åˆ¸ç 
- orderId: è®¢å•ID

è¿”å›ï¼š
- success: true/false
```


### ç¬¬7å±‚ï¼šæ ¸å¿ƒè¡¨è®¾è®¡

**è¡¨1ï¼šä¼˜æƒ åˆ¸æ´»åŠ¨è¡¨ï¼ˆwcar_coupon_activityï¼‰**
```sql
CREATE TABLE wcar_coupon_activity (
    id BIGINT PRIMARY KEY,
    activity_name VARCHAR(100) COMMENT 'æ´»åŠ¨åç§°ï¼šå¼€é—¨çº¢ä¼˜æƒ åˆ¸',
    total_count INT COMMENT 'æ€»æ•°é‡ï¼š10000',
    remain_count INT COMMENT 'å‰©ä½™æ•°é‡',
    amount DECIMAL(10,2) COMMENT 'ä¼˜æƒ é‡‘é¢ï¼š200.00',
    start_time DATETIME COMMENT 'å¼€å§‹æ—¶é—´ï¼š2025-01-01 10:00:00',
    end_time DATETIME COMMENT 'ç»“æŸæ—¶é—´ï¼š2025-01-31 23:59:59',
    status TINYINT COMMENT 'çŠ¶æ€ï¼ˆ0æœªå¼€å§‹ã€1è¿›è¡Œä¸­ã€2å·²ç»“æŸï¼‰',
    create_time DATETIME,
    update_time DATETIME
);
```

**è¡¨2ï¼šç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ï¼ˆwcar_user_couponï¼‰**
```sql
CREATE TABLE wcar_user_coupon (
    id BIGINT PRIMARY KEY,
    user_id BIGINT COMMENT 'ç”¨æˆ·ID',
    activity_id BIGINT COMMENT 'æ´»åŠ¨ID',
    coupon_code VARCHAR(50) COMMENT 'ä¼˜æƒ åˆ¸ç ',
    amount DECIMAL(10,2) COMMENT 'ä¼˜æƒ é‡‘é¢ï¼š200.00',
    status TINYINT COMMENT 'çŠ¶æ€ï¼ˆ0æœªä½¿ç”¨ã€1å·²ä½¿ç”¨ã€2å·²è¿‡æœŸï¼‰',
    order_id BIGINT COMMENT 'è®¢å•IDï¼ˆä½¿ç”¨æ—¶å¡«å†™ï¼‰',
    expire_time DATETIME COMMENT 'è¿‡æœŸæ—¶é—´ï¼š2025-01-31 23:59:59',
    use_time DATETIME COMMENT 'ä½¿ç”¨æ—¶é—´',
    create_time DATETIME,
    update_time DATETIME,
    INDEX idx_user_id (user_id),
    INDEX idx_coupon_code (coupon_code),
    INDEX idx_activity_id (activity_id)
);
```

**è¡¨3ï¼šæŠ¢åˆ¸æ—¥å¿—è¡¨ï¼ˆwcar_coupon_logï¼‰**
```sql
CREATE TABLE wcar_coupon_log (
    id BIGINT PRIMARY KEY,
    user_id BIGINT COMMENT 'ç”¨æˆ·ID',
    activity_id BIGINT COMMENT 'æ´»åŠ¨ID',
    action VARCHAR(20) COMMENT 'æ“ä½œï¼ˆgrab/useï¼‰',
    result TINYINT COMMENT 'ç»“æœï¼ˆ0å¤±è´¥ã€1æˆåŠŸï¼‰',
    fail_reason VARCHAR(200) COMMENT 'å¤±è´¥åŸå› ',
    ip VARCHAR(50) COMMENT 'IPåœ°å€',
    create_time DATETIME,
    INDEX idx_user_id (user_id),
    INDEX idx_activity_id (activity_id),
    INDEX idx_create_time (create_time)
);
```

---

### ç¬¬8å±‚ï¼šRedisæ•°æ®ç»“æ„è®¾è®¡

**Key1ï¼šæ´»åŠ¨åº“å­˜**
```
Key: coupon:stock:{activityId}
Type: String
Value: 10000ï¼ˆå‰©ä½™æ•°é‡ï¼‰
TTL: æ´»åŠ¨ç»“æŸå1å¤©
ç¤ºä¾‹: coupon:stock:1001 = "10000"
```

**Key2ï¼šç”¨æˆ·é¢†å–è®°å½•**
```
Key: coupon:user:{activityId}:{userId}
Type: String
Value: 1ï¼ˆå·²é¢†å–ï¼‰
TTL: æ´»åŠ¨ç»“æŸå1å¤©
ç¤ºä¾‹: coupon:user:1001:123456 = "1"
```

**Key3ï¼šIPé™æµ**
```
Key: coupon:ip:{activityId}:{ip}
Type: String
Value: 5ï¼ˆè¯·æ±‚æ¬¡æ•°ï¼‰
TTL: 1åˆ†é’Ÿ
ç¤ºä¾‹: coupon:ip:1001:192.168.1.1 = "5"
```

**Key4ï¼šç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨ï¼ˆç¼“å­˜ï¼‰**
```
Key: coupon:list:{userId}
Type: List
Value: [couponCode1, couponCode2, ...]
TTL: 1å°æ—¶
ç¤ºä¾‹: coupon:list:123456 = ["PICC1001...", "PICC1002..."]
```

---

### ç¬¬9å±‚ï¼šKafkaæ¶ˆæ¯è®¾è®¡

**Topicï¼šcoupon-topic**
```
åˆ†åŒºæ•°ï¼š10ï¼ˆæå‡å¹¶å‘ï¼‰
å‰¯æœ¬æ•°ï¼š3ï¼ˆé«˜å¯ç”¨ï¼‰
æ¶ˆæ¯æ ¼å¼ï¼šJSON
```

**æ¶ˆæ¯ä½“ï¼š**
```json
{
    "userId": 123456,
    "activityId": 1001,
    "couponCode": "PICC1001202501011000001",
    "amount": 200.00,
    "expireTime": "2025-01-31 23:59:59",
    "createTime": "2025-01-01 10:00:01"
}
```

---

### ç¬¬10å±‚ï¼šæŠ€æœ¯æ¶æ„å›¾

```
ç”¨æˆ·ï¼ˆ15ä¸‡äººï¼‰
    â†“
Nginxï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
    â†“
åº”ç”¨æœåŠ¡å™¨ï¼ˆ10å°ï¼Œæ¯å°QPS 100ï¼‰
    â†“
Sentinelï¼ˆé™æµï¼ŒQPS 1000ï¼‰
    â†“
Redis Clusterï¼ˆ3ä¸»3ä»ï¼Œåº“å­˜æ‰£å‡ï¼‰
    â†“
Kafkaï¼ˆå¼‚æ­¥å†™å…¥ï¼Œ10åˆ†åŒºï¼‰
    â†“
MySQLï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰
```

**ä¸ºä»€ä¹ˆéœ€è¦10å°æœåŠ¡å™¨ï¼Ÿ**
- å•æœºQPSï¼š100æ¬¡/ç§’
- å³°å€¼QPSï¼š833æ¬¡/ç§’
- éœ€è¦æœåŠ¡å™¨ï¼š833 Ã· 100 = 8.3å°
- å®é™…éƒ¨ç½²ï¼š10å°ï¼ˆç•™20%ä½™é‡ï¼‰

---

## ç¬¬11-20å±‚ï¼šå¹¶å‘é‡è®¡ç®—ä¸åˆ†æ

### ç¬¬11å±‚ï¼šå¹¶å‘é‡è®¡ç®—å…¬å¼

**å…¬å¼ï¼š**
```
QPS = æ€»è¯·æ±‚æ•° Ã· æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
å¹¶å‘é‡ = QPS Ã— å¹³å‡å“åº”æ—¶é—´ï¼ˆç§’ï¼‰
```

**ç¤ºä¾‹ï¼š**
- æ€»è¯·æ±‚æ•°ï¼š15ä¸‡äºº Ã— 3æ¬¡ç‚¹å‡» = 45ä¸‡æ¬¡
- æ—¶é—´çª—å£ï¼š3åˆ†é’Ÿ = 180ç§’
- QPSï¼š450000 Ã· 180 = 2500æ¬¡/ç§’
- å¹³å‡å“åº”æ—¶é—´ï¼š0.5ç§’
- å¹¶å‘é‡ï¼š2500 Ã— 0.5 = 1250ä¸ªå¹¶å‘è¯·æ±‚


### ç¬¬12å±‚ï¼š3ç§å¹¶å‘é‡åœºæ™¯å¯¹æ¯”

**åœºæ™¯1ï¼šä¿å®ˆä¼°è®¡ï¼ˆ5ä¸‡äººå‚ä¸ï¼‰**
- å‚ä¸äººæ•°ï¼š5ä¸‡äºº
- é‡å¤ç‚¹å‡»ï¼šå¹³å‡2æ¬¡
- æ—¶é—´çª—å£ï¼š5åˆ†é’Ÿ = 300ç§’
- QPSï¼š50000 Ã— 2 Ã· 300 = **333æ¬¡/ç§’**
- å¹¶å‘é‡ï¼š333 Ã— 0.5 = **166ä¸ª**

**åœºæ™¯2ï¼šæ­£å¸¸ä¼°è®¡ï¼ˆ10ä¸‡äººå‚ä¸ï¼‰**
- å‚ä¸äººæ•°ï¼š10ä¸‡äºº
- é‡å¤ç‚¹å‡»ï¼šå¹³å‡3æ¬¡
- æ—¶é—´çª—å£ï¼š3åˆ†é’Ÿ = 180ç§’
- QPSï¼š100000 Ã— 3 Ã· 180 = **1666æ¬¡/ç§’**
- å¹¶å‘é‡ï¼š1666 Ã— 0.5 = **833ä¸ª**

**åœºæ™¯3ï¼šæç«¯ä¼°è®¡ï¼ˆ15ä¸‡äººå‚ä¸ï¼‰**
- å‚ä¸äººæ•°ï¼š15ä¸‡äºº
- é‡å¤ç‚¹å‡»ï¼šå¹³å‡3æ¬¡
- æ—¶é—´çª—å£ï¼š3åˆ†é’Ÿ = 180ç§’
- QPSï¼š150000 Ã— 3 Ã· 180 = **2500æ¬¡/ç§’**
- å¹¶å‘é‡ï¼š2500 Ã— 0.5 = **1250ä¸ª**

**ç»“è®ºï¼šQPS 333-2500æ¬¡/ç§’ï¼Œå¹¶å‘é‡166-1250ä¸ª**

---

### ç¬¬13å±‚ï¼šä¸ºä»€ä¹ˆç”¨æˆ·ä¼šé‡å¤ç‚¹å‡»ï¼Ÿ

**ç”¨æˆ·å¿ƒç†åˆ†æï¼š**
1. **ç„¦è™‘å¿ƒç†**ï¼šæ€•æŠ¢ä¸åˆ°ï¼Œç–¯ç‹‚ç‚¹å‡»
2. **ç½‘ç»œå»¶è¿Ÿ**ï¼šç‚¹å‡»åæ²¡ååº”ï¼Œä»¥ä¸ºæ²¡ç‚¹ä¸Š
3. **é¡µé¢å¡é¡¿**ï¼šç³»ç»Ÿå“åº”æ…¢ï¼Œç”¨æˆ·é‡å¤ç‚¹å‡»
4. **ä¸ä¿¡ä»»**ï¼šä¸ç›¸ä¿¡ç‚¹å‡»æˆåŠŸï¼Œå†ç‚¹ä¸€æ¬¡ç¡®è®¤

**æ•°æ®æ”¯æ’‘ï¼š**
- ç”µå•†ç§’æ€ï¼šç”¨æˆ·å¹³å‡ç‚¹å‡»5-10æ¬¡
- 12306æŠ¢ç¥¨ï¼šç”¨æˆ·å¹³å‡ç‚¹å‡»10-20æ¬¡
- è½¦é™©æŠ¢åˆ¸ï¼šç”¨æˆ·å¹³å‡ç‚¹å‡»2-3æ¬¡ï¼ˆç›¸å¯¹ç†æ€§ï¼‰

**ä¸ºä»€ä¹ˆè½¦é™©æŠ¢åˆ¸ç‚¹å‡»æ¬¡æ•°å°‘ï¼Ÿ**
- è½¦é™©ä¸æ˜¯ç¨€ç¼ºå•†å“ï¼ˆä¸åƒiPhoneï¼‰
- è½¦é™©å†³ç­–å‘¨æœŸé•¿ï¼ˆä¸æ˜¯å†²åŠ¨æ¶ˆè´¹ï¼‰
- ç”¨æˆ·ç›¸å¯¹ç†æ€§ï¼ˆä¸ä¼šç–¯ç‹‚ç‚¹å‡»ï¼‰

---

### ç¬¬14å±‚ï¼šç›¸å¯¹å¢é•¿ vs ç»å¯¹å¹¶å‘é‡

**å¹³æ—¶è½¦é™©æŠ•ä¿ï¼š**
- æ—¥å‡æŠ•ä¿ï¼š22ä¸‡å•
- æ¯ç§’æŠ•ä¿ï¼š22ä¸‡ Ã· 86400ç§’ = **2.5æ¬¡/ç§’**
- å¹¶å‘é‡ï¼š2.5 Ã— 3ç§’ = **7.5ä¸ª**

**ä¼˜æƒ åˆ¸æŠ¢è´­ï¼š**
- QPSï¼š833æ¬¡/ç§’ï¼ˆæ­£å¸¸ä¼°è®¡ï¼‰
- å¹¶å‘é‡ï¼š833 Ã— 0.5 = **416ä¸ª**

**ç›¸å¯¹å¢é•¿ï¼š**
- QPSå¢é•¿ï¼š833 Ã· 2.5 = **333å€**
- å¹¶å‘é‡å¢é•¿ï¼š416 Ã· 7.5 = **55å€**

**é¢è¯•è¯æœ¯ï¼š**
- âŒ é”™è¯¯ï¼š"æˆ‘ä»¬ç³»ç»ŸQPSè¾¾åˆ°833æ¬¡/ç§’"ï¼ˆé¢è¯•å®˜ä¼šè´¨ç–‘ï¼šè¿™ä¹Ÿå«é«˜å¹¶å‘ï¼Ÿï¼‰
- âœ… æ­£ç¡®ï¼š"æˆ‘ä»¬å¹³æ—¶QPSåªæœ‰2.5æ¬¡/ç§’ï¼Œä½†ä¼˜æƒ åˆ¸æŠ¢è´­æ—¶QPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œ**ç›¸å¯¹å¢é•¿333å€**ã€‚"

---

### ç¬¬15å±‚ï¼šä¸å…¶ä»–è¡Œä¸šå¯¹æ¯”

| è¡Œä¸š | åœºæ™¯ | QPS | å¹¶å‘é‡ | æ˜¯å¦é«˜å¹¶å‘ |
|------|------|-----|--------|-----------|
| **ç”µå•†** | åŒåä¸€ç§’æ€ | 10ä¸‡+æ¬¡/ç§’ | 5ä¸‡+ä¸ª | âœ…âœ…âœ… è¶…é«˜å¹¶å‘ |
| **å‡ºè¡Œ** | 12306æŠ¢ç¥¨ | 10ä¸‡+æ¬¡/ç§’ | 5ä¸‡+ä¸ª | âœ…âœ…âœ… è¶…é«˜å¹¶å‘ |
| **ç¤¾äº¤** | å¾®ä¿¡çº¢åŒ… | 40ä¸‡+æ¬¡/ç§’ | 20ä¸‡+ä¸ª | âœ…âœ…âœ… è¶…é«˜å¹¶å‘ |
| **é‡‘è** | åŸºé‡‘ç”³è´­ | 5000æ¬¡/ç§’ | 2500ä¸ª | âœ…âœ… é«˜å¹¶å‘ |
| **ä¿é™©** | ä¼˜æƒ åˆ¸æŠ¢è´­ | 833æ¬¡/ç§’ | 416ä¸ª | âœ… ä¸­é«˜å¹¶å‘ |
| **ä¿é™©** | å¹³æ—¶æŠ•ä¿ | 2.5æ¬¡/ç§’ | 7.5ä¸ª | âŒ ä½å¹¶å‘ |

**ç»“è®ºï¼š**
- è½¦é™©ä¼˜æƒ åˆ¸æŠ¢è´­ä¸æ˜¯"è¶…é«˜å¹¶å‘"ï¼Œä½†æ˜¯"ä¸­é«˜å¹¶å‘"
- ç›¸å¯¹å¹³æ—¶å¢é•¿333å€ï¼Œå¯¹ç³»ç»Ÿæ˜¯å¾ˆå¤§çš„æŒ‘æˆ˜
- é¢è¯•æ—¶å¼ºè°ƒ"ç›¸å¯¹å¢é•¿"ï¼Œè€Œä¸æ˜¯"ç»å¯¹å¹¶å‘é‡"

---

### ç¬¬16å±‚ï¼šæ—¶é—´åˆ†å¸ƒåˆ†æ

**æŠ¢åˆ¸æ—¶é—´åˆ†å¸ƒï¼ˆ3åˆ†é’Ÿï¼‰ï¼š**
```
10:00:00-10:00:30ï¼ˆå‰30ç§’ï¼‰ï¼š50%çš„è¯·æ±‚ï¼ˆQPS 1666æ¬¡/ç§’ï¼‰
10:00:30-10:01:00ï¼ˆ30-60ç§’ï¼‰ï¼š30%çš„è¯·æ±‚ï¼ˆQPS 1000æ¬¡/ç§’ï¼‰
10:01:00-10:02:00ï¼ˆ1-2åˆ†é’Ÿï¼‰ï¼š15%çš„è¯·æ±‚ï¼ˆQPS 416æ¬¡/ç§’ï¼‰
10:02:00-10:03:00ï¼ˆ2-3åˆ†é’Ÿï¼‰ï¼š5%çš„è¯·æ±‚ï¼ˆQPS 138æ¬¡/ç§’ï¼‰
```

**ä¸ºä»€ä¹ˆå‰30ç§’æœ€é«˜ï¼Ÿ**
- ç”¨æˆ·æå‰è¿›å…¥é¡µé¢ï¼Œ10:00å‡†æ—¶ç‚¹å‡»
- å¤§éƒ¨åˆ†ç”¨æˆ·åœ¨å‰30ç§’æŠ¢åˆ¸
- åé¢çš„ç”¨æˆ·çœ‹åˆ°"å·²æŠ¢å®Œ"ï¼Œä¸å†ç‚¹å‡»

**æŠ€æœ¯æŒ‘æˆ˜ï¼š**
- å‰30ç§’QPS 1666æ¬¡/ç§’ï¼Œæ˜¯å¹³å‡QPS 833æ¬¡/ç§’çš„2å€
- ç³»ç»Ÿéœ€è¦æ‰¿å—ç¬æ—¶æµé‡æ´ªå³°

---

### ç¬¬17å±‚ï¼šæµé‡æ´ªå³°çš„æœ¬è´¨

**ä»€ä¹ˆæ˜¯æµé‡æ´ªå³°ï¼Ÿ**
- ä¸æ˜¯"ç»å¯¹å¹¶å‘é‡é«˜"ï¼Œè€Œæ˜¯"ç›¸å¯¹å¢é•¿å¤§"
- ä¸æ˜¯"æŒç»­é«˜å¹¶å‘"ï¼Œè€Œæ˜¯"ç¬æ—¶é«˜å¹¶å‘"

**è½¦é™©ä¼˜æƒ åˆ¸æŠ¢è´­çš„æµé‡æ´ªå³°ç‰¹å¾ï¼š**
1. **ç¬æ—¶æ€§**ï¼šå‰30ç§’QPS 1666æ¬¡/ç§’ï¼Œåé¢è¿…é€Ÿä¸‹é™
2. **ç›¸å¯¹æ€§**ï¼šç›¸å¯¹å¹³æ—¶å¢é•¿333å€
3. **ä¸å¯é¢„æµ‹æ€§**ï¼šæ— æ³•å‡†ç¡®é¢„æµ‹å‚ä¸äººæ•°
4. **çŸ­æ—¶æ€§**ï¼šåªæŒç»­3åˆ†é’Ÿ

**æŠ€æœ¯åº”å¯¹ï¼š**
- é™æµï¼šä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‰“å®
- æ‰©å®¹ï¼šæå‰æ‰©å®¹åˆ°10å°æœåŠ¡å™¨
- é™çº§ï¼šéæ ¸å¿ƒåŠŸèƒ½é™çº§
- ç›‘æ§ï¼šå®æ—¶ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

---

### ç¬¬18å±‚ï¼šå¹¶å‘é‡çš„4ä¸ªç»´åº¦

**ç»´åº¦1ï¼šè¯·æ±‚å¹¶å‘ï¼ˆQPSï¼‰**
- æ¯ç§’è¯·æ±‚æ•°ï¼š833æ¬¡/ç§’
- è¡¡é‡æŒ‡æ ‡ï¼šç³»ç»Ÿååé‡

**ç»´åº¦2ï¼šè¿æ¥å¹¶å‘**
- åŒæ—¶åœ¨çº¿ç”¨æˆ·ï¼š15ä¸‡äºº
- è¡¡é‡æŒ‡æ ‡ï¼šç½‘ç»œè¿æ¥æ•°

**ç»´åº¦3ï¼šæ•°æ®åº“å¹¶å‘**
- åŒæ—¶æŸ¥è¯¢æ•°æ®åº“ï¼š100æ¬¡/ç§’ï¼ˆRedisæ‰›ä½å¤§éƒ¨åˆ†è¯·æ±‚ï¼‰
- è¡¡é‡æŒ‡æ ‡ï¼šæ•°æ®åº“è¿æ¥æ•°

**ç»´åº¦4ï¼šä¸šåŠ¡å¹¶å‘**
- åŒæ—¶æ‰£å‡åº“å­˜ï¼š833æ¬¡/ç§’
- è¡¡é‡æŒ‡æ ‡ï¼šRedisæ“ä½œæ•°

**æŠ€æœ¯æ–¹æ¡ˆï¼š**
- è¯·æ±‚å¹¶å‘ï¼šNginxè´Ÿè½½å‡è¡¡ + 10å°æœåŠ¡å™¨
- è¿æ¥å¹¶å‘ï¼šé•¿è¿æ¥ + WebSocket
- æ•°æ®åº“å¹¶å‘ï¼šRedisæ‰›ä½ï¼ŒMySQLå¼‚æ­¥å†™å…¥
- ä¸šåŠ¡å¹¶å‘ï¼šRedis + Luaè„šæœ¬åŸå­æ€§æ‰£å‡

---

### ç¬¬19å±‚ï¼šå¹¶å‘é‡çš„è¯¯åŒº

**è¯¯åŒº1ï¼šQPSè¶Šé«˜è¶Šå¥½**
- âŒ é”™è¯¯ï¼šè¿½æ±‚QPS 10ä¸‡+
- âœ… æ­£ç¡®ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼ŒQPS 833æ¬¡/ç§’è¶³å¤Ÿ

**è¯¯åŒº2ï¼šå¹¶å‘é‡ = åœ¨çº¿ç”¨æˆ·æ•°**
- âŒ é”™è¯¯ï¼š15ä¸‡äººåœ¨çº¿ = 15ä¸‡å¹¶å‘
- âœ… æ­£ç¡®ï¼š15ä¸‡äººåœ¨çº¿ï¼Œä½†QPSåªæœ‰833æ¬¡/ç§’ï¼Œå¹¶å‘é‡416ä¸ª

**è¯¯åŒº3ï¼šé«˜å¹¶å‘ = å¤æ‚æŠ€æœ¯**
- âŒ é”™è¯¯ï¼šç”¨äº†Redisã€Kafkaå°±æ˜¯é«˜å¹¶å‘
- âœ… æ­£ç¡®ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©æŠ€æœ¯ï¼Œä¸è¿‡åº¦è®¾è®¡

**è¯¯åŒº4ï¼šé«˜å¹¶å‘ = ç§’æ€**
- âŒ é”™è¯¯ï¼šåªæœ‰ç§’æ€æ‰æ˜¯é«˜å¹¶å‘
- âœ… æ­£ç¡®ï¼šç›¸å¯¹å¢é•¿å¤§å°±æ˜¯é«˜å¹¶å‘ï¼ˆè½¦é™©å¢é•¿333å€ï¼‰

---

### ç¬¬20å±‚ï¼šå¹¶å‘é‡æ€»ç»“

**è½¦é™©ä¼˜æƒ åˆ¸æŠ¢è´­å¹¶å‘é‡ï¼š**
- **QPS**ï¼š333-2500æ¬¡/ç§’ï¼ˆä¿å®ˆ-æç«¯ï¼‰
- **æ­£å¸¸QPS**ï¼š833æ¬¡/ç§’
- **å¹¶å‘é‡**ï¼š416ä¸ªå¹¶å‘è¯·æ±‚
- **ç›¸å¯¹å¢é•¿**ï¼š333å€
- **æ—¶é—´çª—å£**ï¼š3åˆ†é’Ÿ
- **å³°å€¼æ—¶æ®µ**ï¼šå‰30ç§’ï¼ŒQPS 1666æ¬¡/ç§’

**é¢è¯•è¯æœ¯ï¼š**
- "æˆ‘ä»¬è½¦é™©é¡¹ç›®åœ¨ä¼˜æƒ åˆ¸æŠ¢è´­æ´»åŠ¨æ—¶ï¼ŒQPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œç›¸å¯¹å¹³æ—¶å¢é•¿333å€ï¼Œå¹¶å‘é‡416ä¸ªã€‚è™½ç„¶ç»å¯¹å¹¶å‘é‡ä¸å¦‚ç”µå•†ï¼Œä½†ç›¸å¯¹å¢é•¿å¾ˆå¤§ï¼Œå¯¹æˆ‘ä»¬ç³»ç»Ÿæ˜¯å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚"

---

## ç¬¬21-30å±‚ï¼šæŠ€æœ¯æŒ‘æˆ˜è¯†åˆ«

### ç¬¬21å±‚ï¼šæŒ‘æˆ˜1 - åº“å­˜æ‰£å‡ï¼ˆé˜²è¶…å–ï¼‰

**é—®é¢˜æè¿°ï¼š**
- 10000å¼ åˆ¸ï¼Œä¸èƒ½è¢«æŠ¢è´­10001æ¬¡
- å¤šä¸ªç”¨æˆ·åŒæ—¶ç‚¹å‡»ï¼Œå¦‚ä½•ä¿è¯åº“å­˜å‡†ç¡®ï¼Ÿ

**é”™è¯¯æ–¹æ¡ˆ1ï¼šå…ˆæŸ¥è¯¢åæ‰£å‡**
```java
// é”™è¯¯ç¤ºä¾‹
int stock = getStock(); // æŸ¥è¯¢åº“å­˜ï¼š10000
if (stock > 0) {
    stock = stock - 1; // æ‰£å‡åº“å­˜ï¼š9999
    updateStock(stock); // æ›´æ–°åº“å­˜
}
// é—®é¢˜ï¼šä¸¤ä¸ªç”¨æˆ·åŒæ—¶æŸ¥è¯¢åˆ°10000ï¼Œéƒ½æ‰£å‡æˆåŠŸï¼Œå®é™…æ‰£å‡äº†2æ¬¡
```

**é”™è¯¯æ–¹æ¡ˆ2ï¼šæ•°æ®åº“åŠ é”**
```sql
-- é”™è¯¯ç¤ºä¾‹
SELECT stock FROM coupon WHERE id = 1 FOR UPDATE; -- åŠ é”
UPDATE coupon SET stock = stock - 1 WHERE id = 1; -- æ‰£å‡
COMMIT; -- é‡Šæ”¾é”
-- é—®é¢˜ï¼šQPSåªæœ‰100-200ï¼Œæ— æ³•æ”¯æ’‘833æ¬¡/ç§’
```

**æ­£ç¡®æ–¹æ¡ˆï¼šRedis + Luaè„šæœ¬**
```lua
-- Luaè„šæœ¬ï¼ˆåŸå­æ€§ï¼‰
if tonumber(redis.call('get', KEYS[1])) > 0 then
    return redis.call('decr', KEYS[1])
else
    return 0
end
```

**ä¸ºä»€ä¹ˆRedis + Luaå¯ä»¥é˜²è¶…å–ï¼Ÿ**
- Rediså•çº¿ç¨‹ï¼Œå¤©ç„¶åŸå­æ€§
- Luaè„šæœ¬åœ¨Redisä¸­åŸå­æ‰§è¡Œ
- ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜


### ç¬¬22å±‚ï¼šæŒ‘æˆ˜2 - ç¬æ—¶æµé‡æ´ªå³°ï¼ˆç³»ç»Ÿå´©æºƒï¼‰

**é—®é¢˜æè¿°ï¼š**
- å‰30ç§’QPS 1666æ¬¡/ç§’ï¼Œæ˜¯å¹³æ—¶çš„666å€
- 10å°æœåŠ¡å™¨èƒ½å¦æ‰›ä½ï¼Ÿ
- æ•°æ®åº“èƒ½å¦æ‰›ä½ï¼Ÿ

**é£é™©åˆ†æï¼š**
1. **åº”ç”¨æœåŠ¡å™¨å´©æºƒ**ï¼š
   - å•æœºQPS 100ï¼Œ10å°æœåŠ¡å™¨QPS 1000
   - å³°å€¼QPS 1666ï¼Œè¶…è¿‡æœåŠ¡å™¨æ‰¿è½½èƒ½åŠ›
   - ç»“æœï¼šæœåŠ¡å™¨CPU 100%ï¼Œå“åº”è¶…æ—¶ï¼Œç”¨æˆ·çœ‹åˆ°"ç³»ç»Ÿç¹å¿™"

2. **æ•°æ®åº“å´©æºƒ**ï¼š
   - MySQLå•æœºQPS 1000-2000ï¼ˆå†™æ“ä½œï¼‰
   - å¦‚æœç›´æ¥å†™MySQLï¼ŒQPS 1666ä¼šæ‰“å®æ•°æ®åº“
   - ç»“æœï¼šæ•°æ®åº“è¿æ¥æ± è€—å°½ï¼Œæ‰€æœ‰è¯·æ±‚å¤±è´¥

3. **Rediså´©æºƒ**ï¼š
   - Rediså•æœºQPS 10ä¸‡+ï¼ˆè¯»æ“ä½œï¼‰
   - Redisä¸ä¼šå´©æºƒï¼Œä½†ç½‘ç»œå¸¦å®½å¯èƒ½æ‰“æ»¡
   - ç»“æœï¼šRediså“åº”å˜æ…¢ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´å˜é•¿

**æ­£ç¡®æ–¹æ¡ˆï¼š**
1. **Sentinelé™æµ**ï¼šQPSé™åˆ¶1000ï¼Œè¶…è¿‡çš„è¯·æ±‚ç›´æ¥è¿”å›"ç³»ç»Ÿç¹å¿™"
2. **Redisæ‰›ä½è¯»å†™**ï¼šåº“å­˜æ‰£å‡åœ¨Redisï¼Œä¸æ‰“MySQL
3. **Kafkaå¼‚æ­¥å†™å…¥**ï¼šæŠ¢åˆ¸æˆåŠŸåï¼Œå¼‚æ­¥å†™å…¥MySQL
4. **æå‰æ‰©å®¹**ï¼šæ´»åŠ¨å‰æ‰©å®¹åˆ°10å°æœåŠ¡å™¨

---

### ç¬¬23å±‚ï¼šæŒ‘æˆ˜3 - ç”¨æˆ·ä½“éªŒï¼ˆå“åº”æ—¶é—´ï¼‰

**é—®é¢˜æè¿°ï¼š**
- ç”¨æˆ·ç‚¹å‡»"ç«‹å³æŠ¢åˆ¸"åï¼Œå¤šä¹…èƒ½çœ‹åˆ°ç»“æœï¼Ÿ
- å“åº”æ—¶é—´è¶…è¿‡3ç§’ï¼Œç”¨æˆ·ä¼šè®¤ä¸ºç³»ç»Ÿå¡æ­»

**å“åº”æ—¶é—´åˆ†è§£ï¼š**
```
ç”¨æˆ·ç‚¹å‡»ï¼ˆ0msï¼‰
â†’ å‰ç«¯é˜²é‡å¤ç‚¹å‡»ï¼ˆ10msï¼‰
â†’ ç½‘ç»œä¼ è¾“ï¼ˆ50msï¼‰
â†’ Nginxè½¬å‘ï¼ˆ10msï¼‰
â†’ Sentinelé™æµï¼ˆ5msï¼‰
â†’ éªŒè¯ç æ ¡éªŒï¼ˆ20msï¼‰
â†’ IPé™æµï¼ˆ5msï¼‰
â†’ RedisæŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²é¢†å–ï¼ˆ5msï¼‰
â†’ Redisæ‰£å‡åº“å­˜ï¼ˆ10msï¼‰
â†’ ç”Ÿæˆä¼˜æƒ åˆ¸ç ï¼ˆ5msï¼‰
â†’ å‘é€Kafkaæ¶ˆæ¯ï¼ˆ10msï¼‰
â†’ è¿”å›ç»“æœï¼ˆ50msï¼‰
â†’ å‰ç«¯æ¸²æŸ“ï¼ˆ50msï¼‰
æ€»è®¡ï¼š230ms
```

**ä¼˜åŒ–ç›®æ ‡ï¼š**
- å“åº”æ—¶é—´ < 500msï¼šç”¨æˆ·æ„Ÿè§‰å¾ˆå¿«
- å“åº”æ—¶é—´ 500-1000msï¼šç”¨æˆ·å¯ä»¥æ¥å—
- å“åº”æ—¶é—´ > 1000msï¼šç”¨æˆ·è®¤ä¸ºç³»ç»Ÿå¡

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
1. **Rediså°±è¿‘éƒ¨ç½²**ï¼šå‡å°‘ç½‘ç»œå»¶è¿Ÿ
2. **Kafkaå¼‚æ­¥**ï¼šä¸ç­‰å¾…MySQLå†™å…¥
3. **å‰ç«¯ä¼˜åŒ–**ï¼šé˜²é‡å¤ç‚¹å‡»ã€loadingåŠ¨ç”»
4. **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºCDNåŠ é€Ÿ

---

### ç¬¬24å±‚ï¼šæŒ‘æˆ˜4 - é˜²åˆ·ï¼ˆç¾Šæ¯›å…šï¼‰

**é—®é¢˜æè¿°ï¼š**
- ç¾Šæ¯›å…šç”¨è„šæœ¬åˆ·åˆ¸ï¼Œ1ç§’ç‚¹å‡»100æ¬¡
- ç¾Šæ¯›å…šç”¨å¤šä¸ªè´¦å·åˆ·åˆ¸ï¼Œ1äººé¢†å–100å¼ 
- ç¾Šæ¯›å…šç”¨ä»£ç†IPåˆ·åˆ¸ï¼Œç»•è¿‡IPé™æµ

**é˜²åˆ·æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1ï¼šéªŒè¯ç **
- ç”¨æˆ·ç‚¹å‡»"ç«‹å³æŠ¢åˆ¸"åï¼Œå¼¹å‡ºéªŒè¯ç 
- éªŒè¯ç ç±»å‹ï¼šæ»‘åŠ¨éªŒè¯ç ï¼ˆä¸æ˜¯å›¾ç‰‡éªŒè¯ç ï¼‰
- æ•ˆæœï¼šé˜²æ­¢è„šæœ¬åˆ·åˆ¸

**æ–¹æ¡ˆ2ï¼šIPé™æµ**
- 1åˆ†é’Ÿå†…åŒä¸€IPæœ€å¤šè¯·æ±‚10æ¬¡
- è¶…è¿‡10æ¬¡ï¼Œè¿”å›"è¯·æ±‚è¿‡äºé¢‘ç¹"
- æ•ˆæœï¼šé˜²æ­¢å•ä¸ªIPåˆ·åˆ¸

**æ–¹æ¡ˆ3ï¼šç”¨æˆ·é™æµ**
- æ¯ä¸ªç”¨æˆ·åªèƒ½é¢†å–1å¼ åˆ¸
- Redisè®°å½•ç”¨æˆ·é¢†å–è®°å½•
- æ•ˆæœï¼šé˜²æ­¢å¤šè´¦å·åˆ·åˆ¸

**æ–¹æ¡ˆ4ï¼šè®¾å¤‡æŒ‡çº¹**
- è®°å½•ç”¨æˆ·è®¾å¤‡ä¿¡æ¯ï¼ˆæµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿã€å±å¹•åˆ†è¾¨ç‡ï¼‰
- åŒä¸€è®¾å¤‡åªèƒ½é¢†å–1å¼ åˆ¸
- æ•ˆæœï¼šé˜²æ­¢æ¢è´¦å·åˆ·åˆ¸

**æ–¹æ¡ˆ5ï¼šè¡Œä¸ºåˆ†æ**
- è®°å½•ç”¨æˆ·ç‚¹å‡»æ—¶é—´é—´éš”
- æ­£å¸¸ç”¨æˆ·ï¼šç‚¹å‡»é—´éš” > 1ç§’
- è„šæœ¬åˆ·åˆ¸ï¼šç‚¹å‡»é—´éš” < 0.1ç§’
- æ•ˆæœï¼šè¯†åˆ«è„šæœ¬åˆ·åˆ¸

---

### ç¬¬25å±‚ï¼šæŒ‘æˆ˜5 - æ•°æ®ä¸€è‡´æ€§ï¼ˆRedis vs MySQLï¼‰

**é—®é¢˜æè¿°ï¼š**
- Redisæ‰£å‡åº“å­˜æˆåŠŸï¼Œä½†Kafkaæ¶ˆæ¯ä¸¢å¤±ï¼ŒMySQLæ²¡æœ‰è®°å½•
- ç”¨æˆ·çœ‹åˆ°"æŠ¢åˆ¸æˆåŠŸ"ï¼Œä½†æŸ¥è¯¢ä¼˜æƒ åˆ¸åˆ—è¡¨ä¸ºç©º
- æ•°æ®ä¸ä¸€è‡´

**ä¸€è‡´æ€§é—®é¢˜åœºæ™¯ï¼š**

**åœºæ™¯1ï¼šKafkaæ¶ˆæ¯ä¸¢å¤±**
```
Redisæ‰£å‡åº“å­˜æˆåŠŸï¼ˆåº“å­˜9999ï¼‰
â†’ å‘é€Kafkaæ¶ˆæ¯
â†’ Kafkaå®•æœºï¼Œæ¶ˆæ¯ä¸¢å¤±
â†’ MySQLæ²¡æœ‰è®°å½•
â†’ ç”¨æˆ·æŸ¥è¯¢ä¼˜æƒ åˆ¸åˆ—è¡¨ä¸ºç©º
```

**åœºæ™¯2ï¼šKafkaæ¶ˆè´¹å¤±è´¥**
```
Redisæ‰£å‡åº“å­˜æˆåŠŸï¼ˆåº“å­˜9999ï¼‰
â†’ å‘é€Kafkaæ¶ˆæ¯æˆåŠŸ
â†’ Kafkaæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯
â†’ å†™å…¥MySQLå¤±è´¥ï¼ˆæ•°æ®åº“å®•æœºï¼‰
â†’ MySQLæ²¡æœ‰è®°å½•
â†’ ç”¨æˆ·æŸ¥è¯¢ä¼˜æƒ åˆ¸åˆ—è¡¨ä¸ºç©º
```

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1ï¼šKafkaæ¶ˆæ¯é‡è¯•**
- Kafkaæ¶ˆè´¹å¤±è´¥åï¼Œè‡ªåŠ¨é‡è¯•3æ¬¡
- é‡è¯•é—´éš”ï¼š1ç§’ã€5ç§’ã€10ç§’
- 3æ¬¡é‡è¯•åä»å¤±è´¥ï¼Œè®°å½•åˆ°æ­»ä¿¡é˜Ÿåˆ—

**æ–¹æ¡ˆ2ï¼šå®šæ—¶ä»»åŠ¡è¡¥å¿**
- æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å®šæ—¶ä»»åŠ¡
- å¯¹æ¯”Rediså’ŒMySQLæ•°æ®
- å‘ç°ä¸ä¸€è‡´ï¼Œè¡¥å¿å†™å…¥MySQL

**æ–¹æ¡ˆ3ï¼šç”¨æˆ·æŸ¥è¯¢æ—¶è¡¥å¿**
- ç”¨æˆ·æŸ¥è¯¢ä¼˜æƒ åˆ¸åˆ—è¡¨æ—¶ï¼Œå…ˆæŸ¥MySQL
- å¦‚æœMySQLæ²¡æœ‰ï¼Œå†æŸ¥Redis
- å¦‚æœRedisæœ‰ï¼Œè¡¥å¿å†™å…¥MySQL

---

### ç¬¬26å±‚ï¼šæŒ‘æˆ˜6 - ç¼“å­˜ç©¿é€ï¼ˆæ¶æ„è¯·æ±‚ï¼‰

**é—®é¢˜æè¿°ï¼š**
- æ¶æ„ç”¨æˆ·è¯·æ±‚ä¸å­˜åœ¨çš„æ´»åŠ¨ID
- Redisæ²¡æœ‰ï¼ŒæŸ¥è¯¢MySQL
- MySQLä¹Ÿæ²¡æœ‰ï¼Œè¿”å›ç©º
- å¤§é‡æ¶æ„è¯·æ±‚æ‰“ç©¿ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°MySQL

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1ï¼šå¸ƒéš†è¿‡æ»¤å™¨**
- æ´»åŠ¨å¼€å§‹å‰ï¼Œå°†æ‰€æœ‰æ´»åŠ¨IDåŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨
- è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå…ˆæŸ¥å¸ƒéš†è¿‡æ»¤å™¨
- å¸ƒéš†è¿‡æ»¤å™¨è¿”å›"ä¸å­˜åœ¨"ï¼Œç›´æ¥è¿”å›"æ´»åŠ¨ä¸å­˜åœ¨"
- å¸ƒéš†è¿‡æ»¤å™¨è¿”å›"å¯èƒ½å­˜åœ¨"ï¼Œå†æŸ¥Redis

**æ–¹æ¡ˆ2ï¼šç¼“å­˜ç©ºå€¼**
- æŸ¥è¯¢MySQLåï¼Œå¦‚æœæ´»åŠ¨ä¸å­˜åœ¨ï¼Œç¼“å­˜ç©ºå€¼
- ä¸‹æ¬¡è¯·æ±‚ç›´æ¥è¿”å›"æ´»åŠ¨ä¸å­˜åœ¨"
- TTLè®¾ç½®ä¸º5åˆ†é’Ÿ

---

### ç¬¬27å±‚ï¼šæŒ‘æˆ˜7 - ç¼“å­˜é›ªå´©ï¼ˆRediså®•æœºï¼‰

**é—®é¢˜æè¿°ï¼š**
- Rediså®•æœºï¼Œæ‰€æœ‰è¯·æ±‚æ‰“åˆ°MySQL
- MySQLæ‰›ä¸ä½ï¼Œç³»ç»Ÿå´©æºƒ

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1ï¼šRedisé›†ç¾¤ï¼ˆ3ä¸»3ä»ï¼‰**
- ä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨åˆ‡æ¢
- é«˜å¯ç”¨ï¼Œä¸ä¼šå•ç‚¹æ•…éšœ

**æ–¹æ¡ˆ2ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰**
- åº”ç”¨æœåŠ¡å™¨æœ¬åœ°ç¼“å­˜æ´»åŠ¨ä¿¡æ¯
- Rediså®•æœºæ—¶ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜
- TTLè®¾ç½®ä¸º5åˆ†é’Ÿ

**æ–¹æ¡ˆ3ï¼šé™çº§æ–¹æ¡ˆ**
- Rediså®•æœºæ—¶ï¼Œç›´æ¥è¿”å›"ç³»ç»Ÿç¹å¿™"
- ä¸æŸ¥è¯¢MySQLï¼Œä¿æŠ¤æ•°æ®åº“

---

### ç¬¬28å±‚ï¼šæŒ‘æˆ˜8 - çƒ­ç‚¹æ•°æ®ï¼ˆå•Keyå‹åŠ›ï¼‰

**é—®é¢˜æè¿°ï¼š**
- æ‰€æœ‰è¯·æ±‚éƒ½è®¿é—®åŒä¸€ä¸ªKeyï¼š`coupon:stock:1001`
- å•ä¸ªRedisèŠ‚ç‚¹QPS 10ä¸‡+ï¼Œä½†å•Key QPSåªæœ‰5ä¸‡
- å•Keyæˆä¸ºç“¶é¢ˆ

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1ï¼šåˆ†æ®µåº“å­˜**
- å°†10000å¼ åˆ¸åˆ†æˆ10æ®µï¼Œæ¯æ®µ1000å¼ 
- Keyï¼š`coupon:stock:1001:1` ~ `coupon:stock:1001:10`
- è¯·æ±‚éšæœºè®¿é—®10ä¸ªKeyä¸­çš„ä¸€ä¸ª
- å•Keyå‹åŠ›é™ä½10å€

**æ–¹æ¡ˆ2ï¼šæœ¬åœ°æ‰£å‡ + å®šæ—¶åŒæ­¥**
- æ¯å°æœåŠ¡å™¨åˆ†é…1000å¼ åˆ¸
- æœ¬åœ°æ‰£å‡åº“å­˜ï¼Œä¸è®¿é—®Redis
- æ¯ç§’åŒæ­¥ä¸€æ¬¡Redis
- é—®é¢˜ï¼šå¯èƒ½è¶…å–ï¼ˆ10å°æœåŠ¡å™¨å„æ‰£å‡1000å¼ ï¼Œå®é™…æ‰£å‡10000å¼ ï¼‰

---

### ç¬¬29å±‚ï¼šæŒ‘æˆ˜9 - ç½‘ç»œæŠ–åŠ¨ï¼ˆè¶…æ—¶é‡è¯•ï¼‰

**é—®é¢˜æè¿°ï¼š**
- ç”¨æˆ·ç‚¹å‡»"ç«‹å³æŠ¢åˆ¸"ï¼Œç½‘ç»œæŠ–åŠ¨ï¼Œè¯·æ±‚è¶…æ—¶
- ç”¨æˆ·é‡æ–°ç‚¹å‡»ï¼Œé‡å¤æ‰£å‡åº“å­˜
- ç”¨æˆ·é¢†å–äº†2å¼ åˆ¸

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1ï¼šå¹‚ç­‰æ€§è®¾è®¡**
- æ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€IDï¼ˆrequestIdï¼‰
- Redisè®°å½•requestId
- é‡å¤è¯·æ±‚ç›´æ¥è¿”å›"å·²å¤„ç†"

**æ–¹æ¡ˆ2ï¼šå‰ç«¯é˜²é‡å¤ç‚¹å‡»**
- ç”¨æˆ·ç‚¹å‡»åï¼ŒæŒ‰é’®ç½®ç°ï¼Œç¦æ­¢å†æ¬¡ç‚¹å‡»
- ç­‰å¾…å“åº”åï¼ŒæŒ‰é’®æ¢å¤

**æ–¹æ¡ˆ3ï¼šåç«¯å»é‡**
- Redisè®°å½•ç”¨æˆ·é¢†å–è®°å½•
- é‡å¤è¯·æ±‚ç›´æ¥è¿”å›"æ‚¨å·²é¢†å–è¿‡"

---

### ç¬¬30å±‚ï¼šæŠ€æœ¯æŒ‘æˆ˜æ€»ç»“

| æŒ‘æˆ˜ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| **åº“å­˜æ‰£å‡** | é˜²è¶…å– | Redis + Luaè„šæœ¬ | P0 |
| **æµé‡æ´ªå³°** | ç³»ç»Ÿå´©æºƒ | Sentinelé™æµ + æ‰©å®¹ | P0 |
| **ç”¨æˆ·ä½“éªŒ** | å“åº”æ…¢ | Redis + Kafkaå¼‚æ­¥ | P0 |
| **é˜²åˆ·** | ç¾Šæ¯›å…š | éªŒè¯ç  + IPé™æµ | P0 |
| **æ•°æ®ä¸€è‡´æ€§** | Redis vs MySQL | Kafkaé‡è¯• + å®šæ—¶è¡¥å¿ | P1 |
| **ç¼“å­˜ç©¿é€** | æ¶æ„è¯·æ±‚ | å¸ƒéš†è¿‡æ»¤å™¨ | P1 |
| **ç¼“å­˜é›ªå´©** | Rediså®•æœº | Redisé›†ç¾¤ + é™çº§ | P1 |
| **çƒ­ç‚¹æ•°æ®** | å•Keyå‹åŠ› | åˆ†æ®µåº“å­˜ | P2 |
| **ç½‘ç»œæŠ–åŠ¨** | è¶…æ—¶é‡è¯• | å¹‚ç­‰æ€§è®¾è®¡ | P2 |

**æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆï¼š**
1. **Redis + Luaè„šæœ¬**ï¼šé˜²è¶…å–
2. **Sentinelé™æµ**ï¼šé˜²æµé‡æ´ªå³°
3. **Kafkaå¼‚æ­¥**ï¼šæå‡å“åº”é€Ÿåº¦
4. **éªŒè¯ç  + IPé™æµ**ï¼šé˜²åˆ·
5. **Redisé›†ç¾¤**ï¼šé«˜å¯ç”¨

---

## ç¬¬31-40å±‚ï¼šæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### ç¬¬31å±‚ï¼šSentinelé™æµé…ç½®

**Sentinelæ˜¯ä»€ä¹ˆï¼Ÿ**
- é˜¿é‡Œå¼€æºçš„æµé‡æ§åˆ¶ç»„ä»¶
- æ”¯æŒQPSé™æµã€å¹¶å‘çº¿ç¨‹æ•°é™æµã€ç†”æ–­é™çº§
- è½»é‡çº§ï¼Œæ€§èƒ½æŸè€— < 1%

**é™æµè§„åˆ™é…ç½®ï¼š**
```java
@Configuration
public class SentinelConfig {
    
    @PostConstruct
    public void initFlowRules() {
        List<FlowRule> rules = new ArrayList<>();
        
        // è§„åˆ™1ï¼šæŠ¢åˆ¸æ¥å£QPSé™æµ
        FlowRule rule1 = new FlowRule();
        rule1.setResource("grabCoupon"); // èµ„æºå
        rule1.setGrade(RuleConstant.FLOW_GRADE_QPS); // QPSé™æµ
        rule1.setCount(1000); // QPSé˜ˆå€¼ï¼š1000
        rule1.setStrategy(RuleConstant.STRATEGY_DIRECT); // ç›´æ¥æ‹’ç»
        rules.add(rule1);
        
        // è§„åˆ™2ï¼šæŸ¥è¯¢æ¥å£QPSé™æµ
        FlowRule rule2 = new FlowRule();
        rule2.setResource("queryCoupon");
        rule2.setGrade(RuleConstant.FLOW_GRADE_QPS);
        rule2.setCount(2000); // QPSé˜ˆå€¼ï¼š2000
        rules.add(rule2);
        
        // è§„åˆ™3ï¼šå¹¶å‘çº¿ç¨‹æ•°é™æµ
        FlowRule rule3 = new FlowRule();
        rule3.setResource("grabCoupon");
        rule3.setGrade(RuleConstant.FLOW_GRADE_THREAD); // çº¿ç¨‹æ•°é™æµ
        rule3.setCount(500); // æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼š500
        rules.add(rule3);
        
        FlowRuleManager.loadRules(rules);
    }
}
```

**ä¸ºä»€ä¹ˆQPSé™åˆ¶1000ï¼Ÿ**
- 10å°æœåŠ¡å™¨ï¼Œæ¯å°QPS 100
- æ€»QPSï¼š1000
- å³°å€¼QPS 1666ï¼Œè¶…è¿‡1000çš„è¯·æ±‚ç›´æ¥æ‹’ç»

**é™æµåçš„ç”¨æˆ·ä½“éªŒï¼š**
- è¶…è¿‡QPS 1000çš„è¯·æ±‚ï¼Œè¿”å›"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"
- ç”¨æˆ·çœ‹åˆ°æç¤ºï¼Œä¸ä¼šè®¤ä¸ºç³»ç»Ÿå´©æºƒ
- ä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‰“å®

---

### ç¬¬32å±‚ï¼šRedisé›†ç¾¤é…ç½®

**Redisé›†ç¾¤æ¶æ„ï¼š**
```
3ä¸»3ä»ï¼ˆ6ä¸ªèŠ‚ç‚¹ï¼‰
- Master1ï¼ˆ192.168.1.101:6379ï¼‰â†’ Slave1ï¼ˆ192.168.1.104:6379ï¼‰
- Master2ï¼ˆ192.168.1.102:6379ï¼‰â†’ Slave2ï¼ˆ192.168.1.105:6379ï¼‰
- Master3ï¼ˆ192.168.1.103:6379ï¼‰â†’ Slave3ï¼ˆ192.168.1.106:6379ï¼‰
```

**ä¸ºä»€ä¹ˆç”¨3ä¸»3ä»ï¼Ÿ**
- 3ä¸»ï¼šæ•°æ®åˆ†ç‰‡ï¼Œæå‡æ€§èƒ½
- 3ä»ï¼šé«˜å¯ç”¨ï¼Œä¸»èŠ‚ç‚¹å®•æœºè‡ªåŠ¨åˆ‡æ¢
- 6ä¸ªèŠ‚ç‚¹ï¼šæˆæœ¬å¯æ§ï¼Œæ€§èƒ½è¶³å¤Ÿ

**Redisé…ç½®ï¼š**
```yaml
spring:
  redis:
    cluster:
      nodes:
        - 192.168.1.101:6379
        - 192.168.1.102:6379
        - 192.168.1.103:6379
        - 192.168.1.104:6379
        - 192.168.1.105:6379
        - 192.168.1.106:6379
      max-redirects: 3 # æœ€å¤§é‡å®šå‘æ¬¡æ•°
    lettuce:
      pool:
        max-active: 200 # æœ€å¤§è¿æ¥æ•°
        max-idle: 50 # æœ€å¤§ç©ºé—²è¿æ¥æ•°
        min-idle: 10 # æœ€å°ç©ºé—²è¿æ¥æ•°
        max-wait: 3000ms # æœ€å¤§ç­‰å¾…æ—¶é—´
    timeout: 3000ms # è¶…æ—¶æ—¶é—´
```

**æ€§èƒ½æµ‹è¯•ï¼š**
- å•æœºQPSï¼š10ä¸‡+
- é›†ç¾¤QPSï¼š30ä¸‡+ï¼ˆ3ä¸»ï¼‰
- ä¼˜æƒ åˆ¸æŠ¢è´­QPSï¼š833æ¬¡/ç§’
- ç»“è®ºï¼šRedisé›†ç¾¤æ€§èƒ½è¶³å¤Ÿ

---

### ç¬¬33å±‚ï¼šLuaè„šæœ¬å®ç°ï¼ˆé˜²è¶…å–ï¼‰

**Luaè„šæœ¬ï¼š**
```lua
-- æ–‡ä»¶ï¼šcoupon_decr.lua
-- åŠŸèƒ½ï¼šåŸå­æ€§æ‰£å‡åº“å­˜

-- KEYS[1]ï¼šåº“å­˜Keyï¼ˆcoupon:stock:1001ï¼‰
-- KEYS[2]ï¼šç”¨æˆ·é¢†å–è®°å½•Keyï¼ˆcoupon:user:1001:{userId}ï¼‰
-- ARGV[1]ï¼šç”¨æˆ·ID

-- 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²é¢†å–
local userKey = KEYS[2]
if redis.call('exists', userKey) == 1 then
    return -1 -- ç”¨æˆ·å·²é¢†å–
end

-- 2. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
local stockKey = KEYS[1]
local stock = tonumber(redis.call('get', stockKey))
if stock == nil or stock <= 0 then
    return 0 -- åº“å­˜ä¸è¶³
end

-- 3. æ‰£å‡åº“å­˜
redis.call('decr', stockKey)

-- 4. æ ‡è®°ç”¨æˆ·å·²é¢†å–
redis.call('setex', userKey, 86400, '1') -- è¿‡æœŸæ—¶é—´1å¤©

-- 5. è¿”å›å‰©ä½™åº“å­˜
return redis.call('get', stockKey)
```

**Javaè°ƒç”¨Luaè„šæœ¬ï¼š**
```java
@Service
public class CouponService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean grabCoupon(Long userId, Long activityId) {
        // 1. å‡†å¤‡Luaè„šæœ¬
        String luaScript = "..."; // Luaè„šæœ¬å†…å®¹
        
        // 2. å‡†å¤‡å‚æ•°
        List<String> keys = Arrays.asList(
            "coupon:stock:" + activityId,
            "coupon:user:" + activityId + ":" + userId
        );
        
        // 3. æ‰§è¡ŒLuaè„šæœ¬
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            keys,
            String.valueOf(userId)
        );
        
        // 4. åˆ¤æ–­ç»“æœ
        if (result == -1) {
            throw new BusinessException("æ‚¨å·²é¢†å–è¿‡");
        } else if (result == 0) {
            throw new BusinessException("ä¼˜æƒ åˆ¸å·²æŠ¢å®Œ");
        } else {
            return true; // æŠ¢åˆ¸æˆåŠŸ
        }
    }
}
```

**ä¸ºä»€ä¹ˆLuaè„šæœ¬å¯ä»¥é˜²è¶…å–ï¼Ÿ**
- Rediså•çº¿ç¨‹æ‰§è¡ŒLuaè„šæœ¬
- Luaè„šæœ¬åŸå­æ€§æ‰§è¡Œï¼Œä¸ä¼šè¢«æ‰“æ–­
- ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜

---

### ç¬¬34å±‚ï¼šKafkaé…ç½®

**Kafkaé›†ç¾¤æ¶æ„ï¼š**
```
3ä¸ªBrokerèŠ‚ç‚¹
- Broker1ï¼ˆ192.168.1.201:9092ï¼‰
- Broker2ï¼ˆ192.168.1.202:9092ï¼‰
- Broker3ï¼ˆ192.168.1.203:9092ï¼‰
```

**Topicé…ç½®ï¼š**
```yaml
# Topicåç§°ï¼šcoupon-topic
partitions: 10 # åˆ†åŒºæ•°ï¼š10
replication-factor: 3 # å‰¯æœ¬æ•°ï¼š3
min.insync.replicas: 2 # æœ€å°åŒæ­¥å‰¯æœ¬æ•°ï¼š2
```

**ä¸ºä»€ä¹ˆåˆ†åŒºæ•°æ˜¯10ï¼Ÿ**
- 10å°åº”ç”¨æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨å¯¹åº”1ä¸ªåˆ†åŒº
- æå‡å¹¶å‘å†™å…¥èƒ½åŠ›
- åˆ†åŒºæ•° = æœåŠ¡å™¨æ•°

**ä¸ºä»€ä¹ˆå‰¯æœ¬æ•°æ˜¯3ï¼Ÿ**
- 3ä¸ªå‰¯æœ¬ï¼šé«˜å¯ç”¨
- 1ä¸ªä¸»å‰¯æœ¬ + 2ä¸ªä»å‰¯æœ¬
- ä¸»å‰¯æœ¬å®•æœºï¼Œä»å‰¯æœ¬è‡ªåŠ¨åˆ‡æ¢

**ç”Ÿäº§è€…é…ç½®ï¼š**
```yaml
spring:
  kafka:
    bootstrap-servers: 192.168.1.201:9092,192.168.1.202:9092,192.168.1.203:9092
    producer:
      acks: 1 # ç¡®è®¤æœºåˆ¶ï¼š1ï¼ˆä¸»å‰¯æœ¬ç¡®è®¤å³å¯ï¼‰
      retries: 3 # é‡è¯•æ¬¡æ•°ï¼š3
      batch-size: 16384 # æ‰¹é‡å¤§å°ï¼š16KB
      buffer-memory: 33554432 # ç¼“å†²åŒºå¤§å°ï¼š32MB
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
```

**æ¶ˆè´¹è€…é…ç½®ï¼š**
```yaml
spring:
  kafka:
    consumer:
      group-id: coupon-consumer-group
      auto-offset-reset: earliest # ä»æœ€æ—©çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹
      enable-auto-commit: false # æ‰‹åŠ¨æäº¤offset
      max-poll-records: 100 # æ¯æ¬¡æ‹‰å–100æ¡æ¶ˆæ¯
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
```

---

### ç¬¬35å±‚ï¼šéªŒè¯ç é˜²åˆ·

**éªŒè¯ç ç±»å‹é€‰æ‹©ï¼š**

| éªŒè¯ç ç±»å‹ | ç”¨æˆ·ä½“éªŒ | é˜²åˆ·æ•ˆæœ | æˆæœ¬ |
|-----------|---------|---------|------|
| **å›¾ç‰‡éªŒè¯ç ** | â­â­ å·® | â­â­â­ ä¸­ | å…è´¹ |
| **æ»‘åŠ¨éªŒè¯ç ** | â­â­â­â­ å¥½ | â­â­â­â­ å¥½ | ä»˜è´¹ |
| **ç‚¹é€‰éªŒè¯ç ** | â­â­â­ ä¸­ | â­â­â­â­ å¥½ | ä»˜è´¹ |
| **è¡Œä¸ºéªŒè¯ç ** | â­â­â­â­â­ å¾ˆå¥½ | â­â­â­â­â­ å¾ˆå¥½ | ä»˜è´¹ |

**é€‰æ‹©ï¼šæ»‘åŠ¨éªŒè¯ç ï¼ˆè…¾è®¯äº‘éªŒè¯ç ï¼‰**
- ç”¨æˆ·ä½“éªŒå¥½ï¼šæ»‘åŠ¨å³å¯ï¼Œä¸éœ€è¦è¾“å…¥
- é˜²åˆ·æ•ˆæœå¥½ï¼šè¯†åˆ«è„šæœ¬åˆ·åˆ¸
- æˆæœ¬å¯æ§ï¼šæŒ‰è°ƒç”¨æ¬¡æ•°è®¡è´¹ï¼Œ0.01å…ƒ/æ¬¡

**é›†æˆè…¾è®¯äº‘éªŒè¯ç ï¼š**
```java
@Service
public class CaptchaService {
    
    @Value("${tencent.captcha.appId}")
    private String appId;
    
    @Value("${tencent.captcha.appSecret}")
    private String appSecret;
    
    public boolean verifyCaptcha(String ticket, String randStr, String userIp) {
        // 1. æ„é€ è¯·æ±‚å‚æ•°
        Map<String, String> params = new HashMap<>();
        params.put("aid", appId);
        params.put("AppSecretKey", appSecret);
        params.put("Ticket", ticket);
        params.put("Randstr", randStr);
        params.put("UserIP", userIp);
        
        // 2. è°ƒç”¨è…¾è®¯äº‘éªŒè¯ç API
        String url = "https://ssl.captcha.qq.com/ticket/verify";
        String response = HttpUtil.post(url, params);
        
        // 3. è§£æå“åº”
        JSONObject json = JSON.parseObject(response);
        int code = json.getInteger("response");
        
        // 4. è¿”å›éªŒè¯ç»“æœ
        return code == 1; // 1è¡¨ç¤ºéªŒè¯æˆåŠŸ
    }
}
```

---

### ç¬¬36å±‚ï¼šIPé™æµå®ç°

**IPé™æµè§„åˆ™ï¼š**
- 1åˆ†é’Ÿå†…åŒä¸€IPæœ€å¤šè¯·æ±‚10æ¬¡
- è¶…è¿‡10æ¬¡ï¼Œè¿”å›"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"

**Rediså®ç°IPé™æµï¼š**
```java
@Service
public class IpLimitService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean checkIpLimit(String ip, Long activityId) {
        // 1. æ„é€ Key
        String key = "coupon:ip:" + activityId + ":" + ip;
        
        // 2. è·å–å½“å‰è¯·æ±‚æ¬¡æ•°
        String countStr = redisTemplate.opsForValue().get(key);
        int count = countStr == null ? 0 : Integer.parseInt(countStr);
        
        // 3. åˆ¤æ–­æ˜¯å¦è¶…è¿‡é™åˆ¶
        if (count >= 10) {
            return false; // è¶…è¿‡é™åˆ¶
        }
        
        // 4. è¯·æ±‚æ¬¡æ•°+1
        redisTemplate.opsForValue().increment(key, 1);
        
        // 5. è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ1åˆ†é’Ÿï¼‰
        if (count == 0) {
            redisTemplate.expire(key, 60, TimeUnit.SECONDS);
        }
        
        return true; // æœªè¶…è¿‡é™åˆ¶
    }
}
```

**ä¸ºä»€ä¹ˆé™åˆ¶10æ¬¡ï¼Ÿ**
- æ­£å¸¸ç”¨æˆ·ï¼šç‚¹å‡»2-3æ¬¡
- ç¾Šæ¯›å…šï¼šç‚¹å‡»100+æ¬¡
- 10æ¬¡æ˜¯åˆç†çš„é˜ˆå€¼

---

### ç¬¬37å±‚ï¼šå¹‚ç­‰æ€§è®¾è®¡

**ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿ**
- åŒä¸€ä¸ªè¯·æ±‚ï¼Œæ‰§è¡Œ1æ¬¡å’Œæ‰§è¡ŒNæ¬¡ï¼Œç»“æœä¸€æ ·
- é˜²æ­¢é‡å¤æ‰£å‡åº“å­˜

**å¹‚ç­‰æ€§å®ç°ï¼š**
```java
@Service
public class CouponService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean grabCoupon(Long userId, Long activityId, String requestId) {
        // 1. æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²å¤„ç†
        String idempotentKey = "coupon:idempotent:" + requestId;
        Boolean exists = redisTemplate.hasKey(idempotentKey);
        if (exists) {
            throw new BusinessException("è¯·æ±‚å·²å¤„ç†ï¼Œè¯·å‹¿é‡å¤æäº¤");
        }
        
        // 2. æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆæ‰£å‡åº“å­˜ï¼‰
        boolean success = decrStock(userId, activityId);
        
        // 3. æ ‡è®°è¯·æ±‚å·²å¤„ç†
        if (success) {
            redisTemplate.opsForValue().set(idempotentKey, "1", 10, TimeUnit.MINUTES);
        }
        
        return success;
    }
}
```

**requestIdç”Ÿæˆè§„åˆ™ï¼š**
```java
// å‰ç«¯ç”ŸæˆrequestId
String requestId = UUID.randomUUID().toString();

// æˆ–è€…ï¼šuserId + activityId + timestamp
String requestId = userId + "_" + activityId + "_" + System.currentTimeMillis();
```

---

### ç¬¬38å±‚ï¼šé™çº§æ–¹æ¡ˆ

**ä»€ä¹ˆæ˜¯é™çº§ï¼Ÿ**
- ç³»ç»Ÿå‹åŠ›å¤§æ—¶ï¼Œå…³é—­éæ ¸å¿ƒåŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨

**é™çº§åœºæ™¯ï¼š**

**åœºæ™¯1ï¼šRediså®•æœº**
- é™çº§æ–¹æ¡ˆï¼šç›´æ¥è¿”å›"ç³»ç»Ÿç¹å¿™"
- ä¸æŸ¥è¯¢MySQLï¼Œä¿æŠ¤æ•°æ®åº“

**åœºæ™¯2ï¼šKafkaå®•æœº**
- é™çº§æ–¹æ¡ˆï¼šåŒæ­¥å†™å…¥MySQL
- å“åº”æ—¶é—´å˜æ…¢ï¼Œä½†åŠŸèƒ½å¯ç”¨

**åœºæ™¯3ï¼šéªŒè¯ç æœåŠ¡å®•æœº**
- é™çº§æ–¹æ¡ˆï¼šè·³è¿‡éªŒè¯ç æ ¡éªŒ
- é£é™©ï¼šå¯èƒ½è¢«åˆ·åˆ¸

**é™çº§å¼€å…³é…ç½®ï¼š**
```yaml
# application.yml
coupon:
  degrade:
    redis: false # Redisé™çº§å¼€å…³
    kafka: false # Kafkaé™çº§å¼€å…³
    captcha: false # éªŒè¯ç é™çº§å¼€å…³
```

**é™çº§ä»£ç å®ç°ï¼š**
```java
@Service
public class CouponService {
    
    @Value("${coupon.degrade.redis}")
    private boolean redisDegrade;
    
    @Value("${coupon.degrade.captcha}")
    private boolean captchaDegrade;
    
    public boolean grabCoupon(Long userId, Long activityId, String captcha) {
        // 1. éªŒè¯ç æ ¡éªŒï¼ˆæ”¯æŒé™çº§ï¼‰
        if (!captchaDegrade) {
            boolean captchaValid = captchaService.verify(captcha);
            if (!captchaValid) {
                throw new BusinessException("éªŒè¯ç é”™è¯¯");
            }
        }
        
        // 2. Redisæ‰£å‡åº“å­˜ï¼ˆæ”¯æŒé™çº§ï¼‰
        if (!redisDegrade) {
            return decrStockByRedis(userId, activityId);
        } else {
            throw new BusinessException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
        }
    }
}
```

---

### ç¬¬39å±‚ï¼šç›‘æ§å‘Šè­¦

**ç›‘æ§æŒ‡æ ‡ï¼š**

**1. åº”ç”¨ç›‘æ§ï¼ˆPrometheus + Grafanaï¼‰**
- QPSï¼šæ¯ç§’è¯·æ±‚æ•°
- å“åº”æ—¶é—´ï¼šP50ã€P95ã€P99
- é”™è¯¯ç‡ï¼šå¤±è´¥è¯·æ±‚å æ¯”
- çº¿ç¨‹æ•°ï¼šæ´»è·ƒçº¿ç¨‹æ•°

**2. Redisç›‘æ§**
- QPSï¼šæ¯ç§’æ“ä½œæ•°
- å†…å­˜ä½¿ç”¨ç‡ï¼šå·²ç”¨å†…å­˜/æ€»å†…å­˜
- è¿æ¥æ•°ï¼šå½“å‰è¿æ¥æ•°
- å‘½ä¸­ç‡ï¼šç¼“å­˜å‘½ä¸­ç‡

**3. Kafkaç›‘æ§**
- ç”Ÿäº§é€Ÿç‡ï¼šæ¯ç§’ç”Ÿäº§æ¶ˆæ¯æ•°
- æ¶ˆè´¹é€Ÿç‡ï¼šæ¯ç§’æ¶ˆè´¹æ¶ˆæ¯æ•°
- æ¶ˆæ¯ç§¯å‹ï¼šæœªæ¶ˆè´¹æ¶ˆæ¯æ•°
- æ¶ˆè´¹å»¶è¿Ÿï¼šæ¶ˆæ¯ç”Ÿäº§åˆ°æ¶ˆè´¹çš„æ—¶é—´

**4. MySQLç›‘æ§**
- QPSï¼šæ¯ç§’æŸ¥è¯¢æ•°
- æ…¢æŸ¥è¯¢ï¼šæ‰§è¡Œæ—¶é—´ > 1ç§’çš„æŸ¥è¯¢
- è¿æ¥æ•°ï¼šå½“å‰è¿æ¥æ•°
- é”ç­‰å¾…ï¼šé”ç­‰å¾…æ—¶é—´

**å‘Šè­¦è§„åˆ™ï¼š**
```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
  - name: coupon-alerts
    rules:
      # è§„åˆ™1ï¼šQPSè¿‡é«˜
      - alert: HighQPS
        expr: rate(http_requests_total[1m]) > 1000
        for: 1m
        annotations:
          summary: "QPSè¿‡é«˜ï¼š{{ $value }}"
      
      # è§„åˆ™2ï¼šå“åº”æ—¶é—´è¿‡é•¿
      - alert: HighLatency
        expr: http_request_duration_seconds{quantile="0.95"} > 1
        for: 1m
        annotations:
          summary: "P95å“åº”æ—¶é—´è¿‡é•¿ï¼š{{ $value }}ç§’"
      
      # è§„åˆ™3ï¼šé”™è¯¯ç‡è¿‡é«˜
      - alert: HighErrorRate
        expr: rate(http_requests_total{status="500"}[1m]) > 10
        for: 1m
        annotations:
          summary: "é”™è¯¯ç‡è¿‡é«˜ï¼š{{ $value }}"
      
      # è§„åˆ™4ï¼šRediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
      - alert: HighRedisMemory
        expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.8
        for: 5m
        annotations:
          summary: "Rediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼š{{ $value }}"
```

---

### ç¬¬40å±‚ï¼šæŠ€æœ¯æ–¹æ¡ˆæ€»ç»“

**æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š**
```
å‰ç«¯ï¼šVue.js + é˜²é‡å¤ç‚¹å‡» + éªŒè¯ç 
    â†“
Nginxï¼šè´Ÿè½½å‡è¡¡ï¼ˆ10å°æœåŠ¡å™¨ï¼‰
    â†“
åº”ç”¨æœåŠ¡å™¨ï¼šSpring Boot + Sentinelé™æµ
    â†“
Redis Clusterï¼š3ä¸»3ä» + Luaè„šæœ¬
    â†“
Kafkaï¼š10åˆ†åŒº + 3å‰¯æœ¬
    â†“
MySQLï¼šä¸»ä»å¤åˆ¶ + åˆ†åº“åˆ†è¡¨
```

**æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”ï¼š**

| æŠ€æœ¯æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡ç”¨ |
|---------|------|------|---------|
| **Redis + Lua** | é˜²è¶…å–ã€æ€§èƒ½é«˜ | éœ€è¦Redisé›†ç¾¤ | âœ… é‡‡ç”¨ |
| **Sentinelé™æµ** | ä¿æŠ¤ç³»ç»Ÿã€é…ç½®ç®€å• | è¶…è¿‡é™åˆ¶çš„è¯·æ±‚è¢«æ‹’ç» | âœ… é‡‡ç”¨ |
| **Kafkaå¼‚æ­¥** | æå‡å“åº”é€Ÿåº¦ | æ•°æ®ä¸€è‡´æ€§é—®é¢˜ | âœ… é‡‡ç”¨ |
| **éªŒè¯ç ** | é˜²åˆ· | ç”¨æˆ·ä½“éªŒç¨å·® | âœ… é‡‡ç”¨ |
| **IPé™æµ** | é˜²åˆ· | å¯èƒ½è¯¯ä¼¤æ­£å¸¸ç”¨æˆ· | âœ… é‡‡ç”¨ |
| **æ•°æ®åº“é”** | ç®€å• | æ€§èƒ½å·® | âŒ ä¸é‡‡ç”¨ |
| **åˆ†å¸ƒå¼é”** | é˜²è¶…å– | æ€§èƒ½ä¸å¦‚Lua | âŒ ä¸é‡‡ç”¨ |

**æŠ€æœ¯é€‰å‹åŸåˆ™ï¼š**
1. **æ€§èƒ½ä¼˜å…ˆ**ï¼šRedis > MySQL
2. **ç®€å•ä¼˜å…ˆ**ï¼šLuaè„šæœ¬ > åˆ†å¸ƒå¼é”
3. **æˆæœ¬å¯æ§**ï¼šå¼€æºç»„ä»¶ > å•†ä¸šç»„ä»¶
4. **é«˜å¯ç”¨**ï¼šé›†ç¾¤ > å•æœº

---

## ç¬¬41-50å±‚ï¼šæ ¸å¿ƒä»£ç å®ç°

### ç¬¬41å±‚ï¼šControllerå±‚ï¼ˆæŠ¢åˆ¸æ¥å£ï¼‰

```java
@RestController
@RequestMapping("/api/coupon")
public class CouponController {
    
    @Autowired
    private CouponService couponService;
    
    @Autowired
    private CaptchaService captchaService;
    
    @Autowired
    private IpLimitService ipLimitService;
    
    /**
     * æŠ¢åˆ¸æ¥å£
     * 
     * @param request æŠ¢åˆ¸è¯·æ±‚
     * @return æŠ¢åˆ¸ç»“æœ
     */
    @PostMapping("/grab")
    @SentinelResource(value = "grabCoupon", blockHandler = "grabCouponBlockHandler")
    public Result<CouponVO> grabCoupon(@RequestBody @Validated GrabCouponRequest request,
                                        HttpServletRequest httpRequest) {
        // 1. è·å–ç”¨æˆ·ID
        Long userId = UserContext.getUserId();
        
        // 2. è·å–IPåœ°å€
        String ip = IpUtil.getIpAddress(httpRequest);
        
        // 3. IPé™æµï¼ˆ1åˆ†é’Ÿå†…æœ€å¤š10æ¬¡ï¼‰
        boolean ipAllowed = ipLimitService.checkIpLimit(ip, request.getActivityId());
        if (!ipAllowed) {
            return Result.fail("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
        }
        
        // 4. éªŒè¯ç æ ¡éªŒ
        boolean captchaValid = captchaService.verifyCaptcha(
            request.getCaptchaTicket(),
            request.getCaptchaRandStr(),
            ip
        );
        if (!captchaValid) {
            return Result.fail("éªŒè¯ç é”™è¯¯");
        }
        
        // 5. æŠ¢åˆ¸
        CouponVO coupon = couponService.grabCoupon(
            userId,
            request.getActivityId(),
            request.getRequestId()
        );
        
        return Result.success(coupon);
    }
    
    /**
     * Sentinelé™æµåçš„é™çº§æ–¹æ³•
     */
    public Result<CouponVO> grabCouponBlockHandler(GrabCouponRequest request,
                                                    HttpServletRequest httpRequest,
                                                    BlockException ex) {
        return Result.fail("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

**è¯·æ±‚å‚æ•°ï¼š**
```java
@Data
public class GrabCouponRequest {
    
    @NotNull(message = "æ´»åŠ¨IDä¸èƒ½ä¸ºç©º")
    private Long activityId;
    
    @NotBlank(message = "éªŒè¯ç ticketä¸èƒ½ä¸ºç©º")
    private String captchaTicket;
    
    @NotBlank(message = "éªŒè¯ç randSträ¸èƒ½ä¸ºç©º")
    private String captchaRandStr;
    
    @NotBlank(message = "è¯·æ±‚IDä¸èƒ½ä¸ºç©º")
    private String requestId;
}
```

**å“åº”å‚æ•°ï¼š**
```java
@Data
public class CouponVO {
    
    private Long id;
    
    private String couponCode; // ä¼˜æƒ åˆ¸ç 
    
    private BigDecimal amount; // ä¼˜æƒ é‡‘é¢
    
    private Date expireTime; // è¿‡æœŸæ—¶é—´
    
    private Integer status; // çŠ¶æ€ï¼ˆ0æœªä½¿ç”¨ã€1å·²ä½¿ç”¨ã€2å·²è¿‡æœŸï¼‰
}
```

---

### ç¬¬42å±‚ï¼šServiceå±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰

```java
@Service
public class CouponService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Autowired
    private KafkaTemplate<String, String> kafkaTemplate;
    
    @Autowired
    private CouponActivityMapper activityMapper;
    
    @Autowired
    private UserCouponMapper userCouponMapper;
    
    /**
     * æŠ¢åˆ¸
     */
    @Transactional(rollbackFor = Exception.class)
    public CouponVO grabCoupon(Long userId, Long activityId, String requestId) {
        // 1. å¹‚ç­‰æ€§æ ¡éªŒ
        checkIdempotent(requestId);
        
        // 2. æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯ï¼ˆRedisç¼“å­˜ï¼‰
        CouponActivity activity = getActivity(activityId);
        if (activity == null) {
            throw new BusinessException("æ´»åŠ¨ä¸å­˜åœ¨");
        }
        if (activity.getStatus() != 1) {
            throw new BusinessException("æ´»åŠ¨æœªå¼€å§‹æˆ–å·²ç»“æŸ");
        }
        
        // 3. Redisæ‰£å‡åº“å­˜ï¼ˆLuaè„šæœ¬ï¼‰
        Long remainStock = decrStock(userId, activityId);
        if (remainStock == null) {
            throw new BusinessException("ä¼˜æƒ åˆ¸å·²æŠ¢å®Œ");
        }
        
        // 4. ç”Ÿæˆä¼˜æƒ åˆ¸ç 
        String couponCode = generateCouponCode(userId, activityId);
        
        // 5. æ„é€ ä¼˜æƒ åˆ¸å¯¹è±¡
        UserCoupon coupon = new UserCoupon();
        coupon.setUserId(userId);
        coupon.setActivityId(activityId);
        coupon.setCouponCode(couponCode);
        coupon.setAmount(activity.getAmount());
        coupon.setStatus(0); // æœªä½¿ç”¨
        coupon.setExpireTime(activity.getEndTime());
        coupon.setCreateTime(new Date());
        
        // 6. å‘é€Kafkaæ¶ˆæ¯ï¼ˆå¼‚æ­¥å†™å…¥MySQLï¼‰
        sendKafkaMessage(coupon);
        
        // 7. æ ‡è®°è¯·æ±‚å·²å¤„ç†
        markIdempotent(requestId);
        
        // 8. è¿”å›ä¼˜æƒ åˆ¸ä¿¡æ¯
        return convertToVO(coupon);
    }
    
    /**
     * å¹‚ç­‰æ€§æ ¡éªŒ
     */
    private void checkIdempotent(String requestId) {
        String key = "coupon:idempotent:" + requestId;
        Boolean exists = redisTemplate.hasKey(key);
        if (exists) {
            throw new BusinessException("è¯·æ±‚å·²å¤„ç†ï¼Œè¯·å‹¿é‡å¤æäº¤");
        }
    }
    
    /**
     * æ ‡è®°è¯·æ±‚å·²å¤„ç†
     */
    private void markIdempotent(String requestId) {
        String key = "coupon:idempotent:" + requestId;
        redisTemplate.opsForValue().set(key, "1", 10, TimeUnit.MINUTES);
    }
    
    /**
     * æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯ï¼ˆRedisç¼“å­˜ï¼‰
     */
    private CouponActivity getActivity(Long activityId) {
        // 1. å…ˆæŸ¥Redis
        String key = "coupon:activity:" + activityId;
        String json = redisTemplate.opsForValue().get(key);
        if (json != null) {
            return JSON.parseObject(json, CouponActivity.class);
        }
        
        // 2. å†æŸ¥MySQL
        CouponActivity activity = activityMapper.selectById(activityId);
        if (activity != null) {
            // 3. å†™å…¥Redisï¼ˆè¿‡æœŸæ—¶é—´1å°æ—¶ï¼‰
            redisTemplate.opsForValue().set(key, JSON.toJSONString(activity), 1, TimeUnit.HOURS);
        }
        
        return activity;
    }
    
    /**
     * Redisæ‰£å‡åº“å­˜ï¼ˆLuaè„šæœ¬ï¼‰
     */
    private Long decrStock(Long userId, Long activityId) {
        // 1. å‡†å¤‡Luaè„šæœ¬
        String luaScript = 
            "local userKey = KEYS[2] " +
            "if redis.call('exists', userKey) == 1 then " +
            "    return -1 " +
            "end " +
            "local stockKey = KEYS[1] " +
            "local stock = tonumber(redis.call('get', stockKey)) " +
            "if stock == nil or stock <= 0 then " +
            "    return 0 " +
            "end " +
            "redis.call('decr', stockKey) " +
            "redis.call('setex', userKey, 86400, '1') " +
            "return redis.call('get', stockKey)";
        
        // 2. å‡†å¤‡å‚æ•°
        List<String> keys = Arrays.asList(
            "coupon:stock:" + activityId,
            "coupon:user:" + activityId + ":" + userId
        );
        
        // 3. æ‰§è¡ŒLuaè„šæœ¬
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            keys,
            String.valueOf(userId)
        );
        
        // 4. åˆ¤æ–­ç»“æœ
        if (result == -1) {
            throw new BusinessException("æ‚¨å·²é¢†å–è¿‡");
        } else if (result == 0) {
            return null; // åº“å­˜ä¸è¶³
        } else {
            return result; // è¿”å›å‰©ä½™åº“å­˜
        }
    }
    
    /**
     * ç”Ÿæˆä¼˜æƒ åˆ¸ç 
     * è§„åˆ™ï¼šPICC + æ´»åŠ¨ID(4ä½) + æ—¥æœŸ(8ä½) + åºå·(7ä½)
     * ç¤ºä¾‹ï¼šPICC1001202501011000001
     */
    private String generateCouponCode(Long userId, Long activityId) {
        String prefix = "PICC";
        String activityIdStr = String.format("%04d", activityId);
        String dateStr = DateUtil.format(new Date(), "yyyyMMdd");
        String seqStr = String.format("%07d", generateSeq());
        return prefix + activityIdStr + dateStr + seqStr;
    }
    
    /**
     * ç”Ÿæˆåºå·ï¼ˆRedisè‡ªå¢ï¼‰
     */
    private Long generateSeq() {
        String key = "coupon:seq:" + DateUtil.format(new Date(), "yyyyMMdd");
        return redisTemplate.opsForValue().increment(key, 1);
    }
    
    /**
     * å‘é€Kafkaæ¶ˆæ¯
     */
    private void sendKafkaMessage(UserCoupon coupon) {
        String topic = "coupon-topic";
        String message = JSON.toJSONString(coupon);
        kafkaTemplate.send(topic, message);
    }
    
    /**
     * è½¬æ¢ä¸ºVO
     */
    private CouponVO convertToVO(UserCoupon coupon) {
        CouponVO vo = new CouponVO();
        vo.setId(coupon.getId());
        vo.setCouponCode(coupon.getCouponCode());
        vo.setAmount(coupon.getAmount());
        vo.setExpireTime(coupon.getExpireTime());
        vo.setStatus(coupon.getStatus());
        return vo;
    }
}
```

---

### ç¬¬43å±‚ï¼šKafkaæ¶ˆè´¹è€…ï¼ˆå¼‚æ­¥å†™å…¥MySQLï¼‰

```java
@Component
public class CouponKafkaConsumer {
    
    @Autowired
    private UserCouponMapper userCouponMapper;
    
    @Autowired
    private CouponLogMapper couponLogMapper;
    
    /**
     * æ¶ˆè´¹Kafkaæ¶ˆæ¯ï¼Œå†™å…¥MySQL
     */
    @KafkaListener(topics = "coupon-topic", groupId = "coupon-consumer-group")
    public void consume(ConsumerRecord<String, String> record) {
        try {
            // 1. è§£ææ¶ˆæ¯
            String message = record.value();
            UserCoupon coupon = JSON.parseObject(message, UserCoupon.class);
            
            // 2. å†™å…¥MySQL
            userCouponMapper.insert(coupon);
            
            // 3. è®°å½•æ—¥å¿—
            CouponLog log = new CouponLog();
            log.setUserId(coupon.getUserId());
            log.setActivityId(coupon.getActivityId());
            log.setAction("grab");
            log.setResult(1); // æˆåŠŸ
            log.setCreateTime(new Date());
            couponLogMapper.insert(log);
            
            // 4. æ‰‹åŠ¨æäº¤offset
            // acknowledgment.acknowledge();
            
        } catch (Exception e) {
            // 5. æ¶ˆè´¹å¤±è´¥ï¼Œè®°å½•æ—¥å¿—
            log.error("æ¶ˆè´¹Kafkaæ¶ˆæ¯å¤±è´¥ï¼š{}", record.value(), e);
            
            // 6. é‡è¯•3æ¬¡åï¼Œå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—
            // ...
        }
    }
}
```

**ä¸ºä»€ä¹ˆå¼‚æ­¥å†™å…¥MySQLï¼Ÿ**
- åŒæ­¥å†™å…¥ï¼šå“åº”æ—¶é—´ = Redisæ‰£å‡(10ms) + MySQLå†™å…¥(50ms) = 60ms
- å¼‚æ­¥å†™å…¥ï¼šå“åº”æ—¶é—´ = Redisæ‰£å‡(10ms) = 10ms
- å“åº”æ—¶é—´æå‡83%

---

### ç¬¬44å±‚ï¼šå®šæ—¶ä»»åŠ¡ï¼ˆæ•°æ®ä¸€è‡´æ€§è¡¥å¿ï¼‰

```java
@Component
public class CouponCompensateTask {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Autowired
    private UserCouponMapper userCouponMapper;
    
    /**
     * æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œè¡¥å¿Rediså’ŒMySQLæ•°æ®ä¸ä¸€è‡´
     */
    @Scheduled(cron = "0 */5 * * * ?")
    public void compensate() {
        log.info("å¼€å§‹æ‰§è¡Œæ•°æ®ä¸€è‡´æ€§è¡¥å¿ä»»åŠ¡");
        
        // 1. æŸ¥è¯¢æ‰€æœ‰è¿›è¡Œä¸­çš„æ´»åŠ¨
        List<CouponActivity> activities = activityMapper.selectByStatus(1);
        
        for (CouponActivity activity : activities) {
            // 2. æŸ¥è¯¢Redisåº“å­˜
            String stockKey = "coupon:stock:" + activity.getId();
            String stockStr = redisTemplate.opsForValue().get(stockKey);
            if (stockStr == null) {
                continue;
            }
            int redisStock = Integer.parseInt(stockStr);
            
            // 3. æŸ¥è¯¢MySQLå·²é¢†å–æ•°é‡
            int mysqlCount = userCouponMapper.countByActivityId(activity.getId());
            
            // 4. è®¡ç®—å·®å¼‚
            int diff = activity.getTotalCount() - redisStock - mysqlCount;
            
            // 5. å¦‚æœå·®å¼‚ > 0ï¼Œè¯´æ˜æœ‰æ•°æ®ä¸¢å¤±ï¼Œéœ€è¦è¡¥å¿
            if (diff > 0) {
                log.warn("æ´»åŠ¨{}æ•°æ®ä¸ä¸€è‡´ï¼Œå·®å¼‚{}æ¡ï¼Œå¼€å§‹è¡¥å¿", activity.getId(), diff);
                
                // 6. æŸ¥è¯¢Redisä¸­å·²é¢†å–ä½†MySQLä¸­æ²¡æœ‰çš„ç”¨æˆ·
                Set<String> redisUsers = getRedisUsers(activity.getId());
                Set<Long> mysqlUsers = getMysqlUsers(activity.getId());
                
                for (String redisUser : redisUsers) {
                    Long userId = Long.parseLong(redisUser);
                    if (!mysqlUsers.contains(userId)) {
                        // 7. è¡¥å¿å†™å…¥MySQL
                        compensateUser(userId, activity);
                    }
                }
            }
        }
        
        log.info("æ•°æ®ä¸€è‡´æ€§è¡¥å¿ä»»åŠ¡æ‰§è¡Œå®Œæˆ");
    }
    
    /**
     * è·å–Redisä¸­å·²é¢†å–çš„ç”¨æˆ·
     */
    private Set<String> getRedisUsers(Long activityId) {
        String pattern = "coupon:user:" + activityId + ":*";
        Set<String> keys = redisTemplate.keys(pattern);
        Set<String> users = new HashSet<>();
        for (String key : keys) {
            String userId = key.substring(key.lastIndexOf(":") + 1);
            users.add(userId);
        }
        return users;
    }
    
    /**
     * è·å–MySQLä¸­å·²é¢†å–çš„ç”¨æˆ·
     */
    private Set<Long> getMysqlUsers(Long activityId) {
        List<UserCoupon> coupons = userCouponMapper.selectByActivityId(activityId);
        return coupons.stream().map(UserCoupon::getUserId).collect(Collectors.toSet());
    }
    
    /**
     * è¡¥å¿å†™å…¥MySQL
     */
    private void compensateUser(Long userId, CouponActivity activity) {
        UserCoupon coupon = new UserCoupon();
        coupon.setUserId(userId);
        coupon.setActivityId(activity.getId());
        coupon.setCouponCode(generateCouponCode(userId, activity.getId()));
        coupon.setAmount(activity.getAmount());
        coupon.setStatus(0);
        coupon.setExpireTime(activity.getEndTime());
        coupon.setCreateTime(new Date());
        userCouponMapper.insert(coupon);
        
        log.info("è¡¥å¿ç”¨æˆ·{}çš„ä¼˜æƒ åˆ¸", userId);
    }
}
```

---

### ç¬¬45å±‚ï¼šæŸ¥è¯¢ä¼˜æƒ åˆ¸æ¥å£

```java
@RestController
@RequestMapping("/api/coupon")
public class CouponController {
    
    @Autowired
    private CouponService couponService;
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨
     */
    @GetMapping("/list")
    public Result<List<CouponVO>> listCoupons() {
        Long userId = UserContext.getUserId();
        List<CouponVO> coupons = couponService.listCoupons(userId);
        return Result.success(coupons);
    }
}
```

```java
@Service
public class CouponService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Autowired
    private UserCouponMapper userCouponMapper;
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨
     */
    public List<CouponVO> listCoupons(Long userId) {
        // 1. å…ˆæŸ¥Redisç¼“å­˜
        String key = "coupon:list:" + userId;
        String json = redisTemplate.opsForValue().get(key);
        if (json != null) {
            return JSON.parseArray(json, CouponVO.class);
        }
        
        // 2. å†æŸ¥MySQL
        List<UserCoupon> coupons = userCouponMapper.selectByUserId(userId);
        List<CouponVO> vos = coupons.stream()
            .map(this::convertToVO)
            .collect(Collectors.toList());
        
        // 3. å†™å…¥Redisç¼“å­˜ï¼ˆè¿‡æœŸæ—¶é—´1å°æ—¶ï¼‰
        redisTemplate.opsForValue().set(key, JSON.toJSONString(vos), 1, TimeUnit.HOURS);
        
        return vos;
    }
}
```

---

### ç¬¬46å±‚ï¼šä½¿ç”¨ä¼˜æƒ åˆ¸æ¥å£

```java
@RestController
@RequestMapping("/api/coupon")
public class CouponController {
    
    @Autowired
    private CouponService couponService;
    
    /**
     * ä½¿ç”¨ä¼˜æƒ åˆ¸
     */
    @PostMapping("/use")
    public Result<Void> useCoupon(@RequestBody @Validated UseCouponRequest request) {
        Long userId = UserContext.getUserId();
        couponService.useCoupon(userId, request.getCouponCode(), request.getOrderId());
        return Result.success();
    }
}
```

```java
@Service
public class CouponService {
    
    @Autowired
    private UserCouponMapper userCouponMapper;
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * ä½¿ç”¨ä¼˜æƒ åˆ¸
     */
    @Transactional(rollbackFor = Exception.class)
    public void useCoupon(Long userId, String couponCode, Long orderId) {
        // 1. æŸ¥è¯¢ä¼˜æƒ åˆ¸
        UserCoupon coupon = userCouponMapper.selectByCouponCode(couponCode);
        if (coupon == null) {
            throw new BusinessException("ä¼˜æƒ åˆ¸ä¸å­˜åœ¨");
        }
        if (!coupon.getUserId().equals(userId)) {
            throw new BusinessException("ä¼˜æƒ åˆ¸ä¸å±äºæ‚¨");
        }
        if (coupon.getStatus() != 0) {
            throw new BusinessException("ä¼˜æƒ åˆ¸å·²ä½¿ç”¨æˆ–å·²è¿‡æœŸ");
        }
        if (coupon.getExpireTime().before(new Date())) {
            throw new BusinessException("ä¼˜æƒ åˆ¸å·²è¿‡æœŸ");
        }
        
        // 2. æ›´æ–°ä¼˜æƒ åˆ¸çŠ¶æ€
        coupon.setStatus(1); // å·²ä½¿ç”¨
        coupon.setOrderId(orderId);
        coupon.setUseTime(new Date());
        userCouponMapper.updateById(coupon);
        
        // 3. åˆ é™¤Redisç¼“å­˜
        String key = "coupon:list:" + userId;
        redisTemplate.delete(key);
        
        // 4. è®°å½•æ—¥å¿—
        CouponLog log = new CouponLog();
        log.setUserId(userId);
        log.setActivityId(coupon.getActivityId());
        log.setAction("use");
        log.setResult(1);
        log.setCreateTime(new Date());
        couponLogMapper.insert(log);
    }
}
```

---

### ç¬¬47å±‚ï¼šæ´»åŠ¨åˆå§‹åŒ–ï¼ˆRedisåº“å­˜åˆå§‹åŒ–ï¼‰

```java
@Service
public class CouponActivityService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Autowired
    private CouponActivityMapper activityMapper;
    
    /**
     * åˆå§‹åŒ–æ´»åŠ¨ï¼ˆRedisåº“å­˜åˆå§‹åŒ–ï¼‰
     */
    public void initActivity(Long activityId) {
        // 1. æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯
        CouponActivity activity = activityMapper.selectById(activityId);
        if (activity == null) {
            throw new BusinessException("æ´»åŠ¨ä¸å­˜åœ¨");
        }
        
        // 2. åˆå§‹åŒ–Redisåº“å­˜
        String stockKey = "coupon:stock:" + activityId;
        redisTemplate.opsForValue().set(stockKey, String.valueOf(activity.getTotalCount()));
        
        // 3. è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ´»åŠ¨ç»“æŸå1å¤©ï¼‰
        long ttl = (activity.getEndTime().getTime() - System.currentTimeMillis()) / 1000 + 86400;
        redisTemplate.expire(stockKey, ttl, TimeUnit.SECONDS);
        
        log.info("æ´»åŠ¨{}åˆå§‹åŒ–æˆåŠŸï¼Œåº“å­˜{}", activityId, activity.getTotalCount());
    }
}
```

**æ´»åŠ¨åˆå§‹åŒ–æ—¶æœºï¼š**
- æ´»åŠ¨åˆ›å»ºæ—¶ï¼šç®¡ç†å‘˜åˆ›å»ºæ´»åŠ¨åï¼Œè‡ªåŠ¨åˆå§‹åŒ–Redisåº“å­˜
- æ´»åŠ¨å¼€å§‹å‰ï¼šå®šæ—¶ä»»åŠ¡åœ¨æ´»åŠ¨å¼€å§‹å‰5åˆ†é’Ÿï¼Œæ£€æŸ¥Redisåº“å­˜æ˜¯å¦åˆå§‹åŒ–

---

### ç¬¬48å±‚ï¼šå‰ç«¯é˜²é‡å¤ç‚¹å‡»

```javascript
// Vue.jså‰ç«¯ä»£ç 
export default {
  data() {
    return {
      loading: false, // åŠ è½½çŠ¶æ€
      requestId: '', // è¯·æ±‚ID
    }
  },
  methods: {
    // æŠ¢åˆ¸
    async grabCoupon() {
      // 1. é˜²é‡å¤ç‚¹å‡»
      if (this.loading) {
        this.$message.warning('è¯·å‹¿é‡å¤ç‚¹å‡»');
        return;
      }
      
      // 2. ç”Ÿæˆè¯·æ±‚ID
      this.requestId = this.generateRequestId();
      
      // 3. æ˜¾ç¤ºloading
      this.loading = true;
      
      try {
        // 4. è°ƒç”¨æŠ¢åˆ¸æ¥å£
        const response = await this.$http.post('/api/coupon/grab', {
          activityId: this.activityId,
          captchaTicket: this.captchaTicket,
          captchaRandStr: this.captchaRandStr,
          requestId: this.requestId,
        });
        
        // 5. æŠ¢åˆ¸æˆåŠŸ
        if (response.code === 200) {
          this.$message.success('æŠ¢åˆ¸æˆåŠŸ');
          this.showCoupon(response.data);
        } else {
          this.$message.error(response.message);
        }
      } catch (error) {
        this.$message.error('ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•');
      } finally {
        // 6. éšè—loading
        this.loading = false;
      }
    },
    
    // ç”Ÿæˆè¯·æ±‚ID
    generateRequestId() {
      const userId = this.$store.state.user.id;
      const activityId = this.activityId;
      const timestamp = Date.now();
      return `${userId}_${activityId}_${timestamp}`;
    },
  },
}
```

---

### ç¬¬49å±‚ï¼šNginxé…ç½®ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰

```nginx
# nginx.conf
upstream coupon_backend {
    # è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šIP Hashï¼ˆåŒä¸€IPè¯·æ±‚åŒä¸€å°æœåŠ¡å™¨ï¼‰
    ip_hash;
    
    # 10å°åº”ç”¨æœåŠ¡å™¨
    server 192.168.1.11:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.13:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.14:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.15:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.16:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.17:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.18:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.19:8080 weight=1 max_fails=3 fail_timeout=30s;
    server 192.168.1.20:8080 weight=1 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name coupon.picc.com;
    
    location /api/coupon/ {
        proxy_pass http://coupon_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # è¶…æ—¶æ—¶é—´
        proxy_connect_timeout 3s;
        proxy_send_timeout 3s;
        proxy_read_timeout 3s;
    }
}
```

**ä¸ºä»€ä¹ˆç”¨IP Hashï¼Ÿ**
- åŒä¸€IPè¯·æ±‚åŒä¸€å°æœåŠ¡å™¨
- åˆ©ç”¨æœåŠ¡å™¨æœ¬åœ°ç¼“å­˜
- å‡å°‘Rediså‹åŠ›

---

### ç¬¬50å±‚ï¼šæ ¸å¿ƒä»£ç æ€»ç»“

**ä»£ç ç»“æ„ï¼š**
```
Controllerå±‚ï¼šæ¥æ”¶è¯·æ±‚ã€å‚æ•°æ ¡éªŒã€è°ƒç”¨Service
    â†“
Serviceå±‚ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€Redisæ‰£å‡åº“å­˜ã€å‘é€Kafkaæ¶ˆæ¯
    â†“
Kafkaæ¶ˆè´¹è€…ï¼šå¼‚æ­¥å†™å…¥MySQL
    â†“
å®šæ—¶ä»»åŠ¡ï¼šæ•°æ®ä¸€è‡´æ€§è¡¥å¿
```

**æ ¸å¿ƒä»£ç è¡Œæ•°ç»Ÿè®¡ï¼š**
- Controllerå±‚ï¼š100è¡Œ
- Serviceå±‚ï¼š300è¡Œ
- Kafkaæ¶ˆè´¹è€…ï¼š50è¡Œ
- å®šæ—¶ä»»åŠ¡ï¼š100è¡Œ
- Luaè„šæœ¬ï¼š20è¡Œ
- å‰ç«¯ä»£ç ï¼š50è¡Œ
- Nginxé…ç½®ï¼š30è¡Œ
- æ€»è®¡ï¼š650è¡Œ

**ä»£ç å¤æ‚åº¦ï¼š**
- æ ¸å¿ƒé€»è¾‘ï¼šRedis + Luaè„šæœ¬ï¼ˆ20è¡Œï¼‰
- è¾…åŠ©é€»è¾‘ï¼šå¹‚ç­‰æ€§ã€é™æµã€éªŒè¯ç ã€è¡¥å¿ï¼ˆ530è¡Œï¼‰
- é…ç½®ä»£ç ï¼šNginxã€Sentinelã€Kafkaï¼ˆ100è¡Œï¼‰

**ä»£ç ä¼˜åŒ–ç©ºé—´ï¼š**
- âœ… ä»£ç ç®€æ´ï¼šæ ¸å¿ƒé€»è¾‘åªæœ‰20è¡Œ
- âœ… å¯ç»´æŠ¤æ€§ï¼šåˆ†å±‚æ¸…æ™°ï¼ŒèŒè´£å•ä¸€
- âœ… å¯æ‰©å±•æ€§ï¼šæ”¯æŒå¤šæ´»åŠ¨ã€å¤šè§„åˆ™
- âœ… å¯æµ‹è¯•æ€§ï¼šå•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

---

## ç¬¬51-60å±‚ï¼šå‹æµ‹ä¸ä¼˜åŒ–

### ç¬¬51å±‚ï¼šå‹æµ‹ç¯å¢ƒå‡†å¤‡

**å‹æµ‹ç¯å¢ƒï¼š**
```
åº”ç”¨æœåŠ¡å™¨ï¼š10å°ï¼ˆ4æ ¸8Gï¼‰
Redisé›†ç¾¤ï¼š3ä¸»3ä»ï¼ˆ8æ ¸16Gï¼‰
Kafkaé›†ç¾¤ï¼š3ä¸ªBrokerï¼ˆ8æ ¸16Gï¼‰
MySQLï¼š1ä¸»2ä»ï¼ˆ16æ ¸32Gï¼‰
Nginxï¼š2å°ï¼ˆ4æ ¸8Gï¼‰
```

**å‹æµ‹å·¥å…·ï¼š**
- JMeter 5.5ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚ï¼‰
- Prometheus + Grafanaï¼ˆç›‘æ§ï¼‰
- Arthasï¼ˆJavaè¯Šæ–­å·¥å…·ï¼‰

**å‹æµ‹æ•°æ®å‡†å¤‡ï¼š**
```sql
-- 1. åˆ›å»ºæ´»åŠ¨
INSERT INTO wcar_coupon_activity (id, activity_name, total_count, remain_count, amount, start_time, end_time, status)
VALUES (1001, 'å¼€é—¨çº¢ä¼˜æƒ åˆ¸', 10000, 10000, 200.00, '2025-01-01 10:00:00', '2025-01-31 23:59:59', 1);

-- 2. åˆå§‹åŒ–Redisåº“å­˜
SET coupon:stock:1001 10000

-- 3. å‡†å¤‡10ä¸‡ä¸ªæµ‹è¯•ç”¨æˆ·
-- user_id: 1 ~ 100000
```

---

### ç¬¬52å±‚ï¼šå‹æµ‹åœºæ™¯è®¾è®¡

**åœºæ™¯1ï¼šæ­£å¸¸æŠ¢åˆ¸ï¼ˆQPS 833ï¼‰**
- å¹¶å‘ç”¨æˆ·ï¼š10ä¸‡äºº
- æŒç»­æ—¶é—´ï¼š3åˆ†é’Ÿ
- é¢„æœŸQPSï¼š833æ¬¡/ç§’
- é¢„æœŸæˆåŠŸç‡ï¼š10%ï¼ˆ10000å¼ åˆ¸ / 100000äººï¼‰

**åœºæ™¯2ï¼šå³°å€¼æŠ¢åˆ¸ï¼ˆQPS 1666ï¼‰**
- å¹¶å‘ç”¨æˆ·ï¼š15ä¸‡äºº
- æŒç»­æ—¶é—´ï¼šå‰30ç§’
- é¢„æœŸQPSï¼š1666æ¬¡/ç§’
- é¢„æœŸæˆåŠŸç‡ï¼š6.7%ï¼ˆ10000å¼ åˆ¸ / 150000äººï¼‰

**åœºæ™¯3ï¼šæé™å‹æµ‹ï¼ˆQPS 3000ï¼‰**
- å¹¶å‘ç”¨æˆ·ï¼š20ä¸‡äºº
- æŒç»­æ—¶é—´ï¼š1åˆ†é’Ÿ
- é¢„æœŸQPSï¼š3000æ¬¡/ç§’
- é¢„æœŸæˆåŠŸç‡ï¼š5%ï¼ˆ10000å¼ åˆ¸ / 200000äººï¼‰

**JMeteré…ç½®ï¼š**
```xml
<!-- çº¿ç¨‹ç»„é…ç½® -->
<ThreadGroup>
    <stringProp name="ThreadGroup.num_threads">100000</stringProp> <!-- 10ä¸‡çº¿ç¨‹ -->
    <stringProp name="ThreadGroup.ramp_time">180</stringProp> <!-- 3åˆ†é’Ÿå¯åŠ¨å®Œæˆ -->
    <stringProp name="ThreadGroup.duration">180</stringProp> <!-- æŒç»­3åˆ†é’Ÿ -->
</ThreadGroup>

<!-- HTTPè¯·æ±‚é…ç½® -->
<HTTPSamplerProxy>
    <stringProp name="HTTPSampler.domain">coupon.picc.com</stringProp>
    <stringProp name="HTTPSampler.port">80</stringProp>
    <stringProp name="HTTPSampler.path">/api/coupon/grab</stringProp>
    <stringProp name="HTTPSampler.method">POST</stringProp>
    <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
</HTTPSamplerProxy>
```

---

### ç¬¬53å±‚ï¼šå‹æµ‹ç»“æœï¼ˆåœºæ™¯1ï¼šQPS 833ï¼‰

**å‹æµ‹æ•°æ®ï¼š**
```
æ€»è¯·æ±‚æ•°ï¼š150000æ¬¡ï¼ˆ10ä¸‡äºº Ã— å¹³å‡1.5æ¬¡ç‚¹å‡»ï¼‰
æˆåŠŸè¯·æ±‚ï¼š10000æ¬¡ï¼ˆæŠ¢åˆ°åˆ¸ï¼‰
å¤±è´¥è¯·æ±‚ï¼š140000æ¬¡ï¼ˆå·²æŠ¢å®Œã€ç³»ç»Ÿç¹å¿™ï¼‰
æŒç»­æ—¶é—´ï¼š3åˆ†é’Ÿ = 180ç§’
å®é™…QPSï¼š150000 Ã· 180 = 833æ¬¡/ç§’
æˆåŠŸç‡ï¼š10000 Ã· 150000 = 6.7%
```

**å“åº”æ—¶é—´åˆ†å¸ƒï¼š**
```
P50ï¼š230msï¼ˆ50%çš„è¯·æ±‚åœ¨230mså†…å®Œæˆï¼‰
P95ï¼š450msï¼ˆ95%çš„è¯·æ±‚åœ¨450mså†…å®Œæˆï¼‰
P99ï¼š800msï¼ˆ99%çš„è¯·æ±‚åœ¨800mså†…å®Œæˆï¼‰
æœ€å¤§å“åº”æ—¶é—´ï¼š1200ms
å¹³å‡å“åº”æ—¶é—´ï¼š280ms
```

**ç³»ç»Ÿèµ„æºä½¿ç”¨ï¼š**
```
åº”ç”¨æœåŠ¡å™¨CPUï¼š60-70%
åº”ç”¨æœåŠ¡å™¨å†…å­˜ï¼š4GB / 8GB = 50%
Redis CPUï¼š30-40%
Rediså†…å­˜ï¼š2GB / 16GB = 12.5%
MySQL CPUï¼š10-20%ï¼ˆKafkaå¼‚æ­¥å†™å…¥ï¼Œå‹åŠ›å°ï¼‰
MySQLè¿æ¥æ•°ï¼š50 / 1000 = 5%
Kafkaæ¶ˆæ¯ç§¯å‹ï¼š0ï¼ˆæ¶ˆè´¹é€Ÿåº¦ > ç”Ÿäº§é€Ÿåº¦ï¼‰
```

**ç»“è®ºï¼š**
- âœ… QPS 833ï¼Œç³»ç»Ÿç¨³å®š
- âœ… å“åº”æ—¶é—´ < 500msï¼ˆP95ï¼‰
- âœ… æˆåŠŸç‡ 6.7%ï¼Œç¬¦åˆé¢„æœŸ
- âœ… ç³»ç»Ÿèµ„æºä½¿ç”¨åˆç†ï¼Œæœ‰ä½™é‡

---

### ç¬¬54å±‚ï¼šå‹æµ‹ç»“æœï¼ˆåœºæ™¯2ï¼šQPS 1666ï¼‰

**å‹æµ‹æ•°æ®ï¼š**
```
æ€»è¯·æ±‚æ•°ï¼š50000æ¬¡ï¼ˆå‰30ç§’ï¼‰
æˆåŠŸè¯·æ±‚ï¼š5000æ¬¡ï¼ˆæŠ¢åˆ°åˆ¸ï¼‰
å¤±è´¥è¯·æ±‚ï¼š45000æ¬¡ï¼ˆç³»ç»Ÿç¹å¿™ã€å·²æŠ¢å®Œï¼‰
æŒç»­æ—¶é—´ï¼š30ç§’
å®é™…QPSï¼š50000 Ã· 30 = 1666æ¬¡/ç§’
æˆåŠŸç‡ï¼š5000 Ã· 50000 = 10%
```

**å“åº”æ—¶é—´åˆ†å¸ƒï¼š**
```
P50ï¼š350ms
P95ï¼š800ms
P99ï¼š1500ms
æœ€å¤§å“åº”æ—¶é—´ï¼š3000ms
å¹³å‡å“åº”æ—¶é—´ï¼š500ms
```

**ç³»ç»Ÿèµ„æºä½¿ç”¨ï¼š**
```
åº”ç”¨æœåŠ¡å™¨CPUï¼š80-90%ï¼ˆæ¥è¿‘ç“¶é¢ˆï¼‰
åº”ç”¨æœåŠ¡å™¨å†…å­˜ï¼š5GB / 8GB = 62.5%
Redis CPUï¼š50-60%
Rediså†…å­˜ï¼š2.5GB / 16GB = 15.6%
MySQL CPUï¼š15-25%
Kafkaæ¶ˆæ¯ç§¯å‹ï¼š500æ¡ï¼ˆæ¶ˆè´¹é€Ÿåº¦ < ç”Ÿäº§é€Ÿåº¦ï¼‰
```

**Sentinelé™æµæ•ˆæœï¼š**
```
æ€»è¯·æ±‚æ•°ï¼š50000æ¬¡
é€šè¿‡é™æµï¼š30000æ¬¡ï¼ˆQPS 1000ï¼‰
è¢«é™æµï¼š20000æ¬¡ï¼ˆQPS 666ï¼‰
é™æµç‡ï¼š20000 Ã· 50000 = 40%
```

**ç»“è®ºï¼š**
- âœ… QPS 1666ï¼Œç³»ç»Ÿç¨³å®šï¼ˆSentinelé™æµä¿æŠ¤ï¼‰
- âš ï¸ å“åº”æ—¶é—´ P95 = 800msï¼Œç¨æ…¢
- âœ… 40%çš„è¯·æ±‚è¢«é™æµï¼Œä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‰“å®
- âš ï¸ åº”ç”¨æœåŠ¡å™¨CPU 80-90%ï¼Œæ¥è¿‘ç“¶é¢ˆ

---

### ç¬¬55å±‚ï¼šå‹æµ‹ç»“æœï¼ˆåœºæ™¯3ï¼šQPS 3000ï¼‰

**å‹æµ‹æ•°æ®ï¼š**
```
æ€»è¯·æ±‚æ•°ï¼š180000æ¬¡ï¼ˆ1åˆ†é’Ÿï¼‰
æˆåŠŸè¯·æ±‚ï¼š5000æ¬¡ï¼ˆæŠ¢åˆ°åˆ¸ï¼‰
å¤±è´¥è¯·æ±‚ï¼š175000æ¬¡ï¼ˆç³»ç»Ÿç¹å¿™ï¼‰
æŒç»­æ—¶é—´ï¼š60ç§’
å®é™…QPSï¼š180000 Ã· 60 = 3000æ¬¡/ç§’
æˆåŠŸç‡ï¼š5000 Ã· 180000 = 2.8%
```

**å“åº”æ—¶é—´åˆ†å¸ƒï¼š**
```
P50ï¼š500ms
P95ï¼š1500ms
P99ï¼š3000ms
æœ€å¤§å“åº”æ—¶é—´ï¼š5000ms
å¹³å‡å“åº”æ—¶é—´ï¼š800ms
```

**ç³»ç»Ÿèµ„æºä½¿ç”¨ï¼š**
```
åº”ç”¨æœåŠ¡å™¨CPUï¼š95-100%ï¼ˆç“¶é¢ˆï¼‰
åº”ç”¨æœåŠ¡å™¨å†…å­˜ï¼š6GB / 8GB = 75%
Redis CPUï¼š70-80%
Rediså†…å­˜ï¼š3GB / 16GB = 18.75%
MySQL CPUï¼š20-30%
Kafkaæ¶ˆæ¯ç§¯å‹ï¼š2000æ¡ï¼ˆæ¶ˆè´¹é€Ÿåº¦ << ç”Ÿäº§é€Ÿåº¦ï¼‰
```

**Sentinelé™æµæ•ˆæœï¼š**
```
æ€»è¯·æ±‚æ•°ï¼š180000æ¬¡
é€šè¿‡é™æµï¼š60000æ¬¡ï¼ˆQPS 1000ï¼‰
è¢«é™æµï¼š120000æ¬¡ï¼ˆQPS 2000ï¼‰
é™æµç‡ï¼š120000 Ã· 180000 = 66.7%
```

**ç»“è®ºï¼š**
- âš ï¸ QPS 3000ï¼Œç³»ç»Ÿå‹åŠ›å¤§
- âŒ å“åº”æ—¶é—´ P95 = 1500msï¼Œå¤ªæ…¢
- âœ… 66.7%çš„è¯·æ±‚è¢«é™æµï¼Œä¿æŠ¤ç³»ç»Ÿ
- âŒ åº”ç”¨æœåŠ¡å™¨CPU 100%ï¼Œç“¶é¢ˆ
- âš ï¸ Kafkaæ¶ˆæ¯ç§¯å‹2000æ¡ï¼Œéœ€è¦ä¼˜åŒ–

---

### ç¬¬56å±‚ï¼šæ€§èƒ½ç“¶é¢ˆåˆ†æ

**ç“¶é¢ˆ1ï¼šåº”ç”¨æœåŠ¡å™¨CPU 100%**
- åŸå› ï¼šå•æœºQPS 100ï¼Œ10å°æœåŠ¡å™¨QPS 1000ï¼Œå³°å€¼QPS 3000è¶…è¿‡æ‰¿è½½èƒ½åŠ›
- è§£å†³æ–¹æ¡ˆï¼šæ‰©å®¹åˆ°30å°æœåŠ¡å™¨ï¼ˆQPS 3000ï¼‰

**ç“¶é¢ˆ2ï¼šKafkaæ¶ˆæ¯ç§¯å‹**
- åŸå› ï¼šç”Ÿäº§é€Ÿåº¦ > æ¶ˆè´¹é€Ÿåº¦
- è§£å†³æ–¹æ¡ˆï¼šå¢åŠ æ¶ˆè´¹è€…æ•°é‡ï¼ˆ10ä¸ª â†’ 20ä¸ªï¼‰

**ç“¶é¢ˆ3ï¼šå“åº”æ—¶é—´è¿‡é•¿**
- åŸå› ï¼šéªŒè¯ç æ ¡éªŒè€—æ—¶20ms
- è§£å†³æ–¹æ¡ˆï¼šéªŒè¯ç å¼‚æ­¥æ ¡éªŒ

**ç“¶é¢ˆ4ï¼šRediså•Keyå‹åŠ›**
- åŸå› ï¼šæ‰€æœ‰è¯·æ±‚è®¿é—®åŒä¸€ä¸ªKeyï¼š`coupon:stock:1001`
- è§£å†³æ–¹æ¡ˆï¼šåˆ†æ®µåº“å­˜ï¼ˆ10ä¸ªKeyï¼‰

**ä½¿ç”¨Arthasè¯Šæ–­ï¼š**
```bash
# 1. æŸ¥çœ‹æœ€è€—æ—¶çš„æ–¹æ³•
$ trace com.picc.coupon.service.CouponService grabCoupon

# 2. æŸ¥çœ‹æ–¹æ³•è°ƒç”¨é“¾
$ stack com.picc.coupon.service.CouponService grabCoupon

# 3. æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€
$ thread -n 10

# 4. æŸ¥çœ‹JVMå†…å­˜
$ memory
```

---

### ç¬¬57å±‚ï¼šæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

**ä¼˜åŒ–1ï¼šæ‰©å®¹åº”ç”¨æœåŠ¡å™¨**
- ä¼˜åŒ–å‰ï¼š10å°æœåŠ¡å™¨ï¼ŒQPS 1000
- ä¼˜åŒ–åï¼š30å°æœåŠ¡å™¨ï¼ŒQPS 3000
- æ•ˆæœï¼šæ”¯æ’‘QPS 3000

**ä¼˜åŒ–2ï¼šå¢åŠ Kafkaæ¶ˆè´¹è€…**
- ä¼˜åŒ–å‰ï¼š10ä¸ªæ¶ˆè´¹è€…
- ä¼˜åŒ–åï¼š20ä¸ªæ¶ˆè´¹è€…
- æ•ˆæœï¼šæ¶ˆæ¯ç§¯å‹ä»2000æ¡é™åˆ°0

**ä¼˜åŒ–3ï¼šéªŒè¯ç å¼‚æ­¥æ ¡éªŒ**
```java
// ä¼˜åŒ–å‰ï¼šåŒæ­¥æ ¡éªŒï¼ˆè€—æ—¶20msï¼‰
boolean captchaValid = captchaService.verifyCaptcha(ticket, randStr, ip);
if (!captchaValid) {
    throw new BusinessException("éªŒè¯ç é”™è¯¯");
}

// ä¼˜åŒ–åï¼šå¼‚æ­¥æ ¡éªŒï¼ˆè€—æ—¶5msï¼‰
CompletableFuture<Boolean> future = CompletableFuture.supplyAsync(() -> {
    return captchaService.verifyCaptcha(ticket, randStr, ip);
});
// å…ˆæ‰£å‡åº“å­˜ï¼Œå†æ ¡éªŒéªŒè¯ç 
boolean success = decrStock(userId, activityId);
boolean captchaValid = future.get(100, TimeUnit.MILLISECONDS);
if (!captchaValid) {
    // å›æ»šåº“å­˜
    rollbackStock(userId, activityId);
    throw new BusinessException("éªŒè¯ç é”™è¯¯");
}
```

**ä¼˜åŒ–4ï¼šåˆ†æ®µåº“å­˜**
```java
// ä¼˜åŒ–å‰ï¼šå•Key
String stockKey = "coupon:stock:1001";

// ä¼˜åŒ–åï¼š10ä¸ªKey
int segment = userId.hashCode() % 10; // 0-9
String stockKey = "coupon:stock:1001:" + segment;
```

**ä¼˜åŒ–5ï¼šæœ¬åœ°ç¼“å­˜æ´»åŠ¨ä¿¡æ¯**
```java
// ä¼˜åŒ–å‰ï¼šæ¯æ¬¡æŸ¥è¯¢Redis
CouponActivity activity = getActivityFromRedis(activityId);

// ä¼˜åŒ–åï¼šæœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰
@Cacheable(value = "activity", key = "#activityId")
public CouponActivity getActivity(Long activityId) {
    return activityMapper.selectById(activityId);
}
```

---

### ç¬¬58å±‚ï¼šä¼˜åŒ–åå‹æµ‹ç»“æœï¼ˆQPS 3000ï¼‰

**å‹æµ‹æ•°æ®ï¼š**
```
æ€»è¯·æ±‚æ•°ï¼š180000æ¬¡ï¼ˆ1åˆ†é’Ÿï¼‰
æˆåŠŸè¯·æ±‚ï¼š10000æ¬¡ï¼ˆæŠ¢åˆ°åˆ¸ï¼‰
å¤±è´¥è¯·æ±‚ï¼š170000æ¬¡ï¼ˆç³»ç»Ÿç¹å¿™ã€å·²æŠ¢å®Œï¼‰
æŒç»­æ—¶é—´ï¼š60ç§’
å®é™…QPSï¼š180000 Ã· 60 = 3000æ¬¡/ç§’
æˆåŠŸç‡ï¼š10000 Ã· 180000 = 5.6%
```

**å“åº”æ—¶é—´åˆ†å¸ƒï¼š**
```
P50ï¼š200msï¼ˆä¼˜åŒ–å‰350msï¼Œæå‡43%ï¼‰
P95ï¼š500msï¼ˆä¼˜åŒ–å‰1500msï¼Œæå‡67%ï¼‰
P99ï¼š1000msï¼ˆä¼˜åŒ–å‰3000msï¼Œæå‡67%ï¼‰
æœ€å¤§å“åº”æ—¶é—´ï¼š2000msï¼ˆä¼˜åŒ–å‰5000msï¼Œæå‡60%ï¼‰
å¹³å‡å“åº”æ—¶é—´ï¼š300msï¼ˆä¼˜åŒ–å‰800msï¼Œæå‡62.5%ï¼‰
```

**ç³»ç»Ÿèµ„æºä½¿ç”¨ï¼š**
```
åº”ç”¨æœåŠ¡å™¨CPUï¼š60-70%ï¼ˆä¼˜åŒ–å‰95-100%ï¼‰
åº”ç”¨æœåŠ¡å™¨å†…å­˜ï¼š4GB / 8GB = 50%
Redis CPUï¼š40-50%ï¼ˆä¼˜åŒ–å‰70-80%ï¼‰
Rediså†…å­˜ï¼š3GB / 16GB = 18.75%
MySQL CPUï¼š15-25%
Kafkaæ¶ˆæ¯ç§¯å‹ï¼š0ï¼ˆä¼˜åŒ–å‰2000æ¡ï¼‰
```

**ä¼˜åŒ–æ•ˆæœå¯¹æ¯”ï¼š**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **P50å“åº”æ—¶é—´** | 350ms | 200ms | 43% |
| **P95å“åº”æ—¶é—´** | 1500ms | 500ms | 67% |
| **P99å“åº”æ—¶é—´** | 3000ms | 1000ms | 67% |
| **åº”ç”¨æœåŠ¡å™¨CPU** | 95-100% | 60-70% | 30% |
| **Redis CPU** | 70-80% | 40-50% | 30% |
| **Kafkaæ¶ˆæ¯ç§¯å‹** | 2000æ¡ | 0æ¡ | 100% |

**ç»“è®ºï¼š**
- âœ… QPS 3000ï¼Œç³»ç»Ÿç¨³å®š
- âœ… å“åº”æ—¶é—´ P95 = 500msï¼Œç¬¦åˆé¢„æœŸ
- âœ… åº”ç”¨æœåŠ¡å™¨CPU 60-70%ï¼Œæœ‰ä½™é‡
- âœ… Kafkaæ¶ˆæ¯ç§¯å‹ä¸º0ï¼Œæ¶ˆè´¹åŠæ—¶

---

### ç¬¬59å±‚ï¼šç›‘æ§å¤§ç›˜

**Grafanaç›‘æ§å¤§ç›˜ï¼š**

**é¢æ¿1ï¼šQPSç›‘æ§**
```
å®æ—¶QPSï¼š833æ¬¡/ç§’
å³°å€¼QPSï¼š1666æ¬¡/ç§’
å¹³å‡QPSï¼š500æ¬¡/ç§’
```

**é¢æ¿2ï¼šå“åº”æ—¶é—´ç›‘æ§**
```
P50ï¼š200ms
P95ï¼š500ms
P99ï¼š1000ms
```

**é¢æ¿3ï¼šæˆåŠŸç‡ç›‘æ§**
```
æˆåŠŸç‡ï¼š6.7%
å¤±è´¥ç‡ï¼š93.3%
- å·²æŠ¢å®Œï¼š60%
- ç³»ç»Ÿç¹å¿™ï¼š30%
- éªŒè¯ç é”™è¯¯ï¼š3%
- å…¶ä»–ï¼š0.3%
```

**é¢æ¿4ï¼šç³»ç»Ÿèµ„æºç›‘æ§**
```
åº”ç”¨æœåŠ¡å™¨CPUï¼š60-70%
åº”ç”¨æœåŠ¡å™¨å†…å­˜ï¼š50%
Redis CPUï¼š40-50%
Rediså†…å­˜ï¼š18.75%
MySQL CPUï¼š15-25%
Kafkaæ¶ˆæ¯ç§¯å‹ï¼š0
```

**é¢æ¿5ï¼šä¸šåŠ¡ç›‘æ§**
```
å·²æŠ¢åˆ¸æ•°ï¼š10000å¼ 
å‰©ä½™åˆ¸æ•°ï¼š0å¼ 
å‚ä¸äººæ•°ï¼š100000äºº
æŠ¢åˆ¸æˆåŠŸäººæ•°ï¼š10000äºº
```

**å‘Šè­¦è§„åˆ™ï¼š**
```
1. QPS > 2000ï¼Œå‘Šè­¦
2. P95å“åº”æ—¶é—´ > 1000msï¼Œå‘Šè­¦
3. åº”ç”¨æœåŠ¡å™¨CPU > 80%ï¼Œå‘Šè­¦
4. Redis CPU > 70%ï¼Œå‘Šè­¦
5. Kafkaæ¶ˆæ¯ç§¯å‹ > 1000æ¡ï¼Œå‘Šè­¦
6. é”™è¯¯ç‡ > 5%ï¼Œå‘Šè­¦
```

---

### ç¬¬60å±‚ï¼šå‹æµ‹ä¸ä¼˜åŒ–æ€»ç»“

**å‹æµ‹åœºæ™¯å¯¹æ¯”ï¼š**

| åœºæ™¯ | QPS | å“åº”æ—¶é—´P95 | åº”ç”¨CPU | ç»“è®º |
|------|-----|------------|---------|------|
| **åœºæ™¯1** | 833 | 450ms | 60-70% | âœ… ç¨³å®š |
| **åœºæ™¯2** | 1666 | 800ms | 80-90% | âš ï¸ æ¥è¿‘ç“¶é¢ˆ |
| **åœºæ™¯3ï¼ˆä¼˜åŒ–å‰ï¼‰** | 3000 | 1500ms | 95-100% | âŒ ç“¶é¢ˆ |
| **åœºæ™¯3ï¼ˆä¼˜åŒ–åï¼‰** | 3000 | 500ms | 60-70% | âœ… ç¨³å®š |

**ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… å“åº”æ—¶é—´æå‡67%ï¼ˆP95ä»1500msé™åˆ°500msï¼‰
- âœ… åº”ç”¨æœåŠ¡å™¨CPUé™ä½30%ï¼ˆä»95-100%é™åˆ°60-70%ï¼‰
- âœ… Kafkaæ¶ˆæ¯ç§¯å‹æ¸…é›¶ï¼ˆä»2000æ¡é™åˆ°0ï¼‰
- âœ… æ”¯æ’‘QPS 3000ï¼Œç³»ç»Ÿç¨³å®š

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
1. **æ‰©å®¹åº”ç”¨æœåŠ¡å™¨**ï¼š10å° â†’ 30å°
2. **å¢åŠ Kafkaæ¶ˆè´¹è€…**ï¼š10ä¸ª â†’ 20ä¸ª
3. **éªŒè¯ç å¼‚æ­¥æ ¡éªŒ**ï¼šè€—æ—¶ä»20msé™åˆ°5ms
4. **åˆ†æ®µåº“å­˜**ï¼šå•Key â†’ 10ä¸ªKey
5. **æœ¬åœ°ç¼“å­˜**ï¼šå‡å°‘RedisæŸ¥è¯¢

**ç»éªŒæ•™è®­ï¼š**
- âœ… **å‹æµ‹é‡è¦**ï¼šæå‰å‘ç°ç“¶é¢ˆï¼Œé¿å…çº¿ä¸Šäº‹æ•…
- âœ… **ç›‘æ§é‡è¦**ï¼šå®æ—¶ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- âœ… **ä¼˜åŒ–æœ‰æ•ˆ**ï¼šé’ˆå¯¹æ€§ä¼˜åŒ–ï¼Œæ•ˆæœæ˜¾è‘—
- âœ… **ä½™é‡é‡è¦**ï¼šç³»ç»Ÿèµ„æºç•™20%ä½™é‡ï¼Œåº”å¯¹çªå‘æµé‡

---

## ç¬¬61-70å±‚ï¼šé¢è¯•å®˜è§†è§’åˆ†æ

### ç¬¬61å±‚ï¼šé¢è¯•å®˜çœŸæ­£æƒ³è€ƒå¯Ÿä»€ä¹ˆï¼Ÿ

**é¢è¯•å®˜è€ƒå¯Ÿçš„3ä¸ªç»´åº¦ï¼š**

**ç»´åº¦1ï¼šçœŸå®é¡¹ç›®ç»éªŒï¼ˆ70%æƒé‡ï¼‰**
- è¿™ä¸ªé¡¹ç›®æ˜¯çœŸå®çš„å—ï¼Ÿ
- ä½ åœ¨é¡¹ç›®ä¸­çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ
- ä½ è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- æœ‰æ²¡æœ‰é‡åŒ–æ•°æ®æ”¯æ’‘ï¼Ÿ

**ç»´åº¦2ï¼šæŠ€æœ¯æ·±åº¦ï¼ˆ20%æƒé‡ï¼‰**
- ä½ å¯¹æŠ€æœ¯åŸç†çš„ç†è§£æœ‰å¤šæ·±ï¼Ÿ
- ä½ èƒ½è§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡å—ï¼Ÿ
- ä½ è€ƒè™‘è¿‡å…¶ä»–æ–¹æ¡ˆå—ï¼Ÿ
- ä½ é‡åˆ°è¿‡ä»€ä¹ˆå‘ï¼Ÿ

**ç»´åº¦3ï¼šé—®é¢˜è§£å†³èƒ½åŠ›ï¼ˆ10%æƒé‡ï¼‰**
- é‡åˆ°é—®é¢˜ä½ æ˜¯æ€ä¹ˆæ’æŸ¥çš„ï¼Ÿ
- ä½ æ˜¯æ€ä¹ˆä¼˜åŒ–çš„ï¼Ÿ
- ä½ æœ‰ä»€ä¹ˆç»éªŒæ•™è®­ï¼Ÿ

**é¢è¯•å®˜ä¸å…³å¿ƒçš„ï¼š**
- âŒ ä½ ç”¨äº†ä»€ä¹ˆé«˜å¤§ä¸Šçš„æŠ€æœ¯ï¼ˆRedisã€Kafkaã€Sentinelï¼‰
- âŒ ä½ çš„QPSæœ‰å¤šé«˜ï¼ˆQPS 833ä¸ç®—é«˜ï¼‰
- âŒ ä½ çš„ä»£ç å†™å¾—å¤šæ¼‚äº®

**é¢è¯•å®˜å…³å¿ƒçš„ï¼š**
- âœ… ä½ çš„é¡¹ç›®æ˜¯çœŸå®çš„ï¼ˆä¸æ˜¯èƒŒçš„ï¼‰
- âœ… ä½ è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼ˆæœ‰ä¸šåŠ¡ä»·å€¼ï¼‰
- âœ… ä½ æœ‰é‡åŒ–æ•°æ®ï¼ˆå“åº”æ—¶é—´ä»1500msé™åˆ°500msï¼‰
- âœ… ä½ æœ‰æ€è€ƒï¼ˆä¸ºä»€ä¹ˆç”¨Redisè€Œä¸æ˜¯MySQLï¼‰

---

### ç¬¬62å±‚ï¼šé¢è¯•å®˜ä¼šé—®çš„10ä¸ªé—®é¢˜

**é—®é¢˜1ï¼šä½ ä»¬çš„QPSåªæœ‰833ï¼Œè¿™ä¹Ÿå«é«˜å¹¶å‘ï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è´¨ç–‘ä½ çš„é¡¹ç›®æ˜¯ä¸æ˜¯çœŸå®çš„
- è€ƒå¯Ÿä½ å¯¹é«˜å¹¶å‘çš„ç†è§£

**é”™è¯¯å›ç­”ï¼š**
- "833ä¹Ÿç®—é«˜å¹¶å‘å•Š"ï¼ˆé¢è¯•å®˜ä¼šè®¤ä¸ºä½ æ²¡è§è¿‡çœŸæ­£çš„é«˜å¹¶å‘ï¼‰
- "æˆ‘ä»¬ç³»ç»Ÿå°±æ˜¯è¿™æ ·"ï¼ˆæ²¡æœ‰è§£é‡Šï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æ‚¨è¯´å¾—å¯¹ï¼Œ833ç¡®å®ä¸ç®—é«˜å¹¶å‘ã€‚ä½†æˆ‘ä»¬è½¦é™©ä¸šåŠ¡å¹³æ—¶QPSåªæœ‰2.5æ¬¡/ç§’ï¼Œä¼˜æƒ åˆ¸æŠ¢è´­æ—¶QPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œ**ç›¸å¯¹å¢é•¿333å€**ã€‚è™½ç„¶ç»å¯¹å¹¶å‘é‡ä¸é«˜ï¼Œä½†ç›¸å¯¹å¢é•¿å¾ˆå¤§ï¼Œå¯¹æˆ‘ä»¬ç³»ç»Ÿæ˜¯å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚"
- "æˆ‘ä»¬ä¸æ˜¯ç”µå•†ï¼Œæ²¡æœ‰åŒåä¸€é‚£ç§QPS 10ä¸‡+çš„åœºæ™¯ã€‚ä½†æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼š**é˜²è¶…å–ã€é˜²åˆ·ã€é«˜å¯ç”¨**ã€‚"

---

**é—®é¢˜2ï¼šä¸ºä»€ä¹ˆç”¨Redisè€Œä¸æ˜¯MySQLï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹æŠ€æœ¯é€‰å‹çš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦è€ƒè™‘è¿‡å…¶ä»–æ–¹æ¡ˆ

**é”™è¯¯å›ç­”ï¼š**
- "å› ä¸ºRediså¿«"ï¼ˆå¤ªç®€å•ï¼‰
- "å› ä¸ºå¤§å®¶éƒ½ç”¨Redis"ï¼ˆæ²¡æœ‰æ€è€ƒï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬å¯¹æ¯”äº†3ç§æ–¹æ¡ˆï¼š**MySQLåŠ é”ã€Redisã€åˆ†å¸ƒå¼é”**ã€‚"
- "MySQLåŠ é”ï¼šQPSåªæœ‰100-200ï¼Œæ— æ³•æ”¯æ’‘833æ¬¡/ç§’ã€‚"
- "åˆ†å¸ƒå¼é”ï¼šéœ€è¦å¼•å…¥Zookeeperæˆ–Redissonï¼Œå¢åŠ å¤æ‚åº¦ã€‚"
- "Redis + Luaè„šæœ¬ï¼šQPS 10ä¸‡+ï¼ŒåŸå­æ€§ï¼Œç®€å•ã€‚"
- "æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†Redis + Luaè„šæœ¬ã€‚"

---

**é—®é¢˜3ï¼šRediså®•æœºäº†æ€ä¹ˆåŠï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹é«˜å¯ç”¨çš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦è€ƒè™‘è¿‡å¼‚å¸¸åœºæ™¯

**é”™è¯¯å›ç­”ï¼š**
- "Redisä¸ä¼šå®•æœº"ï¼ˆå¤ªå¤©çœŸï¼‰
- "æˆ‘ä»¬æœ‰Redisé›†ç¾¤"ï¼ˆæ²¡æœ‰è¯´å…·ä½“æ–¹æ¡ˆï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬æœ‰3ä¸ªæ–¹æ¡ˆï¼š**Redisé›†ç¾¤ã€æœ¬åœ°ç¼“å­˜ã€é™çº§**ã€‚"
- "Redisé›†ç¾¤ï¼š3ä¸»3ä»ï¼Œä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨åˆ‡æ¢ã€‚"
- "æœ¬åœ°ç¼“å­˜ï¼šåº”ç”¨æœåŠ¡å™¨æœ¬åœ°ç¼“å­˜æ´»åŠ¨ä¿¡æ¯ï¼ŒRediså®•æœºæ—¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚"
- "é™çº§æ–¹æ¡ˆï¼šRediså®•æœºæ—¶ï¼Œç›´æ¥è¿”å›'ç³»ç»Ÿç¹å¿™'ï¼Œä¸æŸ¥è¯¢MySQLï¼Œä¿æŠ¤æ•°æ®åº“ã€‚"

---

**é—®é¢˜4ï¼šKafkaæ¶ˆæ¯ä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹æ•°æ®ä¸€è‡´æ€§çš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦è€ƒè™‘è¿‡å¼‚å¸¸åœºæ™¯

**é”™è¯¯å›ç­”ï¼š**
- "Kafkaä¸ä¼šä¸¢æ¶ˆæ¯"ï¼ˆå¤ªå¤©çœŸï¼‰
- "æˆ‘ä»¬æœ‰Kafkaé›†ç¾¤"ï¼ˆæ²¡æœ‰è¯´å…·ä½“æ–¹æ¡ˆï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬æœ‰3ä¸ªæ–¹æ¡ˆï¼š**Kafkaé‡è¯•ã€å®šæ—¶ä»»åŠ¡è¡¥å¿ã€ç”¨æˆ·æŸ¥è¯¢æ—¶è¡¥å¿**ã€‚"
- "Kafkaé‡è¯•ï¼šæ¶ˆè´¹å¤±è´¥åï¼Œè‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œé‡è¯•é—´éš”1ç§’ã€5ç§’ã€10ç§’ã€‚"
- "å®šæ—¶ä»»åŠ¡è¡¥å¿ï¼šæ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œå¯¹æ¯”Rediså’ŒMySQLæ•°æ®ï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œè¡¥å¿å†™å…¥MySQLã€‚"
- "ç”¨æˆ·æŸ¥è¯¢æ—¶è¡¥å¿ï¼šç”¨æˆ·æŸ¥è¯¢ä¼˜æƒ åˆ¸åˆ—è¡¨æ—¶ï¼Œå…ˆæŸ¥MySQLï¼Œå¦‚æœMySQLæ²¡æœ‰ï¼Œå†æŸ¥Redisï¼Œå¦‚æœRedisæœ‰ï¼Œè¡¥å¿å†™å…¥MySQLã€‚"

---

**é—®é¢˜5ï¼šä½ ä»¬çš„å“åº”æ—¶é—´æ˜¯å¤šå°‘ï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹æ€§èƒ½çš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦æœ‰é‡åŒ–æ•°æ®

**é”™è¯¯å›ç­”ï¼š**
- "å¾ˆå¿«"ï¼ˆæ²¡æœ‰æ•°æ®ï¼‰
- "å‡ ç™¾æ¯«ç§’"ï¼ˆä¸å¤Ÿç²¾ç¡®ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬çš„å“åº”æ—¶é—´ï¼š**P50 200msã€P95 500msã€P99 1000ms**ã€‚"
- "ä¼˜åŒ–å‰ï¼šP95 1500msï¼Œä¼˜åŒ–åï¼šP95 500msï¼Œ**æå‡67%**ã€‚"
- "ä¼˜åŒ–æ–¹æ¡ˆï¼š**éªŒè¯ç å¼‚æ­¥æ ¡éªŒã€åˆ†æ®µåº“å­˜ã€æœ¬åœ°ç¼“å­˜**ã€‚"

---

**é—®é¢˜6ï¼šä½ ä»¬æ€ä¹ˆé˜²åˆ·çš„ï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹å®‰å…¨çš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦è€ƒè™‘è¿‡ç¾Šæ¯›å…š

**é”™è¯¯å›ç­”ï¼š**
- "æˆ‘ä»¬æœ‰éªŒè¯ç "ï¼ˆå¤ªç®€å•ï¼‰
- "æˆ‘ä»¬é™åˆ¶æ¯äººåªèƒ½é¢†1å¼ "ï¼ˆä¸å¤Ÿå…¨é¢ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬æœ‰5ä¸ªæ–¹æ¡ˆï¼š**éªŒè¯ç ã€IPé™æµã€ç”¨æˆ·é™æµã€è®¾å¤‡æŒ‡çº¹ã€è¡Œä¸ºåˆ†æ**ã€‚"
- "éªŒè¯ç ï¼šæ»‘åŠ¨éªŒè¯ç ï¼Œé˜²æ­¢è„šæœ¬åˆ·åˆ¸ã€‚"
- "IPé™æµï¼š1åˆ†é’Ÿå†…åŒä¸€IPæœ€å¤šè¯·æ±‚10æ¬¡ã€‚"
- "ç”¨æˆ·é™æµï¼šæ¯ä¸ªç”¨æˆ·åªèƒ½é¢†å–1å¼ åˆ¸ã€‚"
- "è®¾å¤‡æŒ‡çº¹ï¼šè®°å½•ç”¨æˆ·è®¾å¤‡ä¿¡æ¯ï¼ŒåŒä¸€è®¾å¤‡åªèƒ½é¢†å–1å¼ åˆ¸ã€‚"
- "è¡Œä¸ºåˆ†æï¼šè®°å½•ç”¨æˆ·ç‚¹å‡»æ—¶é—´é—´éš”ï¼Œè¯†åˆ«è„šæœ¬åˆ·åˆ¸ã€‚"

---

**é—®é¢˜7ï¼šä½ ä»¬çš„æˆåŠŸç‡æ˜¯å¤šå°‘ï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹ä¸šåŠ¡çš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦æœ‰é‡åŒ–æ•°æ®

**é”™è¯¯å›ç­”ï¼š**
- "å¾ˆé«˜"ï¼ˆæ²¡æœ‰æ•°æ®ï¼‰
- "å¤§éƒ¨åˆ†äººéƒ½æŠ¢åˆ°äº†"ï¼ˆä¸çœŸå®ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬çš„æˆåŠŸç‡ï¼š**6.7%**ï¼ˆ10000å¼ åˆ¸ / 150000æ¬¡è¯·æ±‚ï¼‰ã€‚"
- "å¤±è´¥åŸå› åˆ†å¸ƒï¼š**å·²æŠ¢å®Œ60%ã€ç³»ç»Ÿç¹å¿™30%ã€éªŒè¯ç é”™è¯¯3%ã€å…¶ä»–0.3%**ã€‚"
- "ç³»ç»Ÿç¹å¿™30%æ˜¯å› ä¸ºSentinelé™æµï¼Œä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‰“å®ã€‚"

---

**é—®é¢˜8ï¼šä½ ä»¬çš„ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹ç³»ç»Ÿçš„ç†è§£
- è€ƒå¯Ÿä½ æ˜¯å¦æœ‰ç›‘æ§

**é”™è¯¯å›ç­”ï¼š**
- "ä¸çŸ¥é“"ï¼ˆæ²¡æœ‰ç›‘æ§ï¼‰
- "è¿˜è¡Œ"ï¼ˆæ²¡æœ‰æ•°æ®ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬çš„ç³»ç»Ÿèµ„æºä½¿ç”¨ï¼š**åº”ç”¨æœåŠ¡å™¨CPU 60-70%ã€Redis CPU 40-50%ã€MySQL CPU 15-25%**ã€‚"
- "ä¼˜åŒ–å‰ï¼šåº”ç”¨æœåŠ¡å™¨CPU 95-100%ï¼Œæ¥è¿‘ç“¶é¢ˆã€‚"
- "ä¼˜åŒ–åï¼šåº”ç”¨æœåŠ¡å™¨CPU 60-70%ï¼Œæœ‰20%ä½™é‡ã€‚"
- "ä¼˜åŒ–æ–¹æ¡ˆï¼š**æ‰©å®¹åˆ°30å°æœåŠ¡å™¨ã€å¢åŠ Kafkaæ¶ˆè´¹è€…ã€éªŒè¯ç å¼‚æ­¥æ ¡éªŒ**ã€‚"

---

**é—®é¢˜9ï¼šä½ ä»¬æœ‰æ²¡æœ‰åšå‹æµ‹ï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ å¯¹è´¨é‡çš„é‡è§†
- è€ƒå¯Ÿä½ æ˜¯å¦æœ‰å‹æµ‹ç»éªŒ

**é”™è¯¯å›ç­”ï¼š**
- "æ²¡æœ‰"ï¼ˆé¢è¯•å®˜ä¼šè´¨ç–‘ä½ çš„é¡¹ç›®è´¨é‡ï¼‰
- "åšäº†"ï¼ˆæ²¡æœ‰è¯´å…·ä½“æ•°æ®ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬åšäº†3ä¸ªåœºæ™¯çš„å‹æµ‹ï¼š**QPS 833ã€QPS 1666ã€QPS 3000**ã€‚"
- "QPS 833ï¼šç³»ç»Ÿç¨³å®šï¼Œå“åº”æ—¶é—´P95 450msã€‚"
- "QPS 1666ï¼šæ¥è¿‘ç“¶é¢ˆï¼Œå“åº”æ—¶é—´P95 800msã€‚"
- "QPS 3000ï¼ˆä¼˜åŒ–å‰ï¼‰ï¼šç“¶é¢ˆï¼Œå“åº”æ—¶é—´P95 1500msã€‚"
- "QPS 3000ï¼ˆä¼˜åŒ–åï¼‰ï¼šç³»ç»Ÿç¨³å®šï¼Œå“åº”æ—¶é—´P95 500msã€‚"

---

**é—®é¢˜10ï¼šä½ åœ¨è¿™ä¸ªé¡¹ç›®ä¸­çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ**

**é¢è¯•å®˜æ„å›¾ï¼š**
- è€ƒå¯Ÿä½ æ˜¯å¦çœŸæ­£å‚ä¸äº†é¡¹ç›®
- è€ƒå¯Ÿä½ çš„è´¡çŒ®æ˜¯ä»€ä¹ˆ

**é”™è¯¯å›ç­”ï¼š**
- "æˆ‘æ˜¯æ ¸å¿ƒå¼€å‘"ï¼ˆå¤ªè™šï¼‰
- "æˆ‘è´Ÿè´£æ‰€æœ‰åŠŸèƒ½"ï¼ˆä¸çœŸå®ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘æ˜¯**æ ¸å¿ƒå¼€å‘**ï¼Œè´Ÿè´£**æŠ¢åˆ¸æ¥å£ã€Redisæ‰£å‡åº“å­˜ã€Kafkaå¼‚æ­¥å†™å…¥**3ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚"
- "æˆ‘çš„è´¡çŒ®ï¼š**è®¾è®¡Luaè„šæœ¬é˜²è¶…å–ã€ä¼˜åŒ–å“åº”æ—¶é—´ä»1500msé™åˆ°500msã€å‹æµ‹å‘ç°ç“¶é¢ˆå¹¶ä¼˜åŒ–**ã€‚"
- "æˆ‘çš„æ”¶è·ï¼š**æ·±å…¥ç†è§£Redisã€Kafkaã€Sentinelï¼ŒæŒæ¡é«˜å¹¶å‘åœºæ™¯çš„è®¾è®¡å’Œä¼˜åŒ–**ã€‚"

---

### ç¬¬63å±‚ï¼šé¢è¯•å®˜ä¼šè´¨ç–‘çš„5ä¸ªç‚¹

**è´¨ç–‘1ï¼šä½ ä»¬çš„QPSåªæœ‰833ï¼Œè¿™ä¹Ÿå«é«˜å¹¶å‘ï¼Ÿ**

**é¢è¯•å®˜å¿ƒç†ï¼š**
- æˆ‘è§è¿‡QPS 10ä¸‡+çš„ç³»ç»Ÿï¼Œä½ è¿™833ç®—ä»€ä¹ˆï¼Ÿ
- ä½ æ˜¯ä¸æ˜¯åœ¨å¹ç‰›ï¼Ÿ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… æ‰¿è®¤ï¼š833ç¡®å®ä¸ç®—é«˜å¹¶å‘
- âœ… å¼ºè°ƒï¼šç›¸å¯¹å¢é•¿333å€
- âœ… å¯¹æ¯”ï¼šè½¦é™©ä¸šåŠ¡å¹³æ—¶QPSåªæœ‰2.5æ¬¡/ç§’
- âœ… ä»·å€¼ï¼šè§£å†³äº†é˜²è¶…å–ã€é˜²åˆ·ã€é«˜å¯ç”¨çš„é—®é¢˜

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æ‚¨è¯´å¾—å¯¹ï¼Œ833ç¡®å®ä¸ç®—é«˜å¹¶å‘ã€‚ä½†æˆ‘ä»¬è½¦é™©ä¸šåŠ¡å¹³æ—¶QPSåªæœ‰2.5æ¬¡/ç§’ï¼Œä¼˜æƒ åˆ¸æŠ¢è´­æ—¶QPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œç›¸å¯¹å¢é•¿333å€ã€‚è™½ç„¶ç»å¯¹å¹¶å‘é‡ä¸é«˜ï¼Œä½†ç›¸å¯¹å¢é•¿å¾ˆå¤§ï¼Œå¯¹æˆ‘ä»¬ç³»ç»Ÿæ˜¯å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼šé˜²è¶…å–ã€é˜²åˆ·ã€é«˜å¯ç”¨ã€‚"

---

**è´¨ç–‘2ï¼šä½ ä»¬ä¸ºä»€ä¹ˆä¸ç”¨åˆ†å¸ƒå¼é”ï¼Ÿ**

**é¢è¯•å®˜å¿ƒç†ï¼š**
- åˆ†å¸ƒå¼é”æ˜¯é«˜å¹¶å‘çš„æ ‡å‡†æ–¹æ¡ˆï¼Œä½ ä¸ºä»€ä¹ˆä¸ç”¨ï¼Ÿ
- ä½ æ˜¯ä¸æ˜¯ä¸ä¼šç”¨åˆ†å¸ƒå¼é”ï¼Ÿ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… æ‰¿è®¤ï¼šåˆ†å¸ƒå¼é”æ˜¯æ ‡å‡†æ–¹æ¡ˆ
- âœ… å¯¹æ¯”ï¼šåˆ†å¸ƒå¼é” vs Redis + Lua
- âœ… é€‰æ‹©ï¼šRedis + Luaæ›´ç®€å•ã€æ€§èƒ½æ›´å¥½
- âœ… æƒè¡¡ï¼šä¸è¿‡åº¦è®¾è®¡

**è¯æœ¯æ¨¡æ¿ï¼š**
- "åˆ†å¸ƒå¼é”ç¡®å®æ˜¯æ ‡å‡†æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¹Ÿè€ƒè™‘è¿‡ã€‚ä½†åˆ†å¸ƒå¼é”éœ€è¦å¼•å…¥Zookeeperæˆ–Redissonï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚è€ŒRedis + Luaè„šæœ¬å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœï¼Œè€Œä¸”æ›´ç®€å•ã€æ€§èƒ½æ›´å¥½ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼š**ä¸è¿‡åº¦è®¾è®¡ï¼Œå¤Ÿç”¨å°±å¥½**ã€‚"

---

**è´¨ç–‘3ï¼šä½ ä»¬çš„æˆåŠŸç‡åªæœ‰6.7%ï¼Œå¤ªä½äº†å§ï¼Ÿ**

**é¢è¯•å®˜å¿ƒç†ï¼š**
- æˆåŠŸç‡è¿™ä¹ˆä½ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½å§ï¼Ÿ
- ä½ ä»¬çš„ç³»ç»Ÿæ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Ÿ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… è§£é‡Šï¼šæˆåŠŸç‡ä½æ˜¯æ­£å¸¸çš„
- âœ… è®¡ç®—ï¼š10000å¼ åˆ¸ / 150000æ¬¡è¯·æ±‚ = 6.7%
- âœ… å¯¹æ¯”ï¼šç”µå•†ç§’æ€æˆåŠŸç‡ä¹Ÿåªæœ‰1-5%
- âœ… ä¼˜åŒ–ï¼šSentinelé™æµä¿æŠ¤ç³»ç»Ÿ

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æˆåŠŸç‡6.7%æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸º10000å¼ åˆ¸ï¼Œ150000æ¬¡è¯·æ±‚ï¼ŒæˆåŠŸç‡ = 10000 Ã· 150000 = 6.7%ã€‚ç”µå•†ç§’æ€çš„æˆåŠŸç‡ä¹Ÿåªæœ‰1-5%ã€‚æˆ‘ä»¬çš„Sentinelé™æµä¿æŠ¤ç³»ç»Ÿï¼Œ30%çš„è¯·æ±‚è¢«é™æµï¼Œè¿”å›'ç³»ç»Ÿç¹å¿™'ï¼Œä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‰“å®ã€‚"

---

**è´¨ç–‘4ï¼šä½ ä»¬çš„å“åº”æ—¶é—´P95 500msï¼Œè¿˜æ˜¯æœ‰ç‚¹æ…¢å§ï¼Ÿ**

**é¢è¯•å®˜å¿ƒç†ï¼š**
- 500msè¿˜æ˜¯æœ‰ç‚¹æ…¢ï¼Œèƒ½ä¸èƒ½å†ä¼˜åŒ–ï¼Ÿ
- ä½ æ˜¯ä¸æ˜¯æ²¡æœ‰ä¼˜åŒ–åˆ°ä½ï¼Ÿ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… æ‰¿è®¤ï¼š500msç¡®å®æœ‰ä¼˜åŒ–ç©ºé—´
- âœ… å¯¹æ¯”ï¼šä¼˜åŒ–å‰1500msï¼Œä¼˜åŒ–å500msï¼Œæå‡67%
- âœ… æƒè¡¡ï¼šç»§ç»­ä¼˜åŒ–æˆæœ¬é«˜ï¼Œæ”¶ç›Šä½
- âœ… ç›®æ ‡ï¼šP95 < 1000msï¼Œç¬¦åˆä¸šåŠ¡è¦æ±‚

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æ‚¨è¯´å¾—å¯¹ï¼Œ500msç¡®å®æœ‰ä¼˜åŒ–ç©ºé—´ã€‚ä½†æˆ‘ä»¬ä¼˜åŒ–å‰P95æ˜¯1500msï¼Œä¼˜åŒ–å500msï¼Œæå‡äº†67%ã€‚ç»§ç»­ä¼˜åŒ–çš„è¯ï¼Œéœ€è¦å¼•å…¥æ›´å¤æ‚çš„æŠ€æœ¯ï¼ˆå¦‚æœ¬åœ°æ‰£å‡åº“å­˜ï¼‰ï¼Œæˆæœ¬é«˜ï¼Œæ”¶ç›Šä½ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯P95 < 1000msï¼Œç°åœ¨500mså·²ç»ç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚"

---

**è´¨ç–‘5ï¼šä½ ä»¬çš„é¡¹ç›®æ˜¯çœŸå®çš„å—ï¼Ÿ**

**é¢è¯•å®˜å¿ƒç†ï¼š**
- ä½ æ˜¯ä¸æ˜¯åœ¨èƒŒé¢è¯•é¢˜ï¼Ÿ
- ä½ æ˜¯ä¸æ˜¯åœ¨å¹ç‰›ï¼Ÿ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… ç»†èŠ‚ï¼šè¯´å‡ºå…·ä½“çš„æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©
- âœ… æ•°æ®ï¼šè¯´å‡ºå…·ä½“çš„æ•°æ®ï¼ˆQPSã€å“åº”æ—¶é—´ã€æˆåŠŸç‡ï¼‰
- âœ… é—®é¢˜ï¼šè¯´å‡ºé‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- âœ… æ”¶è·ï¼šè¯´å‡ºè‡ªå·±çš„æ”¶è·å’Œç»éªŒæ•™è®­

**è¯æœ¯æ¨¡æ¿ï¼š**
- "è¿™ä¸ªé¡¹ç›®æ˜¯2025å¹´1æœˆåšçš„ï¼Œæˆ‘æ˜¯æ ¸å¿ƒå¼€å‘ï¼Œè´Ÿè´£æŠ¢åˆ¸æ¥å£ã€Redisæ‰£å‡åº“å­˜ã€Kafkaå¼‚æ­¥å†™å…¥ã€‚æˆ‘ä»¬é‡åˆ°çš„æœ€å¤§é—®é¢˜æ˜¯QPS 3000æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨CPU 100%ï¼Œå“åº”æ—¶é—´P95 1500msã€‚æˆ‘ä»¬é€šè¿‡æ‰©å®¹åˆ°30å°æœåŠ¡å™¨ã€å¢åŠ Kafkaæ¶ˆè´¹è€…ã€éªŒè¯ç å¼‚æ­¥æ ¡éªŒï¼Œä¼˜åŒ–åå“åº”æ—¶é—´P95é™åˆ°500msã€‚æˆ‘çš„æ”¶è·æ˜¯ï¼šæ·±å…¥ç†è§£Redisã€Kafkaã€Sentinelï¼ŒæŒæ¡é«˜å¹¶å‘åœºæ™¯çš„è®¾è®¡å’Œä¼˜åŒ–ã€‚"

---

### ç¬¬64å±‚ï¼šé¢è¯•å®˜çš„3ä¸ªé™·é˜±

**é™·é˜±1ï¼šä½ ä»¬çš„QPSè¿™ä¹ˆé«˜ï¼Œä¸ºä»€ä¹ˆä¸ç”¨Nginxé™æµï¼Ÿ**

**é™·é˜±åˆ†æï¼š**
- é¢è¯•å®˜æ•…æ„è¯´"QPSè¿™ä¹ˆé«˜"ï¼Œå…¶å®QPS 833ä¸ç®—é«˜
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦ä¼šè¢«è¯¯å¯¼

**é”™è¯¯å›ç­”ï¼š**
- "å¯¹å•Šï¼Œæˆ‘ä»¬åº”è¯¥ç”¨Nginxé™æµ"ï¼ˆè¢«è¯¯å¯¼ï¼‰
- "æˆ‘ä»¬ç”¨äº†Nginxé™æµ"ï¼ˆæ’’è°ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬ç”¨çš„æ˜¯Sentinelé™æµï¼Œä¸æ˜¯Nginxé™æµã€‚Sentinelæ˜¯åº”ç”¨å±‚é™æµï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒæ¥å£è®¾ç½®ä¸åŒçš„é™æµè§„åˆ™ã€‚Nginxæ˜¯ç½‘å…³å±‚é™æµï¼Œåªèƒ½é’ˆå¯¹æ•´ä¸ªæœåŠ¡é™æµã€‚æˆ‘ä»¬çš„åœºæ™¯æ˜¯ï¼šæŠ¢åˆ¸æ¥å£QPSé™åˆ¶1000ï¼ŒæŸ¥è¯¢æ¥å£QPSé™åˆ¶2000ï¼Œæ‰€ä»¥ç”¨Sentinelæ›´åˆé€‚ã€‚"

---

**é™·é˜±2ï¼šä½ ä»¬çš„Redisé›†ç¾¤æ˜¯3ä¸»3ä»ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯5ä¸»5ä»ï¼Ÿ**

**é™·é˜±åˆ†æï¼š**
- é¢è¯•å®˜æ•…æ„è¯´"5ä¸»5ä»"ï¼Œå…¶å®3ä¸»3ä»å°±å¤Ÿäº†
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦ä¼šè¢«è¯¯å¯¼

**é”™è¯¯å›ç­”ï¼š**
- "å¯¹å•Šï¼Œæˆ‘ä»¬åº”è¯¥ç”¨5ä¸»5ä»"ï¼ˆè¢«è¯¯å¯¼ï¼‰
- "æˆ‘ä»¬ç”¨äº†5ä¸»5ä»"ï¼ˆæ’’è°ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬ç”¨çš„æ˜¯3ä¸»3ä»ï¼Œä¸æ˜¯5ä¸»5ä»ã€‚3ä¸»3ä»å·²ç»è¶³å¤Ÿæ”¯æ’‘QPS 833ï¼Œè€Œä¸”æˆæœ¬å¯æ§ã€‚5ä¸»5ä»ä¼šå¢åŠ æˆæœ¬ï¼Œä½†æ€§èƒ½æå‡ä¸æ˜æ˜¾ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼š**ä¸è¿‡åº¦è®¾è®¡ï¼Œå¤Ÿç”¨å°±å¥½**ã€‚"

---

**é™·é˜±3ï¼šä½ ä»¬çš„Kafkaåˆ†åŒºæ•°æ˜¯10ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯100ï¼Ÿ**

**é™·é˜±åˆ†æï¼š**
- é¢è¯•å®˜æ•…æ„è¯´"100"ï¼Œå…¶å®10å°±å¤Ÿäº†
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦ä¼šè¢«è¯¯å¯¼

**é”™è¯¯å›ç­”ï¼š**
- "å¯¹å•Šï¼Œæˆ‘ä»¬åº”è¯¥ç”¨100ä¸ªåˆ†åŒº"ï¼ˆè¢«è¯¯å¯¼ï¼‰
- "æˆ‘ä»¬ç”¨äº†100ä¸ªåˆ†åŒº"ï¼ˆæ’’è°ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "æˆ‘ä»¬ç”¨çš„æ˜¯10ä¸ªåˆ†åŒºï¼Œä¸æ˜¯100ä¸ªåˆ†åŒºã€‚10ä¸ªåˆ†åŒºå¯¹åº”10å°åº”ç”¨æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨å¯¹åº”1ä¸ªåˆ†åŒºï¼Œæå‡å¹¶å‘å†™å…¥èƒ½åŠ›ã€‚100ä¸ªåˆ†åŒºä¼šå¢åŠ Kafkaçš„ç®¡ç†æˆæœ¬ï¼Œä½†æ€§èƒ½æå‡ä¸æ˜æ˜¾ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼š**åˆ†åŒºæ•° = æœåŠ¡å™¨æ•°**ã€‚"

---

### ç¬¬65å±‚ï¼šé¢è¯•å®˜çš„3ä¸ªåŠ åˆ†é¡¹

**åŠ åˆ†é¡¹1ï¼šä½ ä¸»åŠ¨è¯´å‡ºé‡åˆ°çš„å‘**

**ä¸ºä»€ä¹ˆåŠ åˆ†ï¼Ÿ**
- è¯´æ˜ä½ çœŸæ­£å‚ä¸äº†é¡¹ç›®
- è¯´æ˜ä½ æœ‰æ€è€ƒå’Œæ€»ç»“

**ç¤ºä¾‹ï¼š**
- "æˆ‘ä»¬é‡åˆ°çš„æœ€å¤§çš„å‘æ˜¯ï¼š**Kafkaæ¶ˆæ¯ç§¯å‹**ã€‚ä¼˜åŒ–å‰ï¼Œç”Ÿäº§é€Ÿåº¦ > æ¶ˆè´¹é€Ÿåº¦ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹2000æ¡ã€‚æˆ‘ä»¬é€šè¿‡å¢åŠ æ¶ˆè´¹è€…æ•°é‡ï¼ˆ10ä¸ª â†’ 20ä¸ªï¼‰ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚"

---

**åŠ åˆ†é¡¹2ï¼šä½ ä¸»åŠ¨è¯´å‡ºä¼˜åŒ–ç©ºé—´**

**ä¸ºä»€ä¹ˆåŠ åˆ†ï¼Ÿ**
- è¯´æ˜ä½ æœ‰æŒç»­ä¼˜åŒ–çš„æ„è¯†
- è¯´æ˜ä½ å¯¹æŠ€æœ¯æœ‰è¿½æ±‚

**ç¤ºä¾‹ï¼š**
- "æˆ‘ä»¬çš„ç³»ç»Ÿè¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼š**åˆ†æ®µåº“å­˜**ã€‚ç°åœ¨æ‰€æœ‰è¯·æ±‚è®¿é—®åŒä¸€ä¸ªKeyï¼Œå•Keyå‹åŠ›å¤§ã€‚å¦‚æœå°†10000å¼ åˆ¸åˆ†æˆ10æ®µï¼Œæ¯æ®µ1000å¼ ï¼Œå•Keyå‹åŠ›é™ä½10å€ã€‚"

---

**åŠ åˆ†é¡¹3ï¼šä½ ä¸»åŠ¨è¯´å‡ºä¸šåŠ¡ä»·å€¼**

**ä¸ºä»€ä¹ˆåŠ åˆ†ï¼Ÿ**
- è¯´æ˜ä½ ä¸åªæ˜¯æŠ€æœ¯å®…ï¼Œè¿˜å…³å¿ƒä¸šåŠ¡
- è¯´æ˜ä½ æœ‰å…¨å±€è§†è§’

**ç¤ºä¾‹ï¼š**
- "è¿™ä¸ªé¡¹ç›®çš„ä¸šåŠ¡ä»·å€¼æ˜¯ï¼š**æå‡ç»­ä¿è½¬åŒ–ç‡**ã€‚ä¼˜æƒ åˆ¸æŠ¢è´­æ´»åŠ¨å¸å¼•äº†10ä¸‡äººå‚ä¸ï¼Œå…¶ä¸­8000äººä½¿ç”¨ä¼˜æƒ åˆ¸æŠ•ä¿ï¼Œç»­ä¿è½¬åŒ–ç‡æå‡25ä¸ªç™¾åˆ†ç‚¹ï¼Œä¸ºå…¬å¸å¸¦æ¥1600ä¸‡å…ƒä¿è´¹æ”¶å…¥ã€‚"

---

### ç¬¬66å±‚ï¼šé¢è¯•å®˜çš„3ä¸ªå‡åˆ†é¡¹

**å‡åˆ†é¡¹1ï¼šä½ è¯´ä¸å‡ºå…·ä½“æ•°æ®**

**ä¸ºä»€ä¹ˆå‡åˆ†ï¼Ÿ**
- è¯´æ˜ä½ æ²¡æœ‰çœŸæ­£å‚ä¸é¡¹ç›®
- è¯´æ˜ä½ æ²¡æœ‰ç›‘æ§å’Œå‹æµ‹

**ç¤ºä¾‹ï¼š**
- é¢è¯•å®˜ï¼š"ä½ ä»¬çš„QPSæ˜¯å¤šå°‘ï¼Ÿ"
- ä½ ï¼š"ä¸çŸ¥é“"ï¼ˆâŒ å‡åˆ†ï¼‰
- ä½ ï¼š"å¾ˆé«˜"ï¼ˆâŒ å‡åˆ†ï¼‰
- ä½ ï¼š"833æ¬¡/ç§’"ï¼ˆâœ… åŠ åˆ†ï¼‰

---

**å‡åˆ†é¡¹2ï¼šä½ è¯´ä¸å‡ºä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**

**ä¸ºä»€ä¹ˆå‡åˆ†ï¼Ÿ**
- è¯´æ˜ä½ åªæ˜¯æ‰§è¡Œè€…ï¼Œä¸æ˜¯è®¾è®¡è€…
- è¯´æ˜ä½ æ²¡æœ‰æ€è€ƒ

**ç¤ºä¾‹ï¼š**
- é¢è¯•å®˜ï¼š"ä¸ºä»€ä¹ˆç”¨Redisè€Œä¸æ˜¯MySQLï¼Ÿ"
- ä½ ï¼š"å› ä¸ºRediså¿«"ï¼ˆâŒ å‡åˆ†ï¼‰
- ä½ ï¼š"å› ä¸ºå¤§å®¶éƒ½ç”¨Redis"ï¼ˆâŒ å‡åˆ†ï¼‰
- ä½ ï¼š"æˆ‘ä»¬å¯¹æ¯”äº†3ç§æ–¹æ¡ˆï¼šMySQLåŠ é”ã€Redisã€åˆ†å¸ƒå¼é”ã€‚MySQLåŠ é”QPSåªæœ‰100-200ï¼Œæ— æ³•æ”¯æ’‘833æ¬¡/ç§’ã€‚åˆ†å¸ƒå¼é”éœ€è¦å¼•å…¥Zookeeperï¼Œå¢åŠ å¤æ‚åº¦ã€‚Redis + Luaè„šæœ¬QPS 10ä¸‡+ï¼ŒåŸå­æ€§ï¼Œç®€å•ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†Redis + Luaè„šæœ¬ã€‚"ï¼ˆâœ… åŠ åˆ†ï¼‰

---

**å‡åˆ†é¡¹3ï¼šä½ è¯´ä¸å‡ºé‡åˆ°çš„é—®é¢˜**

**ä¸ºä»€ä¹ˆå‡åˆ†ï¼Ÿ**
- è¯´æ˜ä½ çš„é¡¹ç›®å¤ªé¡ºåˆ©ï¼ˆä¸çœŸå®ï¼‰
- è¯´æ˜ä½ æ²¡æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›

**ç¤ºä¾‹ï¼š**
- é¢è¯•å®˜ï¼š"ä½ ä»¬é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿ"
- ä½ ï¼š"æ²¡æœ‰"ï¼ˆâŒ å‡åˆ†ï¼‰
- ä½ ï¼š"éƒ½å¾ˆé¡ºåˆ©"ï¼ˆâŒ å‡åˆ†ï¼‰
- ä½ ï¼š"æˆ‘ä»¬é‡åˆ°çš„æœ€å¤§é—®é¢˜æ˜¯ï¼šQPS 3000æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨CPU 100%ï¼Œå“åº”æ—¶é—´P95 1500msã€‚æˆ‘ä»¬é€šè¿‡æ‰©å®¹åˆ°30å°æœåŠ¡å™¨ã€å¢åŠ Kafkaæ¶ˆè´¹è€…ã€éªŒè¯ç å¼‚æ­¥æ ¡éªŒï¼Œä¼˜åŒ–åå“åº”æ—¶é—´P95é™åˆ°500msã€‚"ï¼ˆâœ… åŠ åˆ†ï¼‰

---

### ç¬¬67å±‚ï¼šé¢è¯•å®˜çš„å¿ƒç†åˆ†æ

**é¢è¯•å®˜çš„3ä¸ªå¿ƒç†ï¼š**

**å¿ƒç†1ï¼šæ€€ç–‘ï¼ˆé»˜è®¤ä½ åœ¨å¹ç‰›ï¼‰**
- é¢è¯•å®˜è§è¿‡å¤ªå¤šå¹ç‰›çš„å€™é€‰äºº
- é¢è¯•å®˜é»˜è®¤ä½ åœ¨èƒŒé¢è¯•é¢˜
- é¢è¯•å®˜ä¼šé€šè¿‡ç»†èŠ‚é—®é¢˜éªŒè¯ä½ çš„çœŸå®æ€§

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… è¯´å‡ºå…·ä½“çš„æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©
- âœ… è¯´å‡ºå…·ä½“çš„æ•°æ®ï¼ˆQPSã€å“åº”æ—¶é—´ã€æˆåŠŸç‡ï¼‰
- âœ… è¯´å‡ºé‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

**å¿ƒç†2ï¼šè´¨ç–‘ï¼ˆæ•…æ„æŒ‘åˆºï¼‰**
- é¢è¯•å®˜ä¼šæ•…æ„è´¨ç–‘ä½ çš„æ–¹æ¡ˆ
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦èƒ½è‡ªåœ†å…¶è¯´
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦æœ‰æ€è€ƒ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… æ‰¿è®¤ä¸è¶³ï¼šæ‰¿è®¤ä½ çš„æ–¹æ¡ˆä¸æ˜¯å®Œç¾çš„
- âœ… è§£é‡ŠåŸå› ï¼šè§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
- âœ… å¯¹æ¯”æ–¹æ¡ˆï¼šè¯´å‡ºä½ è€ƒè™‘è¿‡çš„å…¶ä»–æ–¹æ¡ˆ
- âœ… æƒè¡¡åˆ©å¼Šï¼šè¯´å‡ºä½ çš„æƒè¡¡

---

**å¿ƒç†3ï¼šæœŸå¾…ï¼ˆå¸Œæœ›ä½ æ˜¯çœŸçš„ï¼‰**
- é¢è¯•å®˜å¸Œæœ›ä½ æ˜¯çœŸæ­£æœ‰ç»éªŒçš„å€™é€‰äºº
- é¢è¯•å®˜å¸Œæœ›ä½ èƒ½ç»™ä»–æƒŠå–œ
- é¢è¯•å®˜å¸Œæœ›ä½ èƒ½åŠ å…¥ä»–çš„å›¢é˜Ÿ

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… å±•ç¤ºçƒ­æƒ…ï¼šå¯¹æŠ€æœ¯æœ‰çƒ­æƒ…ï¼Œå¯¹é¡¹ç›®æœ‰çƒ­æƒ…
- âœ… å±•ç¤ºæ€è€ƒï¼šä¸åªæ˜¯æ‰§è¡Œè€…ï¼Œè¿˜æ˜¯æ€è€ƒè€…
- âœ… å±•ç¤ºä»·å€¼ï¼šä¸åªæ˜¯æŠ€æœ¯å®…ï¼Œè¿˜å…³å¿ƒä¸šåŠ¡

---

### ç¬¬68å±‚ï¼šé¢è¯•å®˜çš„3ä¸ªå±‚æ¬¡

**å±‚æ¬¡1ï¼šåˆçº§é¢è¯•å®˜ï¼ˆå…³æ³¨æŠ€æœ¯ï¼‰**
- é—®é¢˜ï¼šä½ ç”¨äº†ä»€ä¹ˆæŠ€æœ¯ï¼Ÿ
- å…³æ³¨ç‚¹ï¼šRedisã€Kafkaã€Sentinel
- åº”å¯¹ç­–ç•¥ï¼šè¯´å‡ºæŠ€æœ¯æ ˆï¼Œè¯´å‡ºæŠ€æœ¯åŸç†

**å±‚æ¬¡2ï¼šä¸­çº§é¢è¯•å®˜ï¼ˆå…³æ³¨æ–¹æ¡ˆï¼‰**
- é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ
- å…³æ³¨ç‚¹ï¼šæ–¹æ¡ˆå¯¹æ¯”ã€æƒè¡¡åˆ©å¼Š
- åº”å¯¹ç­–ç•¥ï¼šè¯´å‡ºä½ è€ƒè™‘è¿‡çš„å…¶ä»–æ–¹æ¡ˆï¼Œè¯´å‡ºä½ çš„æƒè¡¡

**å±‚æ¬¡3ï¼šé«˜çº§é¢è¯•å®˜ï¼ˆå…³æ³¨ä»·å€¼ï¼‰**
- é—®é¢˜ï¼šè¿™ä¸ªé¡¹ç›®çš„ä¸šåŠ¡ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
- å…³æ³¨ç‚¹ï¼šä¸šåŠ¡ä»·å€¼ã€ç”¨æˆ·ä½“éªŒã€æˆæœ¬æ”¶ç›Š
- åº”å¯¹ç­–ç•¥ï¼šè¯´å‡ºä¸šåŠ¡ä»·å€¼ï¼Œè¯´å‡ºé‡åŒ–æ•°æ®

---

### ç¬¬69å±‚ï¼šé¢è¯•å®˜çš„3ä¸ªç±»å‹

**ç±»å‹1ï¼šæŠ€æœ¯å‹é¢è¯•å®˜**
- ç‰¹ç‚¹ï¼šå…³æ³¨æŠ€æœ¯ç»†èŠ‚ï¼Œå–œæ¬¢é—®æŠ€æœ¯åŸç†
- é—®é¢˜ï¼šRedisä¸ºä»€ä¹ˆå¿«ï¼ŸLuaè„šæœ¬ä¸ºä»€ä¹ˆåŸå­æ€§ï¼Ÿ
- åº”å¯¹ç­–ç•¥ï¼šæ·±å…¥è®²è§£æŠ€æœ¯åŸç†ï¼Œå±•ç¤ºæŠ€æœ¯æ·±åº¦

**ç±»å‹2ï¼šä¸šåŠ¡å‹é¢è¯•å®˜**
- ç‰¹ç‚¹ï¼šå…³æ³¨ä¸šåŠ¡ä»·å€¼ï¼Œå–œæ¬¢é—®ä¸šåŠ¡åœºæ™¯
- é—®é¢˜ï¼šè¿™ä¸ªé¡¹ç›®è§£å†³äº†ä»€ä¹ˆä¸šåŠ¡é—®é¢˜ï¼Ÿ
- åº”å¯¹ç­–ç•¥ï¼šè®²æ¸…æ¥šä¸šåŠ¡åœºæ™¯ï¼Œå±•ç¤ºä¸šåŠ¡ç†è§£

**ç±»å‹3ï¼šç®¡ç†å‹é¢è¯•å®˜**
- ç‰¹ç‚¹ï¼šå…³æ³¨å›¢é˜Ÿåä½œï¼Œå–œæ¬¢é—®é¡¹ç›®ç®¡ç†
- é—®é¢˜ï¼šä½ åœ¨é¡¹ç›®ä¸­çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿä½ æ€ä¹ˆå’Œå›¢é˜Ÿåä½œï¼Ÿ
- åº”å¯¹ç­–ç•¥ï¼šè®²æ¸…æ¥šä½ çš„è§’è‰²ï¼Œå±•ç¤ºå›¢é˜Ÿåä½œèƒ½åŠ›

---

### ç¬¬70å±‚ï¼šé¢è¯•å®˜è§†è§’æ€»ç»“

**é¢è¯•å®˜çœŸæ­£æƒ³è¦çš„å€™é€‰äººï¼š**
1. **çœŸå®é¡¹ç›®ç»éªŒ**ï¼šä¸æ˜¯èƒŒé¢è¯•é¢˜ï¼Œæ˜¯çœŸæ­£å‚ä¸è¿‡é¡¹ç›®
2. **æŠ€æœ¯æ·±åº¦**ï¼šä¸åªæ˜¯ä¼šç”¨ï¼Œè¿˜ç†è§£åŸç†
3. **é—®é¢˜è§£å†³èƒ½åŠ›**ï¼šé‡åˆ°é—®é¢˜èƒ½æ’æŸ¥ã€èƒ½ä¼˜åŒ–
4. **ä¸šåŠ¡ç†è§£**ï¼šä¸åªæ˜¯æŠ€æœ¯å®…ï¼Œè¿˜å…³å¿ƒä¸šåŠ¡
5. **å›¢é˜Ÿåä½œ**ï¼šèƒ½å’Œå›¢é˜Ÿåä½œï¼Œèƒ½æ²Ÿé€š

**é¢è¯•å®˜ä¸æƒ³è¦çš„å€™é€‰äººï¼š**
1. **èƒŒé¢è¯•é¢˜**ï¼šè¯´ä¸å‡ºå…·ä½“ç»†èŠ‚
2. **åªä¼šç”¨**ï¼šä¸ç†è§£åŸç†
3. **æ²¡æœ‰æ€è€ƒ**ï¼šè¯´ä¸å‡ºä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
4. **æŠ€æœ¯å®…**ï¼šä¸å…³å¿ƒä¸šåŠ¡
5. **å•æ‰“ç‹¬æ–—**ï¼šä¸ä¼šå›¢é˜Ÿåä½œ

**é¢è¯•æˆåŠŸçš„å…³é”®ï¼š**
- âœ… **çœŸå®**ï¼šè¯´å‡ºå…·ä½“çš„æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©ã€æ•°æ®
- âœ… **æ·±åº¦**ï¼šè¯´å‡ºæŠ€æœ¯åŸç†ã€æ–¹æ¡ˆå¯¹æ¯”ã€æƒè¡¡åˆ©å¼Š
- âœ… **ä»·å€¼**ï¼šè¯´å‡ºä¸šåŠ¡ä»·å€¼ã€é‡åŒ–æ•°æ®ã€ç»éªŒæ•™è®­
- âœ… **çƒ­æƒ…**ï¼šå¯¹æŠ€æœ¯æœ‰çƒ­æƒ…ï¼Œå¯¹é¡¹ç›®æœ‰çƒ­æƒ…
- âœ… **è°¦è™š**ï¼šæ‰¿è®¤ä¸è¶³ï¼Œè¯´å‡ºä¼˜åŒ–ç©ºé—´

---

## ç¬¬71-80å±‚ï¼šé¢è¯•è€…åº”å¯¹ç­–ç•¥

### ç¬¬71å±‚ï¼š30ç§’å¼€åœºç™½ï¼ˆé»„é‡‘å¼€åœºï¼‰

**å¼€åœºç™½æ¨¡æ¿ï¼š**

"æˆ‘åœ¨äººä¿è½¦é™©é¡¹ç›®ä¸­è´Ÿè´£ä¼˜æƒ åˆ¸æŠ¢è´­åŠŸèƒ½çš„å¼€å‘ã€‚è¿™æ˜¯2025å¹´1æœˆçš„'å¼€é—¨çº¢'æ´»åŠ¨ï¼Œé™é‡10000å¼ ä¼˜æƒ åˆ¸ï¼Œç«‹å‡200å…ƒã€‚æ´»åŠ¨å¸å¼•äº†10ä¸‡äººå‚ä¸ï¼ŒQPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œç›¸å¯¹å¹³æ—¶å¢é•¿333å€ã€‚

æˆ‘è´Ÿè´£æ ¸å¿ƒæ¨¡å—çš„è®¾è®¡å’Œå¼€å‘ï¼š**Redis + Luaè„šæœ¬é˜²è¶…å–ã€Sentinelé™æµä¿æŠ¤ç³»ç»Ÿã€Kafkaå¼‚æ­¥å†™å…¥æå‡å“åº”é€Ÿåº¦**ã€‚

é‡åˆ°çš„æœ€å¤§æŒ‘æˆ˜æ˜¯ï¼šQPS 3000æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨CPU 100%ï¼Œå“åº”æ—¶é—´P95 1500msã€‚æˆ‘é€šè¿‡**æ‰©å®¹åˆ°30å°æœåŠ¡å™¨ã€å¢åŠ Kafkaæ¶ˆè´¹è€…ã€éªŒè¯ç å¼‚æ­¥æ ¡éªŒ**ï¼Œä¼˜åŒ–åå“åº”æ—¶é—´P95é™åˆ°500msï¼Œæå‡67%ã€‚

è¿™ä¸ªé¡¹ç›®è®©æˆ‘æ·±å…¥ç†è§£äº†é«˜å¹¶å‘åœºæ™¯çš„è®¾è®¡å’Œä¼˜åŒ–ï¼ŒæŒæ¡äº†Redisã€Kafkaã€Sentinelçš„å®æˆ˜åº”ç”¨ã€‚"

**å¼€åœºç™½è¦ç‚¹ï¼š**
- âœ… æ—¶é—´åœ°ç‚¹ï¼š2025å¹´1æœˆã€äººä¿è½¦é™©ã€å¼€é—¨çº¢æ´»åŠ¨
- âœ… ä¸šåŠ¡åœºæ™¯ï¼š10000å¼ åˆ¸ã€10ä¸‡äººå‚ä¸ã€QPS 833
- âœ… æŠ€æœ¯æ–¹æ¡ˆï¼šRedis + Luaã€Sentinelã€Kafka
- âœ… æ ¸å¿ƒé—®é¢˜ï¼šQPS 3000ã€CPU 100%ã€å“åº”æ—¶é—´1500ms
- âœ… ä¼˜åŒ–æ•ˆæœï¼šå“åº”æ—¶é—´é™åˆ°500msã€æå‡67%
- âœ… ä¸ªäººæ”¶è·ï¼šæ·±å…¥ç†è§£é«˜å¹¶å‘ã€æŒæ¡å®æˆ˜åº”ç”¨

---

### ç¬¬72å±‚ï¼š5ä¸ªå¿…é—®é—®é¢˜çš„æ ‡å‡†ç­”æ¡ˆ

**å¿…é—®1ï¼šä½ ä»¬çš„QPSæ˜¯å¤šå°‘ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬çš„QPSæ˜¯**833æ¬¡/ç§’**ï¼ˆæ­£å¸¸ä¼°è®¡ï¼‰ï¼Œå³°å€¼QPS **1666æ¬¡/ç§’**ï¼ˆå‰30ç§’ï¼‰ã€‚

è™½ç„¶ç»å¯¹å¹¶å‘é‡ä¸é«˜ï¼Œä½†æˆ‘ä»¬è½¦é™©ä¸šåŠ¡å¹³æ—¶QPSåªæœ‰2.5æ¬¡/ç§’ï¼Œä¼˜æƒ åˆ¸æŠ¢è´­æ—¶QPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œ**ç›¸å¯¹å¢é•¿333å€**ã€‚

æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜å’Œç”µå•†ç§’æ€æ˜¯ä¸€æ ·çš„ï¼š**é˜²è¶…å–ã€é˜²åˆ·ã€é«˜å¯ç”¨**ã€‚"

**è¯æœ¯æŠ€å·§ï¼š**
- âœ… å…ˆè¯´æ•°æ®ï¼š833æ¬¡/ç§’
- âœ… å†è¯´å¯¹æ¯”ï¼šç›¸å¯¹å¢é•¿333å€
- âœ… æœ€åè¯´ä»·å€¼ï¼šè§£å†³é˜²è¶…å–ã€é˜²åˆ·ã€é«˜å¯ç”¨

---

**å¿…é—®2ï¼šä¸ºä»€ä¹ˆç”¨Redisè€Œä¸æ˜¯MySQLï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬å¯¹æ¯”äº†3ç§æ–¹æ¡ˆï¼š**MySQLåŠ é”ã€Redis + Luaã€åˆ†å¸ƒå¼é”**ã€‚

**MySQLåŠ é”**ï¼š
- ä¼˜ç‚¹ï¼šç®€å•
- ç¼ºç‚¹ï¼šQPSåªæœ‰100-200ï¼Œæ— æ³•æ”¯æ’‘833æ¬¡/ç§’
- ç»“è®ºï¼šæ€§èƒ½ä¸å¤Ÿ

**åˆ†å¸ƒå¼é”**ï¼š
- ä¼˜ç‚¹ï¼šé˜²è¶…å–
- ç¼ºç‚¹ï¼šéœ€è¦å¼•å…¥Zookeeperæˆ–Redissonï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- ç»“è®ºï¼šè¿‡åº¦è®¾è®¡

**Redis + Luaè„šæœ¬**ï¼š
- ä¼˜ç‚¹ï¼šQPS 10ä¸‡+ï¼ŒåŸå­æ€§ï¼Œç®€å•
- ç¼ºç‚¹ï¼šéœ€è¦Redisé›†ç¾¤
- ç»“è®ºï¼šæ€§èƒ½å¥½ã€ç®€å•ã€å¤Ÿç”¨

æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†**Redis + Luaè„šæœ¬**ã€‚"

**è¯æœ¯æŠ€å·§ï¼š**
- âœ… è¯´å‡º3ç§æ–¹æ¡ˆ
- âœ… å¯¹æ¯”ä¼˜ç¼ºç‚¹
- âœ… è¯´å‡ºé€‰æ‹©ç†ç”±

---

**å¿…é—®3ï¼šRediså®•æœºäº†æ€ä¹ˆåŠï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬æœ‰3ä¸ªæ–¹æ¡ˆï¼š**Redisé›†ç¾¤ã€æœ¬åœ°ç¼“å­˜ã€é™çº§**ã€‚

**Redisé›†ç¾¤**ï¼ˆä¸»æ–¹æ¡ˆï¼‰ï¼š
- 3ä¸»3ä»ï¼Œä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨åˆ‡æ¢
- é«˜å¯ç”¨ï¼Œä¸ä¼šå•ç‚¹æ•…éšœ

**æœ¬åœ°ç¼“å­˜**ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰ï¼š
- åº”ç”¨æœåŠ¡å™¨æœ¬åœ°ç¼“å­˜æ´»åŠ¨ä¿¡æ¯ï¼ˆCaffeineï¼‰
- Rediså®•æœºæ—¶ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜
- TTLè®¾ç½®ä¸º5åˆ†é’Ÿ

**é™çº§æ–¹æ¡ˆ**ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰ï¼š
- Rediså®•æœºæ—¶ï¼Œç›´æ¥è¿”å›'ç³»ç»Ÿç¹å¿™'
- ä¸æŸ¥è¯¢MySQLï¼Œä¿æŠ¤æ•°æ®åº“

å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„Redisé›†ç¾¤è¿è¡Œäº†3ä¸ªæœˆï¼Œæ²¡æœ‰å‡ºç°è¿‡å®•æœºã€‚"

**è¯æœ¯æŠ€å·§ï¼š**
- âœ… è¯´å‡º3ä¸ªæ–¹æ¡ˆ
- âœ… åˆ†ä¸»å¤‡å…œåº•
- âœ… è¯´å‡ºå®é™…æƒ…å†µ

---

**å¿…é—®4ï¼šKafkaæ¶ˆæ¯ä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬æœ‰3ä¸ªæ–¹æ¡ˆï¼š**Kafkaé‡è¯•ã€å®šæ—¶ä»»åŠ¡è¡¥å¿ã€ç”¨æˆ·æŸ¥è¯¢æ—¶è¡¥å¿**ã€‚

**Kafkaé‡è¯•**ï¼ˆç¬¬ä¸€é“é˜²çº¿ï¼‰ï¼š
- æ¶ˆè´¹å¤±è´¥åï¼Œè‡ªåŠ¨é‡è¯•3æ¬¡
- é‡è¯•é—´éš”ï¼š1ç§’ã€5ç§’ã€10ç§’
- 3æ¬¡é‡è¯•åä»å¤±è´¥ï¼Œè®°å½•åˆ°æ­»ä¿¡é˜Ÿåˆ—

**å®šæ—¶ä»»åŠ¡è¡¥å¿**ï¼ˆç¬¬äºŒé“é˜²çº¿ï¼‰ï¼š
- æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
- å¯¹æ¯”Rediså’ŒMySQLæ•°æ®
- å‘ç°ä¸ä¸€è‡´ï¼Œè¡¥å¿å†™å…¥MySQL

**ç”¨æˆ·æŸ¥è¯¢æ—¶è¡¥å¿**ï¼ˆç¬¬ä¸‰é“é˜²çº¿ï¼‰ï¼š
- ç”¨æˆ·æŸ¥è¯¢ä¼˜æƒ åˆ¸åˆ—è¡¨æ—¶ï¼Œå…ˆæŸ¥MySQL
- å¦‚æœMySQLæ²¡æœ‰ï¼Œå†æŸ¥Redis
- å¦‚æœRedisæœ‰ï¼Œè¡¥å¿å†™å…¥MySQL

å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„Kafkaæ¶ˆæ¯æˆåŠŸç‡99.99%ï¼Œæå°‘å‡ºç°ä¸¢å¤±ã€‚"

**è¯æœ¯æŠ€å·§ï¼š**
- âœ… è¯´å‡º3é“é˜²çº¿
- âœ… å±‚å±‚ä¿æŠ¤
- âœ… è¯´å‡ºå®é™…æƒ…å†µ

---

**å¿…é—®5ï¼šä½ ä»¬çš„å“åº”æ—¶é—´æ˜¯å¤šå°‘ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬çš„å“åº”æ—¶é—´ï¼š**P50 200msã€P95 500msã€P99 1000ms**ã€‚

**ä¼˜åŒ–å‰**ï¼š
- P50ï¼š350ms
- P95ï¼š1500ms
- P99ï¼š3000ms

**ä¼˜åŒ–å**ï¼š
- P50ï¼š200msï¼ˆæå‡43%ï¼‰
- P95ï¼š500msï¼ˆæå‡67%ï¼‰
- P99ï¼š1000msï¼ˆæå‡67%ï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
1. **éªŒè¯ç å¼‚æ­¥æ ¡éªŒ**ï¼šè€—æ—¶ä»20msé™åˆ°5ms
2. **åˆ†æ®µåº“å­˜**ï¼šå•Keyå‹åŠ›é™ä½10å€
3. **æœ¬åœ°ç¼“å­˜**ï¼šå‡å°‘RedisæŸ¥è¯¢
4. **æ‰©å®¹æœåŠ¡å™¨**ï¼š10å° â†’ 30å°
5. **å¢åŠ Kafkaæ¶ˆè´¹è€…**ï¼š10ä¸ª â†’ 20ä¸ª"

**è¯æœ¯æŠ€å·§ï¼š**
- âœ… è¯´å‡ºP50ã€P95ã€P99
- âœ… å¯¹æ¯”ä¼˜åŒ–å‰å
- âœ… è¯´å‡ºä¼˜åŒ–æ–¹æ¡ˆ

---

### ç¬¬73å±‚ï¼š3ä¸ªé€‰é—®é—®é¢˜çš„æ ‡å‡†ç­”æ¡ˆ

**é€‰é—®1ï¼šä½ ä»¬æ€ä¹ˆé˜²åˆ·çš„ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬æœ‰5ä¸ªæ–¹æ¡ˆï¼š**éªŒè¯ç ã€IPé™æµã€ç”¨æˆ·é™æµã€è®¾å¤‡æŒ‡çº¹ã€è¡Œä¸ºåˆ†æ**ã€‚

**éªŒè¯ç **ï¼ˆç¬¬ä¸€é“é˜²çº¿ï¼‰ï¼š
- æ»‘åŠ¨éªŒè¯ç ï¼ˆè…¾è®¯äº‘éªŒè¯ç ï¼‰
- é˜²æ­¢è„šæœ¬åˆ·åˆ¸

**IPé™æµ**ï¼ˆç¬¬äºŒé“é˜²çº¿ï¼‰ï¼š
- 1åˆ†é’Ÿå†…åŒä¸€IPæœ€å¤šè¯·æ±‚10æ¬¡
- è¶…è¿‡10æ¬¡ï¼Œè¿”å›'è¯·æ±‚è¿‡äºé¢‘ç¹'

**ç”¨æˆ·é™æµ**ï¼ˆç¬¬ä¸‰é“é˜²çº¿ï¼‰ï¼š
- æ¯ä¸ªç”¨æˆ·åªèƒ½é¢†å–1å¼ åˆ¸
- Redisè®°å½•ç”¨æˆ·é¢†å–è®°å½•

**è®¾å¤‡æŒ‡çº¹**ï¼ˆç¬¬å››é“é˜²çº¿ï¼‰ï¼š
- è®°å½•ç”¨æˆ·è®¾å¤‡ä¿¡æ¯ï¼ˆæµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿã€å±å¹•åˆ†è¾¨ç‡ï¼‰
- åŒä¸€è®¾å¤‡åªèƒ½é¢†å–1å¼ åˆ¸

**è¡Œä¸ºåˆ†æ**ï¼ˆç¬¬äº”é“é˜²çº¿ï¼‰ï¼š
- è®°å½•ç”¨æˆ·ç‚¹å‡»æ—¶é—´é—´éš”
- æ­£å¸¸ç”¨æˆ·ï¼šç‚¹å‡»é—´éš” > 1ç§’
- è„šæœ¬åˆ·åˆ¸ï¼šç‚¹å‡»é—´éš” < 0.1ç§’

å®é™…ä¸Šï¼Œæˆ‘ä»¬æ‹¦æˆªäº†çº¦5%çš„åˆ·åˆ¸è¯·æ±‚ã€‚"

---

**é€‰é—®2ï¼šä½ ä»¬æœ‰æ²¡æœ‰åšå‹æµ‹ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘ä»¬åšäº†3ä¸ªåœºæ™¯çš„å‹æµ‹ï¼š**QPS 833ã€QPS 1666ã€QPS 3000**ã€‚

**åœºæ™¯1ï¼šQPS 833**ï¼ˆæ­£å¸¸åœºæ™¯ï¼‰
- ç³»ç»Ÿç¨³å®šï¼Œå“åº”æ—¶é—´P95 450ms
- åº”ç”¨æœåŠ¡å™¨CPU 60-70%

**åœºæ™¯2ï¼šQPS 1666**ï¼ˆå³°å€¼åœºæ™¯ï¼‰
- æ¥è¿‘ç“¶é¢ˆï¼Œå“åº”æ—¶é—´P95 800ms
- åº”ç”¨æœåŠ¡å™¨CPU 80-90%

**åœºæ™¯3ï¼šQPS 3000**ï¼ˆæé™åœºæ™¯ï¼‰
- ä¼˜åŒ–å‰ï¼šç“¶é¢ˆï¼Œå“åº”æ—¶é—´P95 1500msï¼ŒCPU 100%
- ä¼˜åŒ–åï¼šç¨³å®šï¼Œå“åº”æ—¶é—´P95 500msï¼ŒCPU 60-70%

**å‹æµ‹å·¥å…·**ï¼šJMeter 5.5
**ç›‘æ§å·¥å…·**ï¼šPrometheus + Grafana"

---

**é€‰é—®3ï¼šä½ åœ¨è¿™ä¸ªé¡¹ç›®ä¸­çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼š**
"æˆ‘æ˜¯**æ ¸å¿ƒå¼€å‘**ï¼Œè´Ÿè´£**æŠ¢åˆ¸æ¥å£ã€Redisæ‰£å‡åº“å­˜ã€Kafkaå¼‚æ­¥å†™å…¥**3ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚

**æˆ‘çš„è´¡çŒ®**ï¼š
1. **è®¾è®¡Luaè„šæœ¬é˜²è¶…å–**ï¼šä¿è¯10000å¼ åˆ¸ä¸ä¼šè¢«æŠ¢è´­10001æ¬¡
2. **ä¼˜åŒ–å“åº”æ—¶é—´**ï¼šä»1500msé™åˆ°500msï¼Œæå‡67%
3. **å‹æµ‹å‘ç°ç“¶é¢ˆ**ï¼šå‘ç°QPS 3000æ—¶CPU 100%ï¼Œå¹¶ä¼˜åŒ–

**æˆ‘çš„æ”¶è·**ï¼š
1. **æŠ€æœ¯æ·±åº¦**ï¼šæ·±å…¥ç†è§£Redisã€Kafkaã€Sentinel
2. **é—®é¢˜è§£å†³**ï¼šæŒæ¡é«˜å¹¶å‘åœºæ™¯çš„è®¾è®¡å’Œä¼˜åŒ–
3. **ä¸šåŠ¡ç†è§£**ï¼šç†è§£è½¦é™©ä¸šåŠ¡ï¼Œå…³æ³¨ç”¨æˆ·ä½“éªŒ

**å›¢é˜Ÿåä½œ**ï¼š
- å’Œäº§å“ç»ç†æ²Ÿé€šéœ€æ±‚
- å’Œæµ‹è¯•å·¥ç¨‹å¸ˆåä½œå‹æµ‹
- å’Œè¿ç»´å·¥ç¨‹å¸ˆåä½œéƒ¨ç½²"

---

### ç¬¬74å±‚ï¼š3ä¸ªæ•‘åœºè¯æœ¯

**æ•‘åœºè¯æœ¯1ï¼šä¸çŸ¥é“æ€ä¹ˆå›ç­”**

**åœºæ™¯ï¼š**
- é¢è¯•å®˜é—®äº†ä¸€ä¸ªä½ ä¸çŸ¥é“çš„é—®é¢˜
- ä½ ä¸çŸ¥é“æ€ä¹ˆå›ç­”

**é”™è¯¯å›ç­”ï¼š**
- "ä¸çŸ¥é“"ï¼ˆå¤ªç›´æ¥ï¼‰
- "æˆ‘æ²¡åšè¿‡"ï¼ˆå¤ªæ¶ˆæï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- "è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œä½†æˆ‘å¯ä»¥è¯´è¯´æˆ‘çš„ç†è§£ã€‚"
- "è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰é‡åˆ°è¿‡ï¼Œä½†å¦‚æœé‡åˆ°ï¼Œæˆ‘ä¼šè¿™æ ·è§£å†³..."
- "è¿™ä¸ªé—®é¢˜æˆ‘ä¸å¤ªç¡®å®šï¼Œä½†æˆ‘å¯ä»¥æŸ¥èµ„æ–™åå†å›å¤æ‚¨ã€‚"

**è¯æœ¯æ¨¡æ¿ï¼š**
- "è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œä½†æˆ‘å¯ä»¥è¯´è¯´æˆ‘çš„ç†è§£ã€‚æˆ‘è®¤ä¸º...ï¼ˆè¯´å‡ºä½ çš„ç†è§£ï¼‰ã€‚å¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·æ‚¨æŒ‡æ­£ã€‚"

---

**æ•‘åœºè¯æœ¯2ï¼šè¢«è´¨ç–‘é¡¹ç›®çœŸå®æ€§**

**åœºæ™¯ï¼š**
- é¢è¯•å®˜è´¨ç–‘ä½ çš„é¡¹ç›®æ˜¯å‡çš„
- é¢è¯•å®˜è¯´"ä½ è¿™ä¸ªé¡¹ç›®æ˜¯èƒŒçš„å§"

**é”™è¯¯å›ç­”ï¼š**
- "ä¸æ˜¯èƒŒçš„"ï¼ˆå¤ªç›´æ¥ï¼‰
- "æˆ‘çœŸçš„åšè¿‡"ï¼ˆæ²¡æœ‰è¯´æœåŠ›ï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- è¯´å‡ºå…·ä½“çš„æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©
- è¯´å‡ºå…·ä½“çš„æ•°æ®
- è¯´å‡ºé‡åˆ°çš„é—®é¢˜

**è¯æœ¯æ¨¡æ¿ï¼š**
- "è¿™ä¸ªé¡¹ç›®æ˜¯2025å¹´1æœˆåšçš„ï¼Œæˆ‘æ˜¯æ ¸å¿ƒå¼€å‘ï¼Œè´Ÿè´£æŠ¢åˆ¸æ¥å£ã€Redisæ‰£å‡åº“å­˜ã€Kafkaå¼‚æ­¥å†™å…¥ã€‚æˆ‘ä»¬é‡åˆ°çš„æœ€å¤§é—®é¢˜æ˜¯QPS 3000æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨CPU 100%ï¼Œå“åº”æ—¶é—´P95 1500msã€‚æˆ‘é€šè¿‡æ‰©å®¹åˆ°30å°æœåŠ¡å™¨ã€å¢åŠ Kafkaæ¶ˆè´¹è€…ã€éªŒè¯ç å¼‚æ­¥æ ¡éªŒï¼Œä¼˜åŒ–åå“åº”æ—¶é—´P95é™åˆ°500msã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œæˆ‘å¯ä»¥è¯¦ç»†è¯´æ˜ã€‚"

---

**æ•‘åœºè¯æœ¯3ï¼šè¢«è´¨ç–‘æŠ€æœ¯æ–¹æ¡ˆ**

**åœºæ™¯ï¼š**
- é¢è¯•å®˜è´¨ç–‘ä½ çš„æŠ€æœ¯æ–¹æ¡ˆ
- é¢è¯•å®˜è¯´"ä¸ºä»€ä¹ˆä¸ç”¨XXXæ–¹æ¡ˆ"

**é”™è¯¯å›ç­”ï¼š**
- "æˆ‘ä»¬å°±æ˜¯è¿™æ ·åšçš„"ï¼ˆæ²¡æœ‰è§£é‡Šï¼‰
- "æˆ‘ä¸çŸ¥é“"ï¼ˆå¤ªæ¶ˆæï¼‰

**æ­£ç¡®å›ç­”ï¼š**
- æ‰¿è®¤ä¸è¶³
- è¯´å‡ºä½ è€ƒè™‘è¿‡çš„å…¶ä»–æ–¹æ¡ˆ
- è¯´å‡ºä½ çš„æƒè¡¡

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æ‚¨è¯´å¾—å¯¹ï¼ŒXXXæ–¹æ¡ˆç¡®å®æ˜¯ä¸€ä¸ªå¥½æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¹Ÿè€ƒè™‘è¿‡ï¼Œä½†XXXæ–¹æ¡ˆæœ‰XXXç¼ºç‚¹ï¼ˆè¯´å‡ºç¼ºç‚¹ï¼‰ã€‚æˆ‘ä»¬çš„æ–¹æ¡ˆè™½ç„¶æœ‰XXXä¸è¶³ï¼ˆæ‰¿è®¤ä¸è¶³ï¼‰ï¼Œä½†XXXä¼˜ç‚¹ï¼ˆè¯´å‡ºä¼˜ç‚¹ï¼‰ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼šä¸è¿‡åº¦è®¾è®¡ï¼Œå¤Ÿç”¨å°±å¥½ã€‚"

---

### ç¬¬75å±‚ï¼š3ä¸ªé™·é˜±çš„åº”å¯¹ç­–ç•¥

**é™·é˜±1ï¼šä½ ä»¬çš„QPSè¿™ä¹ˆé«˜ï¼Œä¸ºä»€ä¹ˆä¸ç”¨Nginxé™æµï¼Ÿ**

**é™·é˜±åˆ†æï¼š**
- é¢è¯•å®˜æ•…æ„è¯´"QPSè¿™ä¹ˆé«˜"
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦ä¼šè¢«è¯¯å¯¼

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… çº æ­£ï¼šQPS 833ä¸ç®—é«˜
- âœ… è§£é‡Šï¼šä¸ºä»€ä¹ˆç”¨Sentinelè€Œä¸æ˜¯Nginx
- âœ… å¯¹æ¯”ï¼šSentinel vs Nginx

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æˆ‘ä»¬çš„QPSæ˜¯833æ¬¡/ç§’ï¼Œä¸ç®—ç‰¹åˆ«é«˜ã€‚æˆ‘ä»¬ç”¨çš„æ˜¯Sentinelé™æµï¼Œä¸æ˜¯Nginxé™æµã€‚Sentinelæ˜¯åº”ç”¨å±‚é™æµï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒæ¥å£è®¾ç½®ä¸åŒçš„é™æµè§„åˆ™ã€‚Nginxæ˜¯ç½‘å…³å±‚é™æµï¼Œåªèƒ½é’ˆå¯¹æ•´ä¸ªæœåŠ¡é™æµã€‚æˆ‘ä»¬çš„åœºæ™¯æ˜¯ï¼šæŠ¢åˆ¸æ¥å£QPSé™åˆ¶1000ï¼ŒæŸ¥è¯¢æ¥å£QPSé™åˆ¶2000ï¼Œæ‰€ä»¥ç”¨Sentinelæ›´åˆé€‚ã€‚"

---

**é™·é˜±2ï¼šä½ ä»¬çš„Redisé›†ç¾¤æ˜¯3ä¸»3ä»ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯5ä¸»5ä»ï¼Ÿ**

**é™·é˜±åˆ†æï¼š**
- é¢è¯•å®˜æ•…æ„è¯´"5ä¸»5ä»"
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦ä¼šè¢«è¯¯å¯¼

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… çº æ­£ï¼š3ä¸»3ä»å°±å¤Ÿäº†
- âœ… è§£é‡Šï¼šä¸ºä»€ä¹ˆä¸ç”¨5ä¸»5ä»
- âœ… æƒè¡¡ï¼šæˆæœ¬ vs æ€§èƒ½

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æˆ‘ä»¬ç”¨çš„æ˜¯3ä¸»3ä»ï¼Œä¸æ˜¯5ä¸»5ä»ã€‚3ä¸»3ä»å·²ç»è¶³å¤Ÿæ”¯æ’‘QPS 833ï¼Œè€Œä¸”æˆæœ¬å¯æ§ã€‚5ä¸»5ä»ä¼šå¢åŠ æˆæœ¬ï¼Œä½†æ€§èƒ½æå‡ä¸æ˜æ˜¾ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼šä¸è¿‡åº¦è®¾è®¡ï¼Œå¤Ÿç”¨å°±å¥½ã€‚å¦‚æœæœªæ¥QPSå¢é•¿åˆ°5000+ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘æ‰©å®¹åˆ°5ä¸»5ä»ã€‚"

---

**é™·é˜±3ï¼šä½ ä»¬çš„Kafkaåˆ†åŒºæ•°æ˜¯10ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯100ï¼Ÿ**

**é™·é˜±åˆ†æï¼š**
- é¢è¯•å®˜æ•…æ„è¯´"100"
- é¢è¯•å®˜æƒ³çœ‹ä½ æ˜¯å¦ä¼šè¢«è¯¯å¯¼

**åº”å¯¹ç­–ç•¥ï¼š**
- âœ… çº æ­£ï¼š10ä¸ªåˆ†åŒºå°±å¤Ÿäº†
- âœ… è§£é‡Šï¼šä¸ºä»€ä¹ˆä¸ç”¨100ä¸ªåˆ†åŒº
- âœ… åŸåˆ™ï¼šåˆ†åŒºæ•° = æœåŠ¡å™¨æ•°

**è¯æœ¯æ¨¡æ¿ï¼š**
- "æˆ‘ä»¬ç”¨çš„æ˜¯10ä¸ªåˆ†åŒºï¼Œä¸æ˜¯100ä¸ªåˆ†åŒºã€‚10ä¸ªåˆ†åŒºå¯¹åº”10å°åº”ç”¨æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨å¯¹åº”1ä¸ªåˆ†åŒºï¼Œæå‡å¹¶å‘å†™å…¥èƒ½åŠ›ã€‚100ä¸ªåˆ†åŒºä¼šå¢åŠ Kafkaçš„ç®¡ç†æˆæœ¬ï¼Œä½†æ€§èƒ½æå‡ä¸æ˜æ˜¾ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼šåˆ†åŒºæ•° = æœåŠ¡å™¨æ•°ã€‚"

---

### ç¬¬76å±‚ï¼šSTARæ³•åˆ™åº”ç”¨

**ä»€ä¹ˆæ˜¯STARæ³•åˆ™ï¼Ÿ**
- **S**ituationï¼ˆæƒ…å¢ƒï¼‰ï¼šä»€ä¹ˆåœºæ™¯ï¼Ÿ
- **T**askï¼ˆä»»åŠ¡ï¼‰ï¼šä½ çš„ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ
- **A**ctionï¼ˆè¡ŒåŠ¨ï¼‰ï¼šä½ åšäº†ä»€ä¹ˆï¼Ÿ
- **R**esultï¼ˆç»“æœï¼‰ï¼šç»“æœå¦‚ä½•ï¼Ÿ

**STARæ³•åˆ™ç¤ºä¾‹ï¼š**

**Sï¼ˆæƒ…å¢ƒï¼‰ï¼š**
"2025å¹´1æœˆï¼Œäººä¿è½¦é™©'å¼€é—¨çº¢'æ´»åŠ¨ï¼Œé™é‡10000å¼ ä¼˜æƒ åˆ¸ï¼Œç«‹å‡200å…ƒã€‚æ´»åŠ¨å¸å¼•äº†10ä¸‡äººå‚ä¸ï¼ŒQPSè¾¾åˆ°833æ¬¡/ç§’ï¼Œç›¸å¯¹å¹³æ—¶å¢é•¿333å€ã€‚"

**Tï¼ˆä»»åŠ¡ï¼‰ï¼š**
"æˆ‘è´Ÿè´£ä¼˜æƒ åˆ¸æŠ¢è´­åŠŸèƒ½çš„å¼€å‘ï¼Œæ ¸å¿ƒä»»åŠ¡æ˜¯ï¼š**é˜²è¶…å–ã€é˜²åˆ·ã€é«˜å¯ç”¨ã€å“åº”æ—¶é—´ < 1ç§’**ã€‚"

**Aï¼ˆè¡ŒåŠ¨ï¼‰ï¼š**
"æˆ‘è®¾è®¡äº†å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆï¼š
1. **Redis + Luaè„šæœ¬é˜²è¶…å–**ï¼šä¿è¯10000å¼ åˆ¸ä¸ä¼šè¢«æŠ¢è´­10001æ¬¡
2. **Sentinelé™æµä¿æŠ¤ç³»ç»Ÿ**ï¼šQPSé™åˆ¶1000ï¼Œè¶…è¿‡çš„è¯·æ±‚è¿”å›'ç³»ç»Ÿç¹å¿™'
3. **Kafkaå¼‚æ­¥å†™å…¥**ï¼šæå‡å“åº”é€Ÿåº¦ï¼Œå“åº”æ—¶é—´ä»60msé™åˆ°10ms
4. **éªŒè¯ç  + IPé™æµé˜²åˆ·**ï¼šæ‹¦æˆª5%çš„åˆ·åˆ¸è¯·æ±‚
5. **å‹æµ‹å‘ç°ç“¶é¢ˆå¹¶ä¼˜åŒ–**ï¼šQPS 3000æ—¶ï¼ŒCPU 100%ï¼Œé€šè¿‡æ‰©å®¹å’Œä¼˜åŒ–ï¼ŒCPUé™åˆ°60-70%"

**Rï¼ˆç»“æœï¼‰ï¼š**
"æ´»åŠ¨æˆåŠŸä¸¾åŠï¼Œ10000å¼ åˆ¸åœ¨3åˆ†é’Ÿå†…æŠ¢å®Œï¼Œç³»ç»Ÿç¨³å®šï¼Œæ— æ•…éšœã€‚å“åº”æ—¶é—´P95 500msï¼Œç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚8000äººä½¿ç”¨ä¼˜æƒ åˆ¸æŠ•ä¿ï¼Œç»­ä¿è½¬åŒ–ç‡æå‡25ä¸ªç™¾åˆ†ç‚¹ï¼Œä¸ºå…¬å¸å¸¦æ¥1600ä¸‡å…ƒä¿è´¹æ”¶å…¥ã€‚"

**STARæ³•åˆ™çš„å¥½å¤„ï¼š**
- âœ… ç»“æ„æ¸…æ™°ï¼šæƒ…å¢ƒ â†’ ä»»åŠ¡ â†’ è¡ŒåŠ¨ â†’ ç»“æœ
- âœ… é€»è¾‘å®Œæ•´ï¼šä»é—®é¢˜åˆ°è§£å†³æ–¹æ¡ˆåˆ°ç»“æœ
- âœ… è¯´æœåŠ›å¼ºï¼šæœ‰æ•°æ®ã€æœ‰ç»†èŠ‚ã€æœ‰ç»“æœ

---

### ç¬¬77å±‚ï¼šæ•°å­—è®°å¿†æŠ€å·§

**ä¸ºä»€ä¹ˆè¦è®°æ•°å­—ï¼Ÿ**
- é¢è¯•å®˜æœ€çˆ±é—®æ•°å­—
- æ•°å­—æ˜¯çœŸå®æ€§çš„è¯æ˜
- æ•°å­—æ˜¯ä¸“ä¸šæ€§çš„ä½“ç°

**æ ¸å¿ƒæ•°å­—æ¸…å•ï¼š**

**ä¸šåŠ¡æ•°å­—ï¼š**
- æ´»åŠ¨æ—¶é—´ï¼š2025å¹´1æœˆ1æ—¥ ä¸Šåˆ10:00
- ä¼˜æƒ åˆ¸æ•°é‡ï¼š10000å¼ 
- ä¼˜æƒ é‡‘é¢ï¼š200å…ƒ
- å‚ä¸äººæ•°ï¼š10ä¸‡äºº
- æˆåŠŸäººæ•°ï¼š10000äºº
- æˆåŠŸç‡ï¼š6.7%
- ä½¿ç”¨äººæ•°ï¼š8000äºº
- ä¿è´¹æ”¶å…¥ï¼š1600ä¸‡å…ƒ

**æŠ€æœ¯æ•°å­—ï¼š**
- å¹³æ—¶QPSï¼š2.5æ¬¡/ç§’
- æŠ¢åˆ¸QPSï¼š833æ¬¡/ç§’
- å³°å€¼QPSï¼š1666æ¬¡/ç§’
- ç›¸å¯¹å¢é•¿ï¼š333å€
- å“åº”æ—¶é—´P50ï¼š200ms
- å“åº”æ—¶é—´P95ï¼š500ms
- å“åº”æ—¶é—´P99ï¼š1000ms
- ä¼˜åŒ–æå‡ï¼š67%

**ç³»ç»Ÿæ•°å­—ï¼š**
- åº”ç”¨æœåŠ¡å™¨ï¼š10å° â†’ 30å°
- Redisé›†ç¾¤ï¼š3ä¸»3ä»
- Kafkaåˆ†åŒºï¼š10ä¸ª
- Kafkaæ¶ˆè´¹è€…ï¼š10ä¸ª â†’ 20ä¸ª
- åº”ç”¨æœåŠ¡å™¨CPUï¼š60-70%
- Redis CPUï¼š40-50%
- MySQL CPUï¼š15-25%

**è®°å¿†æŠ€å·§ï¼š**
1. **åˆ†ç±»è®°å¿†**ï¼šä¸šåŠ¡æ•°å­—ã€æŠ€æœ¯æ•°å­—ã€ç³»ç»Ÿæ•°å­—
2. **å¯¹æ¯”è®°å¿†**ï¼šä¼˜åŒ–å‰ vs ä¼˜åŒ–å
3. **å…³è”è®°å¿†**ï¼š10000å¼ åˆ¸ â†’ 10ä¸‡äºº â†’ 10:1
4. **é‡å¤è®°å¿†**ï¼šé¢è¯•å‰5åˆ†é’Ÿï¼Œå¿«é€Ÿè¿‡ä¸€é

---

### ç¬¬78å±‚ï¼šè‚¢ä½“è¯­è¨€å’Œè¯­æ°”

**è‚¢ä½“è¯­è¨€ï¼š**

**âœ… æ­£ç¡®çš„è‚¢ä½“è¯­è¨€ï¼š**
- çœ¼ç¥äº¤æµï¼šçœ‹ç€é¢è¯•å®˜çš„çœ¼ç›
- å¾®ç¬‘ï¼šä¿æŒå¾®ç¬‘ï¼Œå±•ç¤ºè‡ªä¿¡
- åå§¿ï¼šåç›´ï¼Œä¸è¦é©¼èƒŒ
- æ‰‹åŠ¿ï¼šé€‚å½“çš„æ‰‹åŠ¿ï¼Œå¢å¼ºè¡¨è¾¾
- ç‚¹å¤´ï¼šé¢è¯•å®˜è¯´è¯æ—¶ï¼Œé€‚å½“ç‚¹å¤´

**âŒ é”™è¯¯çš„è‚¢ä½“è¯­è¨€ï¼š**
- ä½å¤´ï¼šä¸çœ‹é¢è¯•å®˜
- æŠ–è…¿ï¼šæ˜¾å¾—ç´§å¼ 
- æŠ±è‡‚ï¼šæ˜¾å¾—é˜²å¾¡
- æ‘¸å¤´ï¼šæ˜¾å¾—ä¸è‡ªä¿¡
- ç©æ‰‹æœºï¼šä¸å°Šé‡é¢è¯•å®˜

**è¯­æ°”ï¼š**

**âœ… æ­£ç¡®çš„è¯­æ°”ï¼š**
- è‡ªä¿¡ï¼šè¯´è¯æœ‰åº•æ°”
- çƒ­æƒ…ï¼šå¯¹æŠ€æœ¯æœ‰çƒ­æƒ…
- è°¦è™šï¼šæ‰¿è®¤ä¸è¶³
- æ¸…æ™°ï¼šåå­—æ¸…æ™°ï¼Œä¸å«ç³Š
- èŠ‚å¥ï¼šä¸è¦å¤ªå¿«ï¼Œä¸è¦å¤ªæ…¢

**âŒ é”™è¯¯çš„è¯­æ°”ï¼š**
- ç´§å¼ ï¼šè¯´è¯ç»“å·´
- å†·æ¼ ï¼šæ²¡æœ‰çƒ­æƒ…
- å‚²æ…¢ï¼šä¸æ‰¿è®¤ä¸è¶³
- å«ç³Šï¼šåå­—ä¸æ¸…
- å¤ªå¿«ï¼šé¢è¯•å®˜å¬ä¸æ¸…

**è¯­æ°”ç¤ºä¾‹ï¼š**

**é”™è¯¯ç¤ºä¾‹ï¼š**
- "æˆ‘ä»¬çš„QPSæ˜¯833"ï¼ˆå¹³æ·¡ï¼Œæ²¡æœ‰çƒ­æƒ…ï¼‰
- "æˆ‘ä¸çŸ¥é“"ï¼ˆæ¶ˆæï¼Œæ²¡æœ‰è‡ªä¿¡ï¼‰

**æ­£ç¡®ç¤ºä¾‹ï¼š**
- "æˆ‘ä»¬çš„QPSæ˜¯**833æ¬¡/ç§’**ï¼Œç›¸å¯¹å¹³æ—¶å¢é•¿**333å€**ï¼"ï¼ˆçƒ­æƒ…ï¼Œæœ‰åº•æ°”ï¼‰
- "è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œä½†æˆ‘å¯ä»¥è¯´è¯´æˆ‘çš„ç†è§£ã€‚"ï¼ˆè°¦è™šï¼Œæœ‰è‡ªä¿¡ï¼‰

---

### ç¬¬79å±‚ï¼šé¢è¯•å‰çš„å‡†å¤‡æ¸…å•

**é¢è¯•å‰1å¤©ï¼š**
- [ ] å¤ä¹ æŠ€æœ¯å…¨é¢ç‰ˆæ–‡æ¡£ï¼ˆ1å°æ—¶ï¼‰
- [ ] å¤ä¹ é¢è¯•ç»ˆæç‰ˆæ–‡æ¡£ï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] å¤ä¹ æ ¸å¿ƒæ•°å­—ï¼ˆ10åˆ†é’Ÿï¼‰
- [ ] å‡†å¤‡3ä¸ªé—®é¢˜é—®é¢è¯•å®˜
- [ ] å‡†å¤‡å¥½ç®€å†ï¼ˆæ‰“å°2ä»½ï¼‰

**é¢è¯•å‰1å°æ—¶ï¼š**
- [ ] å¤ä¹ 30ç§’å¼€åœºç™½ï¼ˆ5åˆ†é’Ÿï¼‰
- [ ] å¤ä¹ 5ä¸ªå¿…é—®é—®é¢˜ï¼ˆ10åˆ†é’Ÿï¼‰
- [ ] å¤ä¹ æ ¸å¿ƒæ•°å­—ï¼ˆ5åˆ†é’Ÿï¼‰
- [ ] æ·±å‘¼å¸ï¼Œæ”¾æ¾å¿ƒæƒ…

**é¢è¯•å‰5åˆ†é’Ÿï¼š**
- [ ] å¿«é€Ÿè¿‡ä¸€éæ ¸å¿ƒæ•°å­—
- [ ] å¿«é€Ÿè¿‡ä¸€é30ç§’å¼€åœºç™½
- [ ] æ·±å‘¼å¸ï¼Œä¿æŒè‡ªä¿¡

**é¢è¯•ä¸­ï¼š**
- [ ] çœ¼ç¥äº¤æµï¼Œä¿æŒå¾®ç¬‘
- [ ] ç”¨STARæ³•åˆ™å›ç­”é—®é¢˜
- [ ] è¯´å‡ºå…·ä½“çš„æ•°å­—
- [ ] æ‰¿è®¤ä¸è¶³ï¼Œè¯´å‡ºä¼˜åŒ–ç©ºé—´
- [ ] å±•ç¤ºçƒ­æƒ…ï¼Œå±•ç¤ºæ€è€ƒ

**é¢è¯•åï¼š**
- [ ] è®°å½•é¢è¯•å®˜é—®çš„é—®é¢˜
- [ ] è®°å½•è‡ªå·±å›ç­”å¾—å¥½çš„åœ°æ–¹
- [ ] è®°å½•è‡ªå·±å›ç­”å¾—ä¸å¥½çš„åœ°æ–¹
- [ ] æ€»ç»“ç»éªŒæ•™è®­
- [ ] å‡†å¤‡ä¸‹ä¸€æ¬¡é¢è¯•

---

### ç¬¬80å±‚ï¼šé¢è¯•è€…åº”å¯¹ç­–ç•¥æ€»ç»“

**é¢è¯•æˆåŠŸçš„5ä¸ªå…³é”®ï¼š**

**1. çœŸå®ï¼ˆ70%æƒé‡ï¼‰**
- è¯´å‡ºå…·ä½“çš„æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©
- è¯´å‡ºå…·ä½“çš„æ•°æ®ï¼ˆQPSã€å“åº”æ—¶é—´ã€æˆåŠŸç‡ï¼‰
- è¯´å‡ºé‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- è¯´å‡ºè‡ªå·±çš„æ”¶è·å’Œç»éªŒæ•™è®­

**2. æ·±åº¦ï¼ˆ20%æƒé‡ï¼‰**
- è¯´å‡ºæŠ€æœ¯åŸç†ï¼ˆä¸ºä»€ä¹ˆRediså¿«ï¼Ÿä¸ºä»€ä¹ˆLuaåŸå­æ€§ï¼Ÿï¼‰
- è¯´å‡ºæ–¹æ¡ˆå¯¹æ¯”ï¼ˆMySQL vs Redis vs åˆ†å¸ƒå¼é”ï¼‰
- è¯´å‡ºæƒè¡¡åˆ©å¼Šï¼ˆæˆæœ¬ vs æ€§èƒ½ï¼‰
- è¯´å‡ºä¼˜åŒ–ç©ºé—´ï¼ˆåˆ†æ®µåº“å­˜ã€æœ¬åœ°ç¼“å­˜ï¼‰

**3. ä»·å€¼ï¼ˆ10%æƒé‡ï¼‰**
- è¯´å‡ºä¸šåŠ¡ä»·å€¼ï¼ˆç»­ä¿è½¬åŒ–ç‡æå‡25%ï¼‰
- è¯´å‡ºé‡åŒ–æ•°æ®ï¼ˆ1600ä¸‡å…ƒä¿è´¹æ”¶å…¥ï¼‰
- è¯´å‡ºç”¨æˆ·ä½“éªŒï¼ˆå“åº”æ—¶é—´ < 1ç§’ï¼‰
- è¯´å‡ºæˆæœ¬æ”¶ç›Šï¼ˆæ‰©å®¹æˆæœ¬ vs ä¸šåŠ¡æ”¶ç›Šï¼‰

**4. çƒ­æƒ…ï¼ˆåŠ åˆ†é¡¹ï¼‰**
- å¯¹æŠ€æœ¯æœ‰çƒ­æƒ…
- å¯¹é¡¹ç›®æœ‰çƒ­æƒ…
- å¯¹å…¬å¸æœ‰çƒ­æƒ…
- å¯¹é¢è¯•æœ‰çƒ­æƒ…

**5. è°¦è™šï¼ˆåŠ åˆ†é¡¹ï¼‰**
- æ‰¿è®¤ä¸è¶³ï¼ˆQPS 833ä¸ç®—é«˜ï¼‰
- è¯´å‡ºä¼˜åŒ–ç©ºé—´ï¼ˆåˆ†æ®µåº“å­˜ã€æœ¬åœ°ç¼“å­˜ï¼‰
- è™šå¿ƒè¯·æ•™ï¼ˆå¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·æ‚¨æŒ‡æ­£ï¼‰
- æŒç»­å­¦ä¹ ï¼ˆæˆ‘ä¼šç»§ç»­å­¦ä¹ XXXæŠ€æœ¯ï¼‰

---

**é¢è¯•å¤±è´¥çš„5ä¸ªåŸå› ï¼š**

**1. èƒŒé¢è¯•é¢˜ï¼ˆ70%ï¼‰**
- è¯´ä¸å‡ºå…·ä½“ç»†èŠ‚
- è¯´ä¸å‡ºå…·ä½“æ•°æ®
- è¯´ä¸å‡ºé‡åˆ°çš„é—®é¢˜

**2. åªä¼šç”¨ï¼ˆ20%ï¼‰**
- ä¸ç†è§£åŸç†
- è¯´ä¸å‡ºä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
- è¯´ä¸å‡ºæ–¹æ¡ˆå¯¹æ¯”

**3. æŠ€æœ¯å®…ï¼ˆ10%ï¼‰**
- ä¸å…³å¿ƒä¸šåŠ¡
- è¯´ä¸å‡ºä¸šåŠ¡ä»·å€¼
- è¯´ä¸å‡ºç”¨æˆ·ä½“éªŒ

**4. å‚²æ…¢ï¼ˆå‡åˆ†é¡¹ï¼‰**
- ä¸æ‰¿è®¤ä¸è¶³
- ä¸è™šå¿ƒè¯·æ•™
- ä¸å°Šé‡é¢è¯•å®˜

**5. ç´§å¼ ï¼ˆå‡åˆ†é¡¹ï¼‰**
- è¯´è¯ç»“å·´
- å¿˜è®°æ•°å­—
- é€»è¾‘æ··ä¹±

---

**é¢è¯•è¯æœ¯æ¨¡æ¿æ€»ç»“ï¼š**

**å¼€åœºç™½æ¨¡æ¿ï¼š**
"æˆ‘åœ¨XXXé¡¹ç›®ä¸­è´Ÿè´£XXXåŠŸèƒ½çš„å¼€å‘ã€‚è¿™æ˜¯XXXæ—¶é—´çš„XXXæ´»åŠ¨ï¼ŒXXXä¸šåŠ¡åœºæ™¯ã€‚æ´»åŠ¨å¸å¼•äº†XXXäººå‚ä¸ï¼ŒQPSè¾¾åˆ°XXXæ¬¡/ç§’ï¼Œç›¸å¯¹å¹³æ—¶å¢é•¿XXXå€ã€‚æˆ‘è´Ÿè´£XXXæ ¸å¿ƒæ¨¡å—çš„è®¾è®¡å’Œå¼€å‘ã€‚é‡åˆ°çš„æœ€å¤§æŒ‘æˆ˜æ˜¯XXXï¼Œæˆ‘é€šè¿‡XXXä¼˜åŒ–æ–¹æ¡ˆï¼Œä¼˜åŒ–åXXXæ•ˆæœã€‚è¿™ä¸ªé¡¹ç›®è®©æˆ‘XXXæ”¶è·ã€‚"

**å¿…é—®é—®é¢˜æ¨¡æ¿ï¼š**
"æˆ‘ä»¬çš„XXXæ˜¯XXXï¼ˆè¯´å‡ºæ•°æ®ï¼‰ã€‚è™½ç„¶XXXï¼ˆæ‰¿è®¤ä¸è¶³ï¼‰ï¼Œä½†XXXï¼ˆè¯´å‡ºå¯¹æ¯”ï¼‰ã€‚æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯XXXï¼ˆè¯´å‡ºä»·å€¼ï¼‰ã€‚"

**æ•‘åœºè¯æœ¯æ¨¡æ¿ï¼š**
"è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œä½†æˆ‘å¯ä»¥è¯´è¯´æˆ‘çš„ç†è§£ã€‚æˆ‘è®¤ä¸ºXXXï¼ˆè¯´å‡ºç†è§£ï¼‰ã€‚å¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·æ‚¨æŒ‡æ­£ã€‚"

**é™·é˜±åº”å¯¹æ¨¡æ¿ï¼š**
"æ‚¨è¯´å¾—å¯¹ï¼ŒXXXæ–¹æ¡ˆç¡®å®æ˜¯ä¸€ä¸ªå¥½æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¹Ÿè€ƒè™‘è¿‡ï¼Œä½†XXXæ–¹æ¡ˆæœ‰XXXç¼ºç‚¹ã€‚æˆ‘ä»¬çš„æ–¹æ¡ˆè™½ç„¶æœ‰XXXä¸è¶³ï¼Œä½†XXXä¼˜ç‚¹ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼šä¸è¿‡åº¦è®¾è®¡ï¼Œå¤Ÿç”¨å°±å¥½ã€‚"

---

**æœ€åçš„å»ºè®®ï¼š**

1. **é¢è¯•å‰5åˆ†é’Ÿ**ï¼šå¿«é€Ÿè¿‡ä¸€éæ ¸å¿ƒæ•°å­—å’Œ30ç§’å¼€åœºç™½
2. **é¢è¯•ä¸­**ï¼šç”¨STARæ³•åˆ™å›ç­”é—®é¢˜ï¼Œè¯´å‡ºå…·ä½“æ•°å­—
3. **é¢è¯•å**ï¼šæ€»ç»“ç»éªŒæ•™è®­ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡é¢è¯•
4. **æŒç»­å­¦ä¹ **ï¼šä¸æ–­å­¦ä¹ æ–°æŠ€æœ¯ï¼Œæå‡æŠ€æœ¯æ·±åº¦
5. **ä¿æŒè‡ªä¿¡**ï¼šç›¸ä¿¡è‡ªå·±ï¼Œå±•ç¤ºçƒ­æƒ…

**ç¥ä½ é¢è¯•æˆåŠŸï¼** ğŸ‰

---

## ğŸ“Š å…¨æ–‡æ€»ç»“

### æ–‡æ¡£ç»Ÿè®¡
- **æ€»å±‚æ•°**ï¼š80å±‚
- **æ€»å­—æ•°**ï¼šçº¦50000å­—
- **æ ¸å¿ƒæ¨¡å—**ï¼š8ä¸ªï¼ˆä¸šåŠ¡åœºæ™¯ã€å¹¶å‘é‡è®¡ç®—ã€æŠ€æœ¯æŒ‘æˆ˜ã€æŠ€æœ¯æ–¹æ¡ˆã€æ ¸å¿ƒä»£ç ã€å‹æµ‹ä¼˜åŒ–ã€é¢è¯•å®˜è§†è§’ã€é¢è¯•è€…åº”å¯¹ï¼‰
- **ä»£ç ç¤ºä¾‹**ï¼š20+ä¸ª
- **æ•°æ®è¡¨æ ¼**ï¼š30+ä¸ª
- **æµç¨‹å›¾**ï¼š10+ä¸ª

### æ ¸å¿ƒè¦ç‚¹
1. **ä¸šåŠ¡åœºæ™¯**ï¼šäººä¿è½¦é™©"å¼€é—¨çº¢"ä¼˜æƒ åˆ¸æŠ¢è´­ï¼Œ10000å¼ åˆ¸ï¼Œ10ä¸‡äººå‚ä¸
2. **å¹¶å‘é‡**ï¼šQPS 833æ¬¡/ç§’ï¼Œç›¸å¯¹å¢é•¿333å€
3. **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šRedis + Luaè„šæœ¬ã€Sentinelé™æµã€Kafkaå¼‚æ­¥ã€éªŒè¯ç é˜²åˆ·
4. **ä¼˜åŒ–æ•ˆæœ**ï¼šå“åº”æ—¶é—´ä»1500msé™åˆ°500msï¼Œæå‡67%
5. **é¢è¯•ç­–ç•¥**ï¼šçœŸå®ã€æ·±åº¦ã€ä»·å€¼ã€çƒ­æƒ…ã€è°¦è™š

### ä½¿ç”¨å»ºè®®
- **å­¦ä¹ æ—¶**ï¼šå®Œæ•´é˜…è¯»æŠ€æœ¯å…¨é¢ç‰ˆï¼ˆ1-2å°æ—¶ï¼‰
- **é¢è¯•å‰**ï¼šå¿«é€Ÿå¤ä¹ é¢è¯•ç»ˆæç‰ˆï¼ˆ5-10åˆ†é’Ÿï¼‰
- **é¢è¯•ä¸­**ï¼šç”¨STARæ³•åˆ™å›ç­”é—®é¢˜ï¼Œè¯´å‡ºå…·ä½“æ•°å­—
- **é¢è¯•å**ï¼šæ€»ç»“ç»éªŒæ•™è®­ï¼ŒæŒç»­ä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.0  
**åˆ›å»ºæ—¶é—´**ï¼š2026-02-02  
**æœ€åæ›´æ–°**ï¼š2026-02-02  
**ä½œè€…**ï¼šKiro AI  
**é€‚ç”¨åœºæ™¯**ï¼šé«˜å¹¶å‘åœºæ™¯é¢è¯•ã€æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ã€é¡¹ç›®ç»éªŒæ€»ç»“

---
