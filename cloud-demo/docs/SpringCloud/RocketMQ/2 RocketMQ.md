
一、RocketMQ发送消息与接收消息流程
1、RocketMQ发送消息与接收消息概述
1.1、发送消息：
Produce生产者指定Topic路由键发消息 → Broker根据Topic名称查路由表，找到Topic下的默认4个队列，轮询选一个存消息

1.2、接收消息：
Consumer消费者监听订阅Topic → Broker从Topic下的队列推送消息对象 → Consumer自动处理

2、RocketMQ发送消息与接收消息代码里的体现
2.1、发送消息： 
调用rocketMQTemplate的发送方法，里传两个参数，一个是路由键，一个是消息体，把要发送的消息数据发到队列里
2.2、接收消息：
加@RocketMQMessageListener注解监听订阅Topic，一有消息就自动调用方法处理。


二、RocketMQ消息可靠性保证
1、生产者
1.1、同步发送可靠
同步发送可靠：生产者发送消息 → Broker存到队列 → Broker返回ACK → 生产者收到ACK才继续执行
异步发送不可靠：生产者不等ACK确认，立即执行业务（不可靠）,消息失败时业务已完成，数据不一致。

1.2、RocketMQ持久化消息到磁盘
Broker收到消息后立即写磁盘，写完才返回成功。

2、消费者
2.1、消费确认：
Consumer消费成功自动返回ACK，Broker删除消息；消费失败不返回ACK，Broker重试投递直到成功。

2.2、消费失败：Consumer处理异常或超时，Broker将消息放入重试队列，延迟后再推送。


3.3、死信队列兜底：死信队列保存重试失败的消息，防止丢失，方便人工排查问题和修复后重新消费。



三、如何保证 消费者数据的冪等
消息ID去重（通用）
用RocketMQ的消息全局唯一ID做Redis去重，处理过就跳过。


定时消息：延迟投递消息，用于订单超时取消等定时任务


定时消息的作用（不是可靠性）
定时消息是业务功能，不是可靠性保证：

作用：延迟投递消息
场景：订单30分钟未支付自动取消
原理：消息先存延迟队列，30分钟后再投递到正常队列
一句话总结
定时消息不是保证可靠性的，它是延迟投递功能，用于订单超时取消等业务场景。


RocketMQ在秒杀系统中的体现
核心作用：削峰填谷



















1. Topic（主题/路由键）
是什么： 消息的分类标签，决定消息发到哪里
2. 消息体（Message Body）
是什么： 消息的具体内容
3. Broker（消息服务器）
存储和转发消息的服务器
4. Queue（队列）
Topic下的子队列，实际存储消息的地方

