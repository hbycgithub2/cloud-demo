# Feign è°ƒç”¨ userservice å®Œæ•´æµç¨‹ï¼ˆäººè¯ç‰ˆï¼‰

## ğŸ“Œ æ ¸å¿ƒä»£ç 

```java
// 1. å®šä¹‰æ¥å£
@FeignClient("userservice")  // â† å‘Šè¯‰ Springï¼šè¿™æ˜¯æ‰“ç»™ userservice çš„ç”µè¯
public interface UserClient {
    @GetMapping("/user/{id}")
    User findById(@PathVariable Long id);
}

// 2. ä½¿ç”¨
@Service
public class OrderService {
    @Autowired
    private UserClient userClient;  // â† ä»å®¹å™¨é‡Œæ‹¿ç”µè¯
    
    public Order queryOrderById(Long orderId) {
        User user = userClient.findById(1);  // â† æ‰“ç”µè¯
        return order;
    }
}
```

---

## ğŸ¯ ä¸€å¥è¯æ€»ç»“

**ä½ å†™ä¸ªæ¥å£ï¼ŒSpring ç»™ä½ é€ ä¸ªå‡å¯¹è±¡å½“ç”µè¯ï¼Œä½ è°ƒæ–¹æ³•å°±æ˜¯æ‰“ç”µè¯ï¼Œç”µè¯è‡ªå·±çŸ¥é“æ‰“ç»™è°ã€æ€ä¹ˆæ‰“ã€æŠŠç»“æœç»™ä½ ã€‚**

---

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        å¯åŠ¨é˜¶æ®µï¼ˆå‡†å¤‡ç”µè¯ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Spring å¯åŠ¨
    â†“
æ‰«æåˆ° @EnableFeignClients
    â†“
æ‰¾åˆ° UserClient æ¥å£
    â†“
çœ‹åˆ° @FeignClient("userservice")
çŸ¥é“ï¼šè¿™æ˜¯æ‰“ç»™ userservice çš„ç”µè¯
    â†“
ç”¨åŠ¨æ€ä»£ç†é€ ä¸ªå‡å¯¹è±¡ï¼ˆç”µè¯ï¼‰
å‡å¯¹è±¡è®°ä½ï¼š
  - æœåŠ¡åï¼šuserservice
  - æ–¹æ³•ï¼šfindById â†’ GET /user/{id}
    â†“
æŠŠå‡å¯¹è±¡æ”¾åˆ° Spring å®¹å™¨
å®¹å™¨é‡Œç°åœ¨æœ‰ï¼š
  userClientï¼ˆç”µè¯ï¼‰â†’ æ‰“ç»™ userservice
    â†“
è¿æ¥ Nacosï¼ˆé€šè®¯å½•ï¼‰
    â†“
é—® Nacosï¼š"userservice åœ¨å“ªï¼Ÿ"
    â†“
Nacos è¿”å›åœ°å€åˆ—è¡¨ï¼š
  - 192.168.26.1:8081
  - 192.168.26.2:8081
    â†“
ç¼“å­˜åˆ°æœ¬åœ°
æœ¬åœ°ç¼“å­˜ï¼š
  userservice â†’ [192.168.26.1:8081, 192.168.26.2:8081]
    â†“
å‡†å¤‡ Ribbon è´Ÿè½½å‡è¡¡å™¨ï¼ˆé€‰å·å™¨ï¼‰
    â†“
å¯åŠ¨å®Œæˆï¼Œç­‰ä½ æ‰“ç”µè¯

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        è°ƒç”¨é˜¶æ®µï¼ˆæ‰“ç”µè¯ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä½ å†™ä»£ç ï¼šuserClient.findById(1)
    â†“
æ‹¿èµ·ç”µè¯ï¼ˆè°ƒç”¨å‡å¯¹è±¡ï¼‰
    â†“
å‡å¯¹è±¡æ‹¦æˆªï¼š"ç­‰ç­‰ï¼Œæˆ‘æ¥å¤„ç†"
    â†“
å‡å¯¹è±¡çœ‹è‡ªå·±è®°çš„ä¿¡æ¯ï¼š
  - è¦æ‰“ç»™ï¼šuserservice
  - æ–¹æ³•å¯¹åº”ï¼šGET /user/{id}
  - å‚æ•°ï¼šid = 1
  - æ‰€ä»¥è¦å‘ï¼šGET /user/1
    â†“
ä»æœ¬åœ°ç¼“å­˜æŸ¥åœ°å€
userservice â†’ [192.168.26.1:8081, 192.168.26.2:8081]
    â†“
Ribbon è´Ÿè½½å‡è¡¡é€‰ä¸€ä¸ª
è¿™æ¬¡é€‰ï¼š192.168.26.1:8081
    â†“
æ‹¼å®Œæ•´åœ°å€
http://192.168.26.1:8081/user/1
    â†“
å‘ HTTP è¯·æ±‚ï¼ˆæ‹¨å·ï¼‰
GET http://192.168.26.1:8081/user/1
    â†“
    â†“ ç½‘ç»œä¼ è¾“
    â†“
UserService (192.168.26.1:8081) æ¥ç”µè¯
    â†“
@GetMapping("/{id}")
public User queryById(@PathVariable Long id) {
    // æŸ¥æ•°æ®åº“
    User user = userMapper.selectById(1);
    return user;
}
    â†“
è¿”å› JSONï¼ˆå›å¤ï¼‰
{"id":1,"username":"æŸ³å²©","address":"æ¹–å—é•¿æ²™"}
    â†“
    â†“ ç½‘ç»œä¼ è¾“
    â†“
Feign æ”¶åˆ°å“åº”ï¼ˆå¬åˆ°å›å¤ï¼‰
    â†“
ç”¨ Jackson æŠŠ JSON è½¬æˆå¯¹è±¡ï¼ˆç¿»è¯‘ï¼‰
User user = new User();
user.setId(1);
user.setUsername("æŸ³å²©");
user.setAddress("æ¹–å—é•¿æ²™");
    â†“
è¿”å›ç»™ä½ ï¼ˆé€šè¯ç»“æŸï¼‰
User user = userClient.findById(1);
// user = User(id=1, username="æŸ³å²©", address="æ¹–å—é•¿æ²™")
```

---

## ğŸš€ å¯åŠ¨é˜¶æ®µè¯¦è§£

### ç¬¬ 1 æ­¥ï¼šSpring æ‰«ææ¥å£

Spring å¯åŠ¨æ—¶çœ‹åˆ° `@EnableFeignClients`ï¼Œå»æ‰¾æ‰€æœ‰å¸¦ `@FeignClient` çš„æ¥å£ã€‚

æ‰¾åˆ°äº† `UserClient` æ¥å£ã€‚

---

### ç¬¬ 2 æ­¥ï¼šçœ‹æ¥å£ä¸Šçš„æ³¨è§£

```java
@FeignClient("userservice")  // â† çœ‹åˆ°è¿™ä¸ª
public interface UserClient {
    @GetMapping("/user/{id}")
    User findById(@PathVariable Long id);
}
```

Spring çŸ¥é“äº†ï¼š
- è¿™ä¸ªæ¥å£æ˜¯ç”¨æ¥è°ƒ `userservice` æœåŠ¡çš„
- æœ‰ä¸ªæ–¹æ³• `findById` å¯¹åº” `GET /user/{id}`

---

### ç¬¬ 3 æ­¥ï¼šé€ å‡å¯¹è±¡ï¼ˆç”µè¯ï¼‰

å› ä¸º `UserClient` åªæ˜¯æ¥å£ï¼Œæ²¡æœ‰å®ç°ç±»ï¼ŒSpring ç”¨**åŠ¨æ€ä»£ç†**é€ äº†ä¸ªå‡å¯¹è±¡ã€‚

**è¿™ä¸ªå‡å¯¹è±¡å°±åƒä¸€éƒ¨ç”µè¯ï¼Œå®ƒå†…éƒ¨è®°ä½äº†ï¼š**
```
æœåŠ¡åï¼šuserservice
æ–¹æ³•æ˜ å°„ï¼š
  findById(Long id) â†’ GET /user/{id}
```

---

### ç¬¬ 4 æ­¥ï¼šæ”¾åˆ°å®¹å™¨é‡Œ

```
Spring å®¹å™¨ï¼ˆä»“åº“ï¼‰ï¼š
â””â”€ userClientï¼ˆUserClient ç±»å‹çš„å‡å¯¹è±¡ï¼‰
   â”œâ”€ æœåŠ¡åï¼šuserservice
   â””â”€ æ–¹æ³•ï¼šfindById â†’ GET /user/{id}
```

å½“ä½  `@Autowired private UserClient userClient` æ—¶ï¼ŒSpring ä»å®¹å™¨é‡Œæ‹¿è¿™ä¸ªå‡å¯¹è±¡ç»™ä½ ã€‚

---

### ç¬¬ 5 æ­¥ï¼šè¿æ¥ Nacos

Spring è¯»é…ç½®æ–‡ä»¶ï¼š
```yaml
spring:
  cloud:
    nacos:
      server-addr: localhost:8848
```

è¿æ¥åˆ° Nacos æœåŠ¡å™¨ï¼ˆlocalhost:8848ï¼‰ã€‚

**Nacos å°±åƒä¸ªé€šè®¯å½•ï¼Œè®°å½•äº†æ‰€æœ‰æœåŠ¡çš„åœ°å€ã€‚**

---

### ç¬¬ 6 æ­¥ï¼šé—® Nacos è¦åœ°å€

Spring é—® Nacosï¼š"userservice åœ¨å“ªï¼Ÿ"

Nacos æŸ¥é€šè®¯å½•ï¼Œè¿”å›ï¼š
```
userservice æœ‰ä¸¤ä¸ªå®ä¾‹ï¼š
- 192.168.26.1:8081ï¼ˆä¸Šæµ·æœºæˆ¿ï¼‰
- 192.168.26.2:8081ï¼ˆä¸Šæµ·æœºæˆ¿ï¼‰
```

---

### ç¬¬ 7 æ­¥ï¼šç¼“å­˜åˆ°æœ¬åœ°

æŠŠåœ°å€åˆ—è¡¨ç¼“å­˜åˆ°æœ¬åœ°å†…å­˜ï¼š
```
æœ¬åœ°ç¼“å­˜ï¼š
userservice â†’ [192.168.26.1:8081, 192.168.26.2:8081]
```

**å¥½å¤„ï¼š** ä¸ç”¨æ¯æ¬¡è°ƒç”¨éƒ½å»é—® Nacosï¼Œç›´æ¥ä»ç¼“å­˜æ‹¿ï¼Œé€Ÿåº¦å¿«ã€‚

---

### ç¬¬ 8 æ­¥ï¼šå‡†å¤‡è´Ÿè½½å‡è¡¡å™¨

åˆå§‹åŒ– Ribbon è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨æ¥ä»å¤šä¸ªåœ°å€é‡Œé€‰ä¸€ä¸ªã€‚

**é»˜è®¤ç­–ç•¥ï¼šè½®è¯¢**
- ç¬¬ 1 æ¬¡è°ƒç”¨ â†’ é€‰ 192.168.26.1:8081
- ç¬¬ 2 æ¬¡è°ƒç”¨ â†’ é€‰ 192.168.26.2:8081
- ç¬¬ 3 æ¬¡è°ƒç”¨ â†’ é€‰ 192.168.26.1:8081
- ...

---

### å¯åŠ¨å®Œæˆ

**ç°åœ¨ä½ æœ‰äº†ï¼š**
- âœ… ä¸€éƒ¨ç”µè¯ï¼ˆuserClient å‡å¯¹è±¡ï¼‰
- âœ… ç”µè¯è®°ä½äº†æ‰“ç»™è°ï¼ˆuserserviceï¼‰
- âœ… é€šè®¯å½•é‡Œæœ‰åœ°å€ï¼ˆ192.168.26.1:8081, 192.168.26.2:8081ï¼‰
- âœ… é€‰å·å™¨å‡†å¤‡å¥½äº†ï¼ˆRibbonï¼‰

**ç­‰ä½ æ‰“ç”µè¯ã€‚**

---

## ğŸ“ è°ƒç”¨é˜¶æ®µè¯¦è§£

### åœºæ™¯

```java
User user = userClient.findById(1);  // â† ä½ æ‰“ç”µè¯
```

---

### ç¬¬ 1 æ­¥ï¼šæ‹¿èµ·ç”µè¯

ä½ å†™ `userClient.findById(1)`ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨å‡å¯¹è±¡çš„æ–¹æ³•ã€‚

---

### ç¬¬ 2 æ­¥ï¼šå‡å¯¹è±¡æ‹¦æˆª

å‡å¯¹è±¡è¯´ï¼š"ç­‰ç­‰ï¼Œæˆ‘æ¥å¤„ç†"ï¼Œæ‹¦æˆªäº†ä½ çš„è°ƒç”¨ã€‚

**æ‹¦æˆªåŸç†ï¼š** åŠ¨æ€ä»£ç†ï¼Œæ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½ä¼šè¢«æ‹¦æˆªã€‚

---

### ç¬¬ 3 æ­¥ï¼šå‡å¯¹è±¡çœ‹è‡ªå·±è®°çš„ä¿¡æ¯

å‡å¯¹è±¡å†…éƒ¨è®°ç€ï¼š
```
æœåŠ¡åï¼šuserservice
æ–¹æ³•ï¼šfindById â†’ GET /user/{id}
å‚æ•°ï¼šid = 1
```

æ‰€ä»¥çŸ¥é“äº†ï¼š**è¦å‘ GET /user/1 è¯·æ±‚åˆ° userservice**

---

### ç¬¬ 4 æ­¥ï¼šä»ç¼“å­˜æŸ¥åœ°å€

ä»æœ¬åœ°ç¼“å­˜æŸ¥ `userservice` çš„åœ°å€ï¼š
```
userservice â†’ [192.168.26.1:8081, 192.168.26.2:8081]
```

---

### ç¬¬ 5 æ­¥ï¼šè´Ÿè½½å‡è¡¡é€‰ä¸€ä¸ª

Ribbon è´Ÿè½½å‡è¡¡å™¨è½®è¯¢é€‰æ‹©ï¼Œè¿™æ¬¡é€‰ï¼š`192.168.26.1:8081`

---

### ç¬¬ 6 æ­¥ï¼šæ‹¼å®Œæ•´åœ°å€

```
IP + ç«¯å£ + è·¯å¾„
192.168.26.1:8081 + /user/1
= http://192.168.26.1:8081/user/1
```

---

### ç¬¬ 7 æ­¥ï¼šå‘ HTTP è¯·æ±‚ï¼ˆæ‹¨å·ï¼‰

ç”¨ `HttpURLConnection` å‘é€ HTTP è¯·æ±‚ï¼š
```http
GET /user/1 HTTP/1.1
Host: 192.168.26.1:8081
Accept: application/json
Content-Type: application/json
```

---

### ç¬¬ 8 æ­¥ï¼šUserService å¤„ç†è¯·æ±‚ï¼ˆæ¥ç”µè¯ï¼‰

UserServiceï¼ˆ192.168.26.1:8081ï¼‰æ”¶åˆ°è¯·æ±‚ï¼š

```java
@RestController
@RequestMapping("/user")
public class UserController {
    
    @GetMapping("/{id}")
    public User queryById(@PathVariable Long id) {
        // 1. æ”¶åˆ°è¯·æ±‚ï¼šGET /user/1
        // 2. å‚æ•°ï¼šid = 1
        
        // 3. æŸ¥æ•°æ®åº“
        User user = userMapper.selectById(1);
        // SQL: SELECT * FROM tb_user WHERE id = 1
        // ç»“æœï¼š{id: 1, username: "æŸ³å²©", address: "æ¹–å—é•¿æ²™"}
        
        // 4. è¿”å›å¯¹è±¡ï¼ˆSpring MVC è‡ªåŠ¨è½¬ JSONï¼‰
        return user;
    }
}
```

è¿”å› HTTP å“åº”ï¼š
```http
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8

{"id":1,"username":"æŸ³å²©","address":"æ¹–å—é•¿æ²™"}
```

---

### ç¬¬ 9 æ­¥ï¼šFeign æ”¶åˆ°å“åº”ï¼ˆå¬åˆ°å›å¤ï¼‰

Feign æ”¶åˆ° HTTP å“åº”ï¼š
- çŠ¶æ€ç ï¼š200
- å“åº”ä½“ï¼š`{"id":1,"username":"æŸ³å²©","address":"æ¹–å—é•¿æ²™"}`

---

### ç¬¬ 10 æ­¥ï¼šJSON è½¬å¯¹è±¡ï¼ˆç¿»è¯‘ï¼‰

ç”¨ Jackson æŠŠ JSON å­—ç¬¦ä¸²è½¬æˆ Java å¯¹è±¡ï¼š

```java
String json = "{\"id\":1,\"username\":\"æŸ³å²©\",\"address\":\"æ¹–å—é•¿æ²™\"}";

ObjectMapper mapper = new ObjectMapper();
User user = mapper.readValue(json, User.class);

// ç»“æœï¼š
// user.id = 1
// user.username = "æŸ³å²©"
// user.address = "æ¹–å—é•¿æ²™"
```

---

### ç¬¬ 11 æ­¥ï¼šè¿”å›ç»™ä½ ï¼ˆé€šè¯ç»“æŸï¼‰

æŠŠ User å¯¹è±¡è¿”å›ç»™ä½ ï¼š

```java
User user = userClient.findById(1);
// user = User(id=1, username="æŸ³å²©", address="æ¹–å—é•¿æ²™")
```

**é€šè¯ç»“æŸï¼Œä½ æ‹¿åˆ°äº†ç»“æœã€‚**

---

## ğŸ¯ æ ¸å¿ƒæ€»ç»“

### å¯åŠ¨æ—¶ï¼ˆå‡†å¤‡å·¥ä½œï¼‰

1. **é€ ç”µè¯**ï¼šSpring ä¸º UserClient æ¥å£é€ äº†ä¸ªå‡å¯¹è±¡ï¼ˆä»£ç†å¯¹è±¡ï¼‰
2. **ç”µè¯è®°ä¿¡æ¯**ï¼šå‡å¯¹è±¡è®°ä½äº†è¦æ‰“ç»™ `userservice`ï¼Œæ–¹æ³•å¯¹åº” `GET /user/{id}`
3. **æ”¾å®¹å™¨**ï¼šæŠŠå‡å¯¹è±¡æ”¾å®¹å™¨é‡Œï¼Œä½  `@Autowired` æ—¶æ‹¿çš„å°±æ˜¯å®ƒ
4. **æŸ¥é€šè®¯å½•**ï¼šè¿ Nacosï¼Œé—® `userservice` åœ¨å“ªï¼Œè®°ä¸‹åœ°å€
5. **å‡†å¤‡é€‰å·å™¨**ï¼šåˆå§‹åŒ– Ribbon è´Ÿè½½å‡è¡¡å™¨

### è°ƒç”¨æ—¶ï¼ˆå®é™…æ‰§è¡Œï¼‰

1. **æ‹¿ç”µè¯**ï¼šä½ è°ƒ `userClient.findById(1)`ï¼Œæ‹¿èµ·å‡å¯¹è±¡
2. **ç”µè¯çŸ¥é“æ‰“ç»™è°**ï¼šå‡å¯¹è±¡è®°å¾—è¦æ‰“ç»™ `userservice`ï¼Œå‘ `GET /user/1`
3. **æŸ¥åœ°å€**ï¼šä»ç¼“å­˜æŸ¥ `userservice` çš„åœ°å€åˆ—è¡¨
4. **é€‰ä¸€ä¸ª**ï¼šRibbon è½®è¯¢é€‰ä¸€ä¸ªï¼š192.168.26.1:8081
5. **æ‹¨å·**ï¼šå‘ HTTP è¯·æ±‚ï¼š`GET http://192.168.26.1:8081/user/1`
6. **æ¥å¬**ï¼šUserService æŸ¥æ•°æ®åº“ï¼Œè¿”å› JSON
7. **ç¿»è¯‘**ï¼šJackson æŠŠ JSON è½¬æˆ User å¯¹è±¡
8. **ç»™ä½ **ï¼šè¿”å›ç»“æœ

---

## ğŸ’¡ æœ¬è´¨ç†è§£

### ä½ ä»¥ä¸º

è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œç›´æ¥æ‹¿åˆ°ç»“æœã€‚

### å®é™…ä¸Š

Feign å·å·å¸®ä½ ï¼š
1. å‘äº†ä¸ª HTTP è¯·æ±‚åˆ°å¦ä¸€å°æœºå™¨ï¼ˆ192.168.26.1:8081ï¼‰
2. ç­‰å¯¹æ–¹è¿”å› JSON
3. è½¬æˆå¯¹è±¡ç»™ä½ 

### æ¯”å–»

**å°±åƒæ‰“ç”µè¯ï¼š**
- `userClient` = ç”µè¯
- `@FeignClient("userservice")` = ç”µè¯è®°ä½äº†æ‰“ç»™è°
- `findById(1)` = æ‹¨å·
- Nacos = é€šè®¯å½•
- Ribbon = é€‰å·å™¨ï¼ˆå¤šä¸ªå·ç é€‰ä¸€ä¸ªï¼‰
- HTTP è¯·æ±‚ = ç”µè¯ä¿¡å·
- JSON å“åº” = å¯¹æ–¹è¯´çš„è¯
- å¯¹è±¡ = ç¿»è¯‘æˆä½ èƒ½æ‡‚çš„è¯

---

## ğŸ”‘ å…³é”®ç‚¹

1. **userClient æ˜¯å‡çš„**ï¼šæ˜¯ä¸ªä»£ç†å¯¹è±¡ï¼Œä¸æ˜¯çœŸå®ç°
2. **å‡å¯¹è±¡è®°ä½äº†æœåŠ¡å**ï¼šçŸ¥é“è¦è°ƒ userservice
3. **è°ƒç”¨æ—¶è‡ªåŠ¨å‘ HTTP**ï¼šä½ è°ƒæ–¹æ³•ï¼Œå®ƒå‘è¯·æ±‚
4. **ä» Nacos æ‹¿åœ°å€**ï¼šä¸ç”¨å†™æ­» IPï¼ŒåŠ¨æ€è·å–
5. **è´Ÿè½½å‡è¡¡**ï¼šå¤šä¸ªå®ä¾‹è½®æµè°ƒç”¨
6. **è‡ªåŠ¨è½¬æ¢**ï¼šJSON è‡ªåŠ¨è½¬æˆå¯¹è±¡

---

## ğŸ¬ æœ€ç»ˆç†è§£

**Feign = è¿œç¨‹è°ƒç”¨çš„ç”µè¯**

ä½ å†™ä¸ªæ¥å£ï¼ŒSpring ç»™ä½ é€ ä¸ªç”µè¯ï¼Œç”µè¯è®°ä½äº†æ‰“ç»™è°ã€æ€ä¹ˆæ‰“ã€‚

ä½ è°ƒæ–¹æ³•å°±æ˜¯æ‰“ç”µè¯ï¼Œç”µè¯è‡ªåŠ¨æŸ¥åœ°å€ã€æ‹¨å·ã€æ¥å¬ã€ç¿»è¯‘ï¼Œæœ€åæŠŠç»“æœç»™ä½ ã€‚

**ä½ ä¸ç”¨ç®¡ç»†èŠ‚ï¼Œå°±åƒæ‰“ç”µè¯ä¸€æ ·ç®€å•ã€‚**


---

## ğŸ¯ æç®€ç‰ˆæµç¨‹å›¾

### å¯åŠ¨é˜¶æ®µï¼ˆ3 æ­¥ï¼‰

```
Spring å¯åŠ¨
    â†“
é€ ç”µè¯ + æŸ¥é€šè®¯å½•
    â†“
å‡†å¤‡å®Œæˆ
```

**è¯¦ç»†ï¼š**
```
1. é€ ç”µè¯
   Spring çœ‹åˆ° @FeignClient("userservice")
   â†’ é€ ä¸ªå‡å¯¹è±¡ï¼ˆç”µè¯ï¼‰
   â†’ æ”¾å®¹å™¨é‡Œ

2. æŸ¥é€šè®¯å½•
   è¿ Nacos é—®ï¼š"userservice åœ¨å“ªï¼Ÿ"
   â†’ æ‹¿åˆ°åœ°å€ï¼š192.168.26.1:8081
   â†’ ç¼“å­˜åˆ°æœ¬åœ°

3. å‡†å¤‡å®Œæˆ
   ç”µè¯å‡†å¤‡å¥½äº†ï¼Œç­‰ä½ æ‰“
```

---

### è°ƒç”¨é˜¶æ®µï¼ˆ5 æ­¥ï¼‰

```
ä½ è°ƒæ–¹æ³•
    â†“
ç”µè¯æ‹¦æˆª
    â†“
æŸ¥åœ°å€ + é€‰ä¸€ä¸ª
    â†“
å‘ HTTP è¯·æ±‚
    â†“
æ‹¿ç»“æœ
```

**è¯¦ç»†ï¼š**
```
1. ä½ è°ƒæ–¹æ³•
   userClient.findById(1)

2. ç”µè¯æ‹¦æˆª
   å‡å¯¹è±¡è¯´ï¼š"æˆ‘æ¥å¤„ç†"
   çœ‹æ³¨è§£çŸ¥é“ï¼šè¦å‘ GET /user/1 åˆ° userservice

3. æŸ¥åœ°å€ + é€‰ä¸€ä¸ª
   ä»ç¼“å­˜æŸ¥åœ°å€ â†’ [192.168.26.1:8081, 192.168.26.2:8081]
   Ribbon é€‰ä¸€ä¸ª â†’ 192.168.26.1:8081

4. å‘ HTTP è¯·æ±‚
   GET http://192.168.26.1:8081/user/1
   â†’ UserService è¿”å› JSON

5. æ‹¿ç»“æœ
   JSON è½¬å¯¹è±¡ â†’ è¿”å›ç»™ä½ 
```

---

### ä¸€å›¾çœ‹æ‡‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¯åŠ¨é˜¶æ®µ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Spring å¯åŠ¨                                            â”‚
â”‚         â†“                                               â”‚
â”‚  æ‰«æåˆ° @EnableFeignClients  â† è§¦å‘ Feign               â”‚
â”‚         â†“                                               â”‚
â”‚  æ‰¾åˆ° @FeignClient("userservice")                       â”‚
â”‚         â†“                                               â”‚
â”‚  ä¸º UserClient ç”Ÿæˆå®ç°ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰                     â”‚
â”‚  è¿™ä¸ªå¯¹è±¡ä¸“é—¨ç”¨æ¥è°ƒ userservice                          â”‚
â”‚         â†“                                               â”‚
â”‚  æŠŠ userClient æ”¾åˆ° Spring å®¹å™¨                         â”‚
â”‚  ï¼ˆå°±åƒæŠŠç”µè¯æ”¾åˆ°ä»“åº“ï¼Œéšæ—¶å¯ä»¥æ‹¿ï¼‰                        â”‚
â”‚         â†“                                               â”‚
â”‚  è¿æ¥ Nacosï¼ˆé€šè®¯å½•ï¼‰                                    â”‚
â”‚         â†“                                               â”‚
â”‚  é—® Nacosï¼š"userservice åœ¨å“ªï¼Ÿ"                          â”‚
â”‚         â†“                                               â”‚
â”‚  Nacos è¿”å›åœ°å€åˆ—è¡¨ï¼š                                    â”‚
â”‚  [192.168.26.1:8081, 192.168.26.2:8081]               â”‚
â”‚         â†“                                               â”‚
â”‚  ç¼“å­˜åˆ°æœ¬åœ° + å‡†å¤‡ Ribbon è´Ÿè½½å‡è¡¡                        â”‚
â”‚         â†“                                               â”‚
â”‚  å¯åŠ¨å®Œæˆï¼Œç­‰ä½ æ‰“ç”µè¯                                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è°ƒç”¨é˜¶æ®µ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  // æ¥å£å®šä¹‰ï¼ˆå¯åŠ¨æ—¶ Spring å·²ç»ä¸ºå®ƒç”Ÿæˆäº†ä»£ç†å¯¹è±¡ï¼‰       â”‚
â”‚  @FeignClient("userservice")                           â”‚
â”‚  public interface UserClient {                         â”‚
â”‚      @GetMapping("/user/{id}")                         â”‚
â”‚      User findById(@PathVariable("id") Long id);       â”‚
â”‚  }                                                      â”‚
â”‚         â†“                                               â”‚
â”‚  // ä½ å†™çš„ä»£ç                                            â”‚
â”‚  @Autowired                                            â”‚
â”‚  private UserClient userClient;                        â”‚
â”‚  â†“                                                      â”‚
â”‚  Spring æŒ‰ç±»å‹ UserClient ä»å®¹å™¨æ‰¾å¯¹è±¡                   â”‚
â”‚  æ‰¾åˆ°çš„æ˜¯ï¼šä¸º UserClient æ¥å£ç”Ÿæˆçš„ä»£ç†å¯¹è±¡                â”‚
â”‚  æ³¨å…¥ç»™ userClient å˜é‡                                 â”‚
â”‚         â†“                                               â”‚
â”‚  User user = userClient.findById(1);  â† ä½ è°ƒç”¨æ–¹æ³•      â”‚
â”‚         â†“                                               â”‚
â”‚  userClient æ˜¯ä»£ç†å¯¹è±¡ï¼Œä¸ä¼šæ‰§è¡ŒçœŸå®æ–¹æ³•                  â”‚
â”‚  è€Œæ˜¯æŠŠè°ƒç”¨è½¬ç»™å†…éƒ¨çš„æ‹¦æˆªå™¨ï¼ˆInvocationHandlerï¼‰          â”‚
â”‚         â†“                                               â”‚
â”‚  æ‹¦æˆªå™¨æ‹¿åˆ°è¿™æ¬¡è°ƒç”¨çš„ä¿¡æ¯ï¼š                               â”‚
â”‚  - è°ƒç”¨çš„æ–¹æ³•ï¼šfindById                                  â”‚
â”‚  - æ–¹æ³•å‚æ•°ï¼šid = 1                                     â”‚
â”‚         â†“                                               â”‚
â”‚  æ‹¦æˆªå™¨å»çœ‹ UserClient æ¥å£ä¸Šçš„æ³¨è§£ï¼š                     â”‚
â”‚  - @FeignClient("userservice") â†’ æœåŠ¡å                â”‚
â”‚  - @GetMapping("/user/{id}") â†’ è¯·æ±‚è·¯å¾„                â”‚
â”‚         â†“                                               â”‚
â”‚  æ‹¦æˆªå™¨ç»„è£…ä¿¡æ¯ï¼š                                        â”‚
â”‚  æœåŠ¡åï¼šuserservice                                    â”‚
â”‚  HTTP æ–¹æ³•ï¼šGET                                         â”‚
â”‚  è·¯å¾„ï¼š/user/{id}ï¼ŒæŠŠ {id} æ›¿æ¢æˆ 1 â†’ /user/1           â”‚
â”‚         â†“                                               â”‚
â”‚  çŸ¥é“äº†ï¼šè¦å‘ GET /user/1 åˆ° userservice                â”‚
â”‚         â†“                                               â”‚
â”‚  ä»æœ¬åœ°ç¼“å­˜æŸ¥ userservice çš„åœ°å€                         â”‚
â”‚  [192.168.26.1:8081, 192.168.26.2:8081]               â”‚
â”‚         â†“                                               â”‚
â”‚  Ribbon è´Ÿè½½å‡è¡¡é€‰ä¸€ä¸ªï¼ˆè½®è¯¢ï¼‰                            â”‚
â”‚  è¿™æ¬¡é€‰ï¼š192.168.26.1:8081                              â”‚
â”‚         â†“                                               â”‚
â”‚  æ‹¼å®Œæ•´ URL + å‘ HTTP è¯·æ±‚                              â”‚
â”‚  GET http://192.168.26.1:8081/user/1                   â”‚
â”‚         â†“                                               â”‚
â”‚  UserService æ”¶åˆ°è¯·æ±‚ â†’ æŸ¥æ•°æ®åº“ â†’ è¿”å› JSON            â”‚
â”‚  {"id":1,"username":"æŸ³å²©","address":"æ¹–å—é•¿æ²™"}         â”‚
â”‚         â†“                                               â”‚
â”‚  Jackson æŠŠ JSON è½¬æˆ User å¯¹è±¡                         â”‚
â”‚         â†“                                               â”‚
â”‚  è¿”å›ï¼šUser(id=1, username="æŸ³å²©")                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æœ€ç®€ç‰ˆï¼ˆä¸€å¥è¯ï¼‰

**å¯åŠ¨æ—¶ï¼š** é€ ç”µè¯ï¼ŒæŸ¥åœ°å€ï¼Œè®°ä¸‹æ¥ã€‚

**è°ƒç”¨æ—¶ï¼š** æ‹¿ç”µè¯ï¼Œé€‰åœ°å€ï¼Œå‘è¯·æ±‚ï¼Œæ‹¿ç»“æœã€‚

---

### æ ¸å¿ƒå°± 3 ä¸ªåŠ¨ä½œ

```
1. é€ ç”µè¯ï¼ˆåŠ¨æ€ä»£ç†ï¼‰
   â†“
2. æŸ¥åœ°å€ï¼ˆNacosï¼‰
   â†“
3. å‘è¯·æ±‚ï¼ˆHTTPï¼‰
```

**å®Œäº‹ï¼**
